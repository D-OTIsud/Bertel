<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OTI du Sud · API – Documentation</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand: #76B097;          /* Main theme color */
      --brand-700:#5A8B73;
      --brand-600:#6BA088;
      --brand-500:#76B097;
      --brand-400:#8BC2A6;
      --brand-300:#A0D1B5;
      --brand-200:#B5E0C4;
      --brand-100:#CAEFD3;
      --brand-50:#DFF8E2;
      --accent:#76B097;          /* Accent color matches main theme */
      --accent-light:#A0D1B5;
      --bg:#FAFCFA;
      --card:#FFFFFF;
      --text:#1F2937;
      --muted:#6B7280;
      --line:#E5E7EB;
      --code-bg:#0B1020;
      --code:#EDEFF6;
      --shadow:0 10px 25px rgba(118,176,151,.08),0 2px 6px rgba(118,176,151,.04);
      --shadow-hover:0 15px 35px rgba(118,176,151,.12),0 4px 10px rgba(118,176,151,.06);
      --radius:18px;
      --gradient:linear-gradient(135deg, var(--brand-400), var(--brand-600));
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0B1117;
        --card:#0F1722;
        --text:#E5E7EB;
        --muted:#A3AAB5;
        --line:#1F2A37;
        --shadow:0 10px 25px rgba(0,0,0,.25),0 2px 6px rgba(0,0,0,.15);
        --shadow-hover:0 15px 35px rgba(0,0,0,.35),0 4px 10px rgba(0,0,0,.2);
        --code-bg:#0A0F1A;
        --code:#DDE1F2;
        --gradient:linear-gradient(135deg, var(--brand-500), var(--brand-700));
      }
    }
    .dark{
      --bg:#0B1117;
      --card:#0F1722;
      --text:#E5E7EB;
      --muted:#A3AAB5;
      --line:#1F2A37;
      --shadow:0 10px 25px rgba(0,0,0,.25),0 2px 6px rgba(0,0,0,.15);
      --shadow-hover:0 15px 35px rgba(0,0,0,.35),0 4px 10px rgba(0,0,0,.2);
      --code-bg:#0A0F1A;
      --code:#DDE1F2;
      --gradient:linear-gradient(135deg, var(--brand-500), var(--brand-700));
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial,'Noto Sans',sans-serif;
      color:var(--text);
      background:var(--bg);
      line-height:1.55;
    }
    a{color:var(--brand-400);text-decoration:none}
    a:hover{text-decoration:underline}
    /* Header */
    .topbar{
      position:sticky;top:0;z-index:50;
      background:var(--gradient);
      color:#fff;border-bottom:1px solid rgba(255,255,255,.15);
      box-shadow:0 8px 32px rgba(118,176,151,.15), 0 4px 16px rgba(118,176,151,.1);
      backdrop-filter:blur(20px);
      position: relative;
      overflow: hidden;
    }
    .topbar::before{
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(255,255,255,.05) 0%, transparent 50%, rgba(255,255,255,.03) 100%);
      pointer-events: none;
    }
    .topbar-inner{
      max-width:1200px;margin:0 auto;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:32px;
      padding:24px 24px;
      align-items:center;
      min-height:100px;
      position: relative;
      z-index: 1;
    }
    .header-left{
      display:flex;
      align-items:center;
      gap:20px;
    }
    .logo{
      width:70px;height:70px;border-radius:20px;background:#fff;padding:10px;
      box-shadow:0 6px 20px rgba(118,176,151,.25),inset 0 0 0 2px rgba(118,176,151,.1);
      transition:all 0.3s ease;
      flex-shrink:0;
    }
    .logo:hover{
      transform:scale(1.08) rotate(2deg);
      box-shadow:0 8px 25px rgba(118,176,151,.35),inset 0 0 0 2px rgba(118,176,151,.2);
    }
    .title{
      display:flex;flex-direction:column;gap:6px;
    }
    .title strong{
      font-weight:800;letter-spacing:.4px;font-size:22px;
      text-shadow:0 2px 4px rgba(0,0,0,.1);
    }
    .title small{
      opacity:.95;font-size:15px;font-weight:500;
      text-shadow:0 1px 2px rgba(0,0,0,.1);
    }
    .header-right{
      display:flex;
      flex-direction:column;
      gap:16px;
      align-items:flex-end;
    }
    .actions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .chip{
      background:rgba(255,255,255,.18);
      color:#fff;border:1px solid rgba(255,255,255,.25);
      border-radius:999px;padding:8px 12px;font-size:12px;font-weight:700;
      box-shadow:0 2px 8px rgba(0,0,0,.1);
      transition:all 0.2s ease;
    }
    .chip:hover{
      background:rgba(255,255,255,.25);
      transform:translateY(-1px);
    }
    .btn{
      border-radius:14px;border:1px solid rgba(255,255,255,.3);
      background:rgba(255,255,255,.15);color:#fff;padding:10px 14px;
      display:flex;align-items:center;gap:8px;font-weight:600;
      transition:all 0.3s ease;
      backdrop-filter:blur(10px);
      font-size:13px;
    }
    .btn:hover{
      background:rgba(255,255,255,.25);
      transform:translateY(-2px);
      box-shadow:0 6px 16px rgba(255,255,255,.2);
      border-color:rgba(255,255,255,.4);
    }
    .searchbar{
      width:100%;
      max-width:420px;
    }
    .searchbar input{
      width:100%;border:none;background:#fff;border-radius:16px;
      padding:16px 18px 16px 48px;color:#111;outline:none;font-size:15px;
      box-shadow:0 4px 16px rgba(118,176,151,.15), 0 2px 8px rgba(118,176,151,.1);
      background:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%2376B097" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>') 16px 50% / 24px 24px no-repeat, #fff;
      transition:all 0.3s ease;
      font-weight:500;
    }
    .searchbar input:focus{
      box-shadow:0 6px 20px rgba(118,176,151,.2), 0 4px 12px rgba(118,176,151,.15);
      transform:translateY(-1px);
    }
    .searchbar input::placeholder{
      color:#999;
      font-weight:400;
    }
    @media (prefers-color-scheme: dark){
      .searchbar input{background:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="%23A0D1B5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>') 16px 50% / 24px 24px no-repeat, var(--card); color:var(--text)}
    }
    .container{
      max-width:1200px;margin:0 auto;padding:10px 18px 90px;display:grid;
      grid-template-columns:minmax(260px, 320px) 1fr;gap:24px;
    }
    @media (max-width:1024px){
      .container{
        grid-template-columns:1fr;
        gap:20px;
      }
    }
    /* TOC */
    .toc{
      position:sticky;top:20px;align-self:start;background:var(--card);
      border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);
      padding:20px;max-height:calc(100vh - 40px);overflow-y:auto;overflow-x:hidden;
      backdrop-filter:blur(10px);
      transition:all 0.3s ease;
    }
    .toc::-webkit-scrollbar{
      width:6px;
    }
    .toc::-webkit-scrollbar-track{
      background:transparent;
      border-radius:3px;
    }
    .toc::-webkit-scrollbar-thumb{
      background:var(--brand-300);
      border-radius:3px;
    }
    .toc::-webkit-scrollbar-thumb:hover{
      background:var(--brand-400);
    }
    .toc::-webkit-scrollbar-corner{
      background:transparent;
    }
    .toc:hover{
      box-shadow:var(--shadow-hover);
      transform:translateY(-2px);
    }
    .toc h3{
      margin:0 0 16px 0;font-size:14px;text-transform:uppercase;letter-spacing:.1em;
      color:var(--brand-600);font-weight:700;border-bottom:2px solid var(--brand-100);
      padding-bottom:8px;
    }
    .toc a{
      display:block;padding:8px 12px;border-radius:10px;color:var(--text);
      border-left:4px solid transparent;font-size:14px;font-weight:500;
      transition:all 0.3s ease;text-decoration:none;margin-bottom:2px;
      position:relative;word-wrap:break-word;hyphens:auto;
    }
    .toc a:hover{
      background:rgba(118,176,151,.1);
      transform:translateX(4px);
      border-left-color:var(--brand-300);
      color:var(--brand-700);
      box-shadow:0 2px 8px rgba(118,176,151,.15);
    }
    .toc a.active{
      background:linear-gradient(135deg, rgba(118,176,151,.15), rgba(118,176,151,.08));
      border-left-color:var(--brand-500);
      color:var(--brand-700);
      font-weight:600;
      transform:translateX(6px);
      box-shadow:0 2px 8px rgba(118,176,151,.2);
    }
    .toc a.active::before{
      content: '';
      position: absolute;
      left: -4px;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 20px;
      background: var(--brand-500);
      border-radius: 0 2px 2px 0;
    }
    .toc .sub{
      padding-left:16px;
      margin-left:8px;
      border-left:2px solid var(--brand-100);
      overflow:hidden;
    }
    .toc .sub a{
      font-size:13px;
      padding:6px 10px;
      word-wrap:break-word;
    }
    .toc .sub a.active{
      border-left-color:var(--brand-400);
    }
    
    /* Main */
    .card{
      background:var(--card);border:1px solid var(--line);border-radius:var(--radius);
      box-shadow:var(--shadow);padding:22px;margin-bottom:18px;
      backdrop-filter:blur(10px);
      transition:all 0.2s ease;
    }
    .card:hover{
      box-shadow:var(--shadow-hover);
      transform:translateY(-2px);
    }
    h1{font-size:32px;margin:0 0 6px 0}
    h2{font-size:26px;margin:24px 0 8px}
    h3{font-size:20px;margin:18px 0 8px}
    p{margin:8px 0 12px}
    .lead{color:var(--muted);font-size:15px}
    .pill{display:inline-flex;align-items:center;gap:8px;font-weight:700;
      color:var(--brand-700);background:rgba(118,176,151,.14);border:1px solid rgba(118,176,151,.3);
      padding:6px 10px;border-radius:999px;font-size:12px;
      transition:all 0.2s ease;
    }
    .pill:hover{
      background:rgba(118,176,151,.20);
      transform:scale(1.02);
    }
    
    /* Tip card styles */
    .tip-card{
      height:fit-content;
      max-width:100%;
      background:linear-gradient(135deg, rgba(59,130,246,.08), rgba(59,130,246,.04));
      border:1px solid rgba(59,130,246,.2);
    }
    .tip-pill{
      background:rgba(59,130,246,.2);
      border-color:rgba(59,130,246,.4);
      color:#1e40af;
    }
    .tip-pill:hover{
      background:rgba(59,130,246,.3);
    }
    .tip-text{
      color:#374151;
      font-weight:500;
    }
    @media (prefers-color-scheme: dark){
      .tip-card{
        background:linear-gradient(135deg, rgba(59,130,246,.15), rgba(59,130,246,.08));
        border:1px solid rgba(59,130,246,.3);
      }
      .tip-pill{
        background:rgba(59,130,246,.25);
        border-color:rgba(59,130,246,.5);
        color:#60a5fa;
      }
      .tip-pill:hover{
        background:rgba(59,130,246,.35);
      }
      .tip-text{
        color:#d1d5db;
      }
    }
    .dark .tip-card{
      background:linear-gradient(135deg, rgba(59,130,246,.15), rgba(59,130,246,.08));
      border:1px solid rgba(59,130,246,.3);
    }
    .dark .tip-pill{
      background:rgba(59,130,246,.25);
      border-color:rgba(59,130,246,.5);
      color:#60a5fa;
    }
    .dark .tip-pill:hover{
      background:rgba(59,130,246,.35);
    }
    .dark .tip-text{
      color:#d1d5db;
    }
    /* Tables */
    table{width:100%;border-collapse:separate;border-spacing:0 6px}
    th,td{padding:10px 12px;vertical-align:top}
    th{font-size:12px;text-transform:uppercase;letter-spacing:.06em;color:var(--muted)}
    tbody tr{background:linear-gradient(var(--card),var(--card)) padding-box, radial-gradient(120% 100% at 0 0,rgba(118,176,151,.13),transparent 40%) border-box;
      border:1px solid var(--line);border-radius:12px;
      transition:all 0.2s ease;
    }
    tbody tr:hover{
      background:linear-gradient(var(--card),var(--card)) padding-box, radial-gradient(120% 100% at 0 0,rgba(118,176,151,.18),transparent 40%) border-box;
      transform:translateY(-1px);
      box-shadow:0 4px 12px rgba(118,176,151,.08);
    }
    tbody td:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
    tbody td:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}
    code,.badge{
      font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,Monaco,monospace;
      font-size:.92em;border-radius:6px;padding:.08em .35em;background:rgba(118,176,151,.08);
      transition:all 0.2s ease;
    }
    code:hover{
      background:rgba(118,176,151,.12);
    }
    .badge{background:rgba(118,176,151,.12);border:1px solid rgba(118,176,151,.25);color:var(--brand-600); font-weight:700}
    /* Collapsible sections */
    details{
      border:1px solid var(--line);border-radius:14px;background:var(--card);margin:12px 0;box-shadow:var(--shadow);
      transition:all 0.2s ease;
    }
    details:hover{
      box-shadow:var(--shadow-hover);
    }
    details>summary{
      cursor:pointer;list-style:none;padding:14px 16px;font-weight:700;display:flex;align-items:center;gap:10px;
      transition:all 0.2s ease;
    }
    details>summary:hover{
      background:rgba(118,176,151,.05);
      border-radius:14px 14px 0 0;
    }
    details>summary::before{
      content:"";width:18px;height:18px;flex:0 0 18px;border-radius:50%;
      background:conic-gradient(var(--accent) 25%, transparent 0 100%);mask:radial-gradient(circle 8px, transparent 7px,#000 8px);
      transition:transform .25s ease
    }
    details[open]>summary::before{transform:rotate(90deg)}
    details .content{padding:2px 16px 16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:start}
    @media (max-width:900px){.row{grid-template-columns:1fr}}
    
    /* Deck layout for filters */
    .deck-example{
      margin-bottom:32px;
    }
    .deck-example h4{
      margin:0 0 16px 0;
      color:var(--brand-600);
      font-size:16px;
      font-weight:700;
    }
    .deck-parameters{
      margin-top:32px;
    }
    .deck-parameters h4{
      margin:0 0 20px 0;
      color:var(--brand-600);
      font-size:18px;
      font-weight:700;
      border-bottom:2px solid var(--brand-100);
      padding-bottom:12px;
    }
    .filters-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));
      gap:24px;
    }
    .filter-category{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:20px;
      box-shadow:0 4px 12px rgba(118,176,151,.08);
      transition:transform 0.2s ease, box-shadow 0.2s ease;
    }
    .filter-category:hover{
      transform:translateY(-2px);
      box-shadow:0 8px 24px rgba(118,176,151,.12);
    }
    .filter-category h5{
      margin:0 0 16px 0;
      color:var(--brand-700);
      font-size:14px;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:.05em;
      border-bottom:1px solid var(--brand-100);
      padding-bottom:8px;
    }
    .filter-category ul{
      margin:0;
      padding:0;
      list-style:none;
    }
    .filter-category li{
      padding:6px 0;
      font-size:13px;
      line-height:1.5;
      border-bottom:1px solid rgba(118,176,151,.05);
    }
    .filter-category li:last-child{
      border-bottom:none;
    }
    .filter-category code{
      background:rgba(118,176,151,.08);
      color:var(--brand-700);
      font-weight:600;
      padding:2px 6px;
      border-radius:4px;
    }
    @media (max-width:900px){
      .filters-grid{
        grid-template-columns:1fr;
        gap:16px;
      }
      .filter-category{
        padding:16px;
      }
    }
    /* Code blocks */
    pre{
      background:var(--code-bg);color:var(--code);border-radius:14px;
      padding:14px 12px;overflow:auto;border:1px solid #121826;
      position:relative;
    }
    .code-tabs{
      border:1px solid var(--line); 
      border-radius:14px; 
      overflow:hidden; 
      box-shadow:var(--shadow);
      position:relative;
    }
    .tab-panel{
      position:relative;
    }
    .tab-bar{display:flex;background:linear-gradient(180deg,#ffffff, #f5f7fb);border-bottom:1px solid var(--line)}
    @media (prefers-color-scheme: dark){.tab-bar{background:linear-gradient(180deg,#0F1722,#0c1421)}}
    .tab-bar button{
      all:unset;cursor:pointer;padding:10px 14px;font-weight:700;font-size:13px;
      color:var(--muted);
    }
    .tab-bar button.active{color:var(--text);border-bottom:2px solid var(--accent)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .code-actions{
      display:flex;justify-content:flex-end;gap:8px;
      margin:-12px 12px 12px 0;
      position:relative;
      z-index:10;
    }
    .copy{
      all:unset;cursor:pointer;
      background:rgba(118,176,151,.12);
      border:1px solid rgba(118,176,151,.3);
      padding:8px 12px;border-radius:8px;font-weight:600;
      font-size:12px;color:#ffffff;
      transition:all 0.2s ease;
      position:relative;
      backdrop-filter:blur(8px);
      box-shadow:0 2px 8px rgba(118,176,151,.15);
    }
    .copy:hover{
      background:rgba(118,176,151,.18);
      border-color:var(--brand-400);
      transform:translateY(-1px);
      box-shadow:0 4px 12px rgba(118,176,151,.2);
    }
    .copy.success{
      border-color:var(--brand-500);
      color:#ffffff;
      background:rgba(118,176,151,.15);
      box-shadow:0 2px 8px rgba(118,176,151,.25);
    }
    
    /* Floating copy button */
    .copy-floating{
      position:absolute !important;
      top:8px;
      right:8px;
      z-index:20;
      margin:0 !important;
    }
    
    /* Special positioning for tab panels */
    .tab-panel .copy-floating{
      top:6px;
      right:6px;
    }
    /* Footer */
    .footer{
      text-align:center;color:var(--muted);font-size:12px;margin-top:26px
    }
    .kdb{border:1px solid var(--line);border-bottom-width:3px;border-radius:8px;padding:.1em .5em;font-weight:700}
    .hero-badge{
      display:inline-flex;gap:8px;align-items:center;background:var(--brand-50);color:var(--brand-700);
      border:1px solid var(--brand-300);padding:6px 10px;border-radius:999px;margin-top:6px;
      transition:all 0.2s ease;
    }
    .hero-badge:hover{
      background:var(--brand-100);
      transform:scale(1.02);
      box-shadow:0 4px 12px rgba(118,176,151,.15);
    }
    .inline-help{font-size:13px;color:var(--muted)}
    .sep{height:1px;background:var(--line);margin:12px 0}
    
    /* Additional visual enhancements */
    .tab-bar button{
      transition:all 0.2s ease;
    }
    .tab-bar button:hover{
      background:rgba(118,176,151,.08);
    }
    
    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }
    
    /* Enhanced focus states */
    a:focus, button:focus, input:focus {
      outline: 2px solid var(--brand-400);
      outline-offset: 2px;
    }
    
    /* Loading animation for better UX */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .loading {
      animation: pulse 2s infinite;
    }
    
    /* Enhanced code blocks */
    pre {
      position: relative;
      overflow-x: auto;
    }
    
    /* Better mobile responsiveness */
    /* Medium screens */
    @media (max-width: 1200px) and (min-width: 769px) {
      .container {
        grid-template-columns: minmax(240px, 280px) 1fr;
        gap: 20px;
      }
      
      .toc {
        padding: 18px;
        max-height: calc(100vh - 40px);
        top: 20px;
      }
      
      .toc a {
        padding: 7px 10px;
        font-size: 13px;
      }
    }
    
    /* Small screens */
    @media (max-width: 768px) {
      .topbar-inner {
        grid-template-columns: 1fr;
        gap: 16px;
        padding: 16px 12px;
      }
      
      .header-left {
        justify-content: center;
        text-align: center;
      }
      
      .header-right {
        align-items: center;
      }
      
      .searchbar {
        max-width: 100%;
      }
      
      .actions {
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .logo {
        width: 60px;
        height: 60px;
      }
      
      .title strong {
        font-size: 20px;
      }
      
      .title small {
        font-size: 13px;
      }
      
      .toc {
        top: 20px;
        padding: 16px;
        max-height: calc(100vh - 40px);
        position: sticky;
      }
      
      .toc a {
        padding: 6px 10px;
        font-size: 13px;
      }
      
      .toc .sub {
        padding-left: 12px;
        margin-left: 6px;
      }
      
      .container {
        grid-template-columns: 1fr;
        padding: 8px 12px 60px;
        gap: 16px;
      }
      
      .card {
        padding: 16px;
        margin-bottom: 12px;
      }
      
      h1 { font-size: 28px; }
      h2 { font-size: 22px; }
      h3 { font-size: 18px; }
    }

    /* Enhanced section transitions and hover effects */
    .card, details, section {
      transition: all 0.3s ease;
      position: relative;
    }
    
    .card:hover, details:hover, section:hover {
      transform: translateY(-1px);
    }
    
    /* Smooth scroll behavior */
    html {
      scroll-behavior: smooth;
    }

    /* Floating toggle sections button */
    .floating-toggle {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--brand);
      color: white;
      border: none;
      box-shadow: 0 4px 16px rgba(118,176,151,.3), 0 2px 8px rgba(118,176,151,.2);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      transition: all 0.3s ease;
      z-index: 1000;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.2);
    }

    .floating-toggle:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 6px 20px rgba(118,176,151,.4), 0 4px 12px rgba(118,176,151,.3);
      background: var(--brand-600);
    }

    .floating-toggle:active {
      transform: translateY(0) scale(0.95);
    }

    /* Dark mode adjustments */
    @media (prefers-color-scheme: dark) {
      .floating-toggle {
        box-shadow: 0 4px 16px rgba(0,0,0,.4), 0 2px 8px rgba(0,0,0,.3);
        border: 1px solid rgba(255,255,255,.1);
      }
      
      .floating-toggle:hover {
        box-shadow: 0 6px 20px rgba(0,0,0,.5), 0 4px 12px rgba(0,0,0,.4);
      }
    }

    .dark .floating-toggle {
      box-shadow: 0 4px 16px rgba(0,0,0,.4), 0 2px 8px rgba(0,0,0,.3);
      border: 1px solid rgba(255,255,255,.1);
    }
    
    .dark .floating-toggle:hover {
      box-shadow: 0 6px 20px rgba(0,0,0,.5), 0 4px 12px rgba(0,0,0,.4);
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="header-left">
      <img class="logo" alt="OTI du Sud" src="https://supabertel.otisud.re/storage/v1/object/public/logo//logo200X200.png">
      <div class="title">
        <strong>OTI du SUD · API</strong>
        <small>Documentation complète & bonnes pratiques</small>
      </div>
      </div>
      <div class="header-right">
        <div class="searchbar">
          <input id="globalSearch" type="search" placeholder="Rechercher dans la doc (endpoints, paramètres, champs…)">
        </div>
      <div class="actions">
        <span class="chip" title="Version de la page">v1</span>
          <button class="btn" id="toggleTheme" title="Basculer mode clair/sombre"><span id="themeText">Light</span> ▾</button>
          <button class="btn" id="toggleSections" title="Déplier/Replier toutes les sections">▾ Ouvrir tout</button>
      </div>
    </div>
    </div>
  </header>

  <main class="container" id="container">
    <!-- TOC -->
    <nav class="toc" id="toc">
      <h3>Sommaire</h3>
      <!-- auto-filled -->
    </nav>

    <!-- CONTENT -->
    <div id="content">
      <section class="card" id="intro">
        <h1>Documentation de l’API</h1>
        <p class="lead">Une API structurée autour d'appels <code>/rpc/&lt;nom_fonction&gt;</code> via <b>POST</b>, avec pagination, filtres riches et extraction des tracés KML/GPX pour les itinéraires.</p>
      </section>

      <!-- 1) Auth & conventions -->
      <section class="card" id="auth">
        <h2>1) Authentification & conventions</h2>

        <details open>
          <summary>1.1 Méthodes d'authentification</summary>
          <div class="content">
            <p>L'API Bertel v3 supporte plusieurs méthodes d'authentification selon votre contexte d'utilisation :</p>
            
            <h3>JWT (Recommandée pour les applications)</h3>
            <p>Pour les applications web/mobile avec utilisateurs connectés :</p>
            <div class="code-block">
              <pre><code>Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...</code></pre>
            </div>
            <p><strong>Avantages :</strong> Accès aux données étendues selon les rôles utilisateur, sécurité maximale.</p>
            
            <h3>Clé API (Service-to-Service)</h3>
            <p>Pour les intégrations serveur-à-serveur :</p>
            <div class="code-block">
              <pre><code>apikey: bertel_sk_1234567890abcdef</code></pre>
            </div>
            <p><strong>Avantages :</strong> Accès complet aux données publiques, idéal pour les synchronisations automatiques.</p>
            
            <h3>Accès anonyme (Lecture seule)</h3>
            <p>Pour les données publiques uniquement :</p>
            <div class="code-block">
              <pre><code>apikey: &lt;SUPABASE_ANON_KEY&gt;
Authorization: Bearer &lt;SUPABASE_ANON_KEY&gt;</code></pre>
            </div>
            <p><strong>Important :</strong> même en accès anonyme, Supabase/PostgREST exige ces en-têtes pour router la requête. Utilisez la clé publique (anon) fournie par votre projet Supabase.</p>
            <p><strong>Limitations :</strong> Seules les données publiques (<code>status = 'published'</code>) sont accessibles.</p>
          </div>
        </details>

        <details>
          <summary>1.2 En-têtes HTTP requis</summary>
          <div class="content">
            <p>Chaque requête doit inclure :</p>
            <ul>
              <li><code>Content-Type: application/json</code></li>
              <li><code>Accept: application/json</code></li>
              <li>Vos en-têtes d'authentification selon votre méthode choisie (voir ci-dessus)</li>
            </ul>
            
            <h3>Exemple complet de requête</h3>
            <div class="code-block">
              <pre><code>curl -X POST "https://api.bertel.re/rpc/get_object_resource" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{"p_object_id": "HOTTST0000000001"}'</code></pre>
            </div>
            <p class="inline-help"><strong>Remplacez</strong> <code>{SUPABASE_ANON_KEY}</code> par la clé publique (anon) de votre projet Supabase. Pour les appels serveur à serveur, utilisez la clé service et un token approprié.</p>
          </div>
        </details>

        <details>
          <summary>1.3 Niveaux d'accès aux données</summary>
          <div class="content">
            <p>Selon votre méthode d'authentification, vous avez accès à différents niveaux de données :</p>
            
            <table>
              <thead>
                <tr><th>Méthode</th><th>Données publiques</th><th>Données étendues</th><th>Données privées</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>Anonyme</strong></td>
                  <td>✅ Objets publiés uniquement</td>
                  <td>❌ Non</td>
                  <td>❌ Non</td>
                </tr>
                <tr>
                  <td><strong>Clé API</strong></td>
                  <td>✅ Tous les objets</td>
                  <td>✅ Selon les rôles</td>
                  <td>❌ Non</td>
                </tr>
                <tr>
                  <td><strong>JWT (Utilisateur)</td>
                  <td>✅ Tous les objets</td>
                  <td>✅ Si acteur de l'organisation</td>
                  <td>✅ Si acteur de l'organisation</td>
                </tr>
              </tbody>
            </table>
            
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Données étendues</div>
              <p>Les <strong>données étendues</strong> incluent : descriptions privées, contacts non-publics, médias non-publiés, informations légales, réductions, politiques de groupe.</p>
            </div>
            
            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Sécurité</div>
              <p>L'accès aux données étendues/privées nécessite que l'utilisateur soit lié à l'organisation propriétaire de l'objet via son adresse email dans <code>actor_channel</code>.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>1.4 Gestion des erreurs d'authentification</summary>
          <div class="content">
            <p>L'API retourne des codes d'erreur spécifiques pour les problèmes d'authentification :</p>
            
            <table>
              <thead>
                <tr><th>Code HTTP</th><th>Message</th><th>Cause</th><th>Solution</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>401</code></td>
                  <td>Unauthorized</td>
                  <td>Token JWT invalide ou expiré</td>
                  <td>Renouveler le token ou se reconnecter</td>
                </tr>
                <tr>
                  <td><code>403</code></td>
                  <td>Forbidden</td>
                  <td>Clé API invalide ou droits insuffisants</td>
                  <td>Vérifier la clé API ou les permissions</td>
                </tr>
                <tr>
                  <td><code>429</code></td>
                  <td>Too Many Requests</td>
                  <td>Limite de taux dépassée</td>
                  <td>Attendre ou implémenter un backoff</td>
                </tr>
              </tbody>
            </table>
            
            <h3>Exemple de réponse d'erreur</h3>
            <div class="code-block">
              <pre><code>{
  "code": "PGRST301",
  "message": "JWT expired",
  "hint": "Refresh your token and try again"
}</code></pre>
            </div>
          </div>
        </details>

        <details open>
          <summary>1.5 Convention d'appel</summary>
          <div class="content">
            <p><b>Méthode</b> : <code>POST</code><br>
              <b>Chemin</b> : <code>/rpc/&lt;nom_fonction&gt;</code></p>
            <p>Exemples : <code>/rpc/get_object_resource</code> • <code>/rpc/list_object_resources_page</code> • <code>/rpc/list_object_resources_since_fast</code> • <code>/rpc/list_object_resources_filtered_page</code> • <code>/rpc/list_object_resources_filtered_since_fast</code></p>
            <p><b>Corps</b> : JSON avec paramètres nommés (voir chaque endpoint).</p>
          </div>
        </details>

        <details open>
          <summary>1.6 Types de base (comment lire les réponses)</summary>
          <div class="content">
              <table>
                <thead><tr><th>Type</th><th>Description</th></tr></thead>
                <tbody>
                  <tr><td><code>string</code></td><td>Texte (ex. <code>"Hôtel du Parc"</code>).</td></tr>
                  <tr><td><code>number</code></td><td>Nombre (ex. <code>12</code>, <code>3.14</code>).</td></tr>
                  <tr><td><code>boolean</code></td><td><code>true</code> / <code>false</code>.</td></tr>
                  <tr><td><code>timestamp</code></td><td>Date-heure ISO 8601 en UTC (ex. <code>"2024-03-18T09:30:00Z"</code>).</td></tr>
                  <tr><td><code>enum</code> (code)</td><td>Valeur codée (ex. <code>"image"</code>, <code>"ITI"</code>, <code>"published"</code>).</td></tr>
                  <tr><td><code>array</code></td><td>Liste (ex. <code>["fr","en"]</code>).</td></tr>
                  <tr><td><code>object</code></td><td>Sous-ensemble structuré avec ses propres champs.</td></tr>
                </tbody>
              </table>
            <div class="card tip-card" style="margin-top: 20px;">
              <div class="pill tip-pill">Astuce</div>
              <p class="lead tip-text">Les champs absents pour un objet sont renvoyés comme <code>[]</code>, <code>{}</code> ou <code>null</code> selon le bloc : pas d'exception.</p>
            </div>
          </div>
        </details>

        <details open id="object-types-codes">
          <summary>1.7 Codes de types d'objets (p_types / p_object_type)</summary>
          <div class="content">
            <p>Les endpoints d’énumération et de recherche acceptent un ou plusieurs codes de type d’objet via <code>p_types</code> (ou <code>p_object_type</code> selon la fonction). Liste des codes disponibles :</p>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Usage principal</th><th>Informations clés pour le voyageur</th></tr></thead>
              <tbody>
                <tr><td><code>ORG</code></td><td>Organisation</td><td>OTI/CRT, gestion et publication</td><td><code>contacts</code> (tél, email, site), <code>opening_times</code>, <code>location</code>, <code>descriptions</code>, <code>media</code></td></tr>
                <tr><td><code>HOT</code></td><td>Hôtel</td><td>Hébergement hôtelier</td><td><code>prices</code> (gammes/périodes), <code>amenities</code> (wifi, parking, breakfast), <code>capacity</code> (chambres), <code>classifications</code> (étoiles, éco-labels)</td></tr>
                <tr><td><code>HPA</code></td><td>Hébergement particulier</td><td>Gîte / meublé</td><td><code>prices</code>, <code>amenities</code> (cuisine, lave-linge, parking), <code>capacity</code>, <code>classifications</code> (épis Gîtes de France)</td></tr>
                <tr><td><code>HLO</code></td><td>Hébergement loisir</td><td>Résidences / villages</td><td><code>amenities</code> (piscine, spa, kids_club), <code>prices</code>, <code>capacity</code>, <code>classifications</code> (étoiles, labels)</td></tr>
                <tr><td><code>CAMP</code></td><td>Camping</td><td>Terrain de camping</td><td><code>capacity</code> (emplacements, tentes, camping-cars), <code>amenities</code> (sanitaires, électricité, eau), <code>prices</code>, <code>opening_times</code></td></tr>
                <tr><td><code>RES</code></td><td>Restaurant</td><td>Restauration</td><td><code>opening_times</code> (service midi/soir), <code>menus</code> (plats/prix), <code>cuisine_types</code>/<code>dietary_tags</code>/<code>allergens</code>, <code>contacts</code> (réservation)</td></tr>
                <tr><td><code>FMA</code></td><td>Festival / Manifestation</td><td>Événements</td><td><code>fma</code> & <code>fma_occurrences</code> (dates/horaires), <code>location</code>, ticket/prix, <code>descriptions</code>/<code>media</code></td></tr>
                <tr><td><code>ITI</code></td><td>Itinéraire</td><td>Parcours & tracés</td><td><code>itinerary</code> (distance, durée, difficulté, dénivelé), <code>itinerary_details</code> (info, parking, équipement), <code>track</code> (KML/GPX), étapes</td></tr>
                <tr><td><code>VIL</code></td><td>Village</td><td>Entité territoriale</td><td><code>location</code>/<code>descriptions</code> (pourquoi visiter), <code>environment_tags</code> (plage, montagne, patrimoine), <code>relations</code> (POI proches)</td></tr>
                <tr><td><code>PCU</code></td><td>Point culture urbaine</td><td>Arts, expositions</td><td><code>location</code>, <code>descriptions</code> (expo/thème), <code>opening_times</code>, <code>media</code></td></tr>
                <tr><td><code>PNA</code></td><td>Point nature aventure</td><td>Randonnée, outdoor</td><td><code>location</code> (départ/spot), <code>descriptions</code> (activité, consignes), <code>opening_times</code>, <code>amenities</code> (parking, eau)</td></tr>
                <tr><td><code>ASC</code></td><td>Association</td><td>Structure associative</td><td><code>contacts</code> (participation/adhésion), <code>descriptions</code>, <code>opening_times</code> (accueil), <code>location</code></td></tr>
                <tr><td><code>COM</code></td><td>Commerce</td><td>Boutique / retail</td><td><code>opening_times</code>, <code>amenities</code> (accessibilité, parking), <code>classifications</code>/<code>tags</code> (retail), <code>payment_methods</code></td></tr>
                <tr><td><code>PSV</code></td><td>Service public</td><td>Toilettes publiques, eau potable, bornes EV</td><td><code>opening_times</code> (24/7 ou horaires), type (<code>public_toilets</code>/<code>drinking_water</code>/<code>electric_charging</code>), accessibilité, coût</td></tr>
                <tr><td><code>RVA</code></td><td>Aire camping‑car</td><td>Aire de stationnement vans/camping‑cars</td><td><code>capacity</code> (véhicules, camping-cars, emplacements), <code>amenities</code> (électricité, eau, vidange), <code>opening_times</code>/<code>stay_limits</code>, tarifs</td></tr>
              </tbody>
            </table>
            <p class="inline-help">Exemples : <code>"p_types": ["PSV"]</code> pour lister uniquement les services publics • <code>"p_types": ["RVA","CAMP"]</code> pour aires et campings.</p>
          </div>
        </details>
      </section>

      <!-- 2) Endpoints -->
      <section class="card" id="endpoints">
        <h2>2) Endpoints</h2>

        <div class="card" id="postman-collection" style="background: linear-gradient(135deg, rgba(118,176,151,.1), rgba(118,176,151,.05)); border: 1px solid rgba(118,176,151,.2); margin-bottom: 24px;">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
            <div style="background: rgba(118,176,151,.15); padding: 8px; border-radius: 12px; color: var(--brand-700); font-size: 20px;">🚀</div>
            <h3 style="margin: 0; color: var(--brand-700);">Collection Postman disponible</h3>
          </div>
          <p style="margin-bottom: 16px; color: var(--text);">Testez l'API directement avec notre collection Postman complète, incluant tous les endpoints, exemples et tests automatiques.</p>
          <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
            <a href="https://www.postman.com/docking-module-astronaut-45890211/oti-du-sud-bertel-v3/collection/61gyd5k/bertel-api-v3-0?action=share&creator=24615556" 
               target="_blank" 
               style="background: var(--brand); color: white; padding: 12px 20px; border-radius: 12px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(118,176,151,.3);">
              <span>📦</span>
              Ouvrir dans Postman
            </a>
            <div style="font-size: 14px; color: var(--muted); display: flex; align-items: center; gap: 6px;">
              <span>✨</span>
              <span>Collection publique • Tests automatiques • Variables d'environnement</span>
            </div>
          </div>
        </div>

        <!-- 2.1 get_object_resource -->
        <details open id="get_object_resource">
          <summary>2.1 Récupérer une ressource : <code>get_object_resource</code></summary>
          <div class="content">
            <p><b>But</b> — Obtenir toutes les données d’un objet (et, si demandé, son tracé <b>KML/GPX</b> pour un itinéraire).</p>

            <h3>Paramètres (JSON)</h3>
            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Obligatoire</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_object_id</code></td><td><code>string</code></td><td>✅</td><td>—</td><td>Identifiant de la ressource à lire.</td></tr>
                <tr><td><code>p_lang_prefs</code></td><td><code>array&lt;string&gt;</code></td><td>❌</td><td><code>["fr"]</code></td><td>Préférences de langue (ordre de priorité).</td></tr>
                <tr><td><code>p_track_format</code></td><td><code>enum</code> <code>"none" | "kml" | "gpx"</code></td><td>❌</td><td><code>"none"</code></td><td>Tracé : par défaut aucun. Mettez <code>"kml"</code> ou <code>"gpx"</code> (type ITI).</td></tr>
                <tr><td><code>p_options</code></td><td><code>object</code></td><td>❌</td><td><code>{}</code></td><td>Options avancées (voir détails ci-dessous).</td></tr>
              </tbody>
            </table>

            <details>
              <summary><b>p_options</b> — options avancées</summary>
              <div class="content">
                <table>
                  <thead><tr><th>Option</th><th>Type</th><th>Défaut</th><th>Description</th></tr></thead>
                  <tbody>
                    <tr><td><code>include_stages</code></td><td><code>boolean</code></td><td><code>true</code></td><td>Inclure les étapes dans le tracé KML/GPX.</td></tr>
                    <tr><td><code>stage_color</code></td><td><code>string</code></td><td><code>"red"</code></td><td>Couleur des étapes (KML uniquement).</td></tr>
                    <tr><td><code>render</code></td><td><code>boolean</code></td><td><code>true</code></td><td>Générer le bloc <code>render</code> avec données formatées.</td></tr>
                    <tr><td><code>render_locale</code></td><td><code>string</code></td><td><code>auto</code></td><td>Locale pour le formatage (ex. "fr-FR").</td></tr>
                    <tr><td><code>render_tz</code></td><td><code>string</code></td><td><code>"UTC"</code></td><td>Fuseau horaire pour le formatage.</td></tr>
                    <tr><td><code>render_version</code></td><td><code>string</code></td><td><code>"1.0"</code></td><td>Version du formatage.</td></tr>
                    <tr><td><code>fields</code></td><td><code>array&lt;string&gt;</code></td><td><code>null</code></td><td>Limiter les champs retournés (ex. ["id", "name", "contacts"]).</td></tr>
                    <tr><td><code>include</code></td><td><code>array&lt;string&gt;</code></td><td><code>null</code></td><td>Inclure des blocs optionnels (ex. ["render", "actors"]).</td></tr>
                    <tr><td><code>org_object_id</code></td><td><code>string</code></td><td><code>auto</code></td><td>Préférence d'organisation pour les descriptions.</td></tr>
                    <tr><td><code>include_private</code></td><td><code>boolean</code></td><td><code>false</code></td><td>Inclure les données privées (nécessite permissions).</td></tr>
                  </tbody>
                </table>
                <div class="card tip-card" style="margin-top: 16px;">
                  <div class="pill tip-pill">Exemple</div>
                  <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "p_object_id": "HOT123",
  "p_lang_prefs": ["fr", "en"],
  "p_track_format": "kml",
  "p_options": {
    "include_stages": true,
    "stage_color": "blue",
    "render": true,
    "render_locale": "fr-FR",
    "fields": ["id", "name", "contacts", "media"],
    "org_object_id": "ORG456"
  }
}</code></pre>
                </div>
              </div>
            </details>

            <details>
              <summary>Important (tracé ITI)</summary>
              <div class="content">
                <ul>
                  <li>Par défaut : <code>p_track_format = "none"</code> → aucun tracé dans la réponse.</li>
                  <li>Si <code>"kml"</code> ou <code>"gpx"</code> :
                    <ul>
                      <li><code>include_stages</code> contrôle l’ajout des étapes.</li>
                      <li><b>KML</b> : si <code>include_stages=true</code>, vous pouvez régler <code>stage_color</code> (ex. <code>"red"</code>, <code>"blue"</code>, <code>"green"</code>, <code>"orange"</code>, <code>"purple"</code>, <code>"black"</code>, <code>"white"</code>, <code>"yellow"</code>, <code>"cyan"</code>, <code>"magenta"</code>, <code>"gray"</code>, <code>#RRGGBB</code> ou <code>AABBGGRR</code>).</li>
                      <li><b>GPX</b> : <code>stage_color</code> est ignoré (waypoints “Flag, Red”).</li>
                    </ul>
                  </li>
                </ul>
              </div>
            </details>

            <h3>Exemples d’appel</h3>
            <div class="code-tabs" data-tabs>
              <div class="tab-bar">
                <button class="active" data-tab="curl">cURL</button>
                <button data-tab="js">JavaScript (fetch)</button>
              </div>
              <div class="tab-panel active" data-panel="curl">
                <button class="copy copy-floating" data-copy="#ex-gor-curl">Copier</button>
<pre id="ex-gor-curl">curl -X POST "{BASE_URL}/rpc/get_object_resource" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_object_id": "ITI123",
    "p_lang_prefs": ["fr","en"],
    "p_track_format": "kml",
    "p_options": { "include_stages": true, "stage_color": "blue" }
  }'</pre>
              </div>
              <div class="tab-panel" data-panel="js">
                <button class="copy copy-floating" data-copy="#ex-gor-js">Copier</button>
<pre id="ex-gor-js">const res = await fetch(`${BASE_URL}/rpc/get_object_resource`, {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "Accept": "application/json",
    "apikey": SUPABASE_ANON_KEY,
    "Authorization": `Bearer ${SUPABASE_ANON_KEY}`
  },
  body: JSON.stringify({
    p_object_id: "ITI123",
    p_lang_prefs: ["fr","en"],
    p_track_format: "none" // pas de tracé par défaut
  })
});
const json = await res.json();</pre>
              </div>
            </div>
          </div>
        </details>

        <!-- 2.2 list_object_resources_page -->
        <details id="list_object_resources_page">
          <summary>2.2 Lister (pagination page/offset) : <code>list_object_resources_page</code></summary>
          <div class="content">
            <p><b>But</b> — Lister des ressources avec pagination simple (offset/page), filtrées par type, statut, recherche. <b class="badge">Par défaut, pas de tracé</b>.</p>
            <h3>Paramètres (JSON)</h3>
            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Obligatoire</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_cursor</code></td><td><code>string</code></td><td>❌</td><td><code>null</code></td><td>Curseur opaque renvoyé par l’appel précédent.</td></tr>
                <tr><td><code>p_lang_prefs</code></td><td><code>array&lt;string&gt;</code></td><td>❌</td><td><code>["fr"]</code></td><td>Préférences de langue.</td></tr>
                <tr><td><code>p_page_size</code></td><td><code>number</code></td><td>❌</td><td><code>50</code></td><td>1 à 200.</td></tr>
                <tr><td><code>p_types</code></td><td><code>array&lt;enum&gt;</code></td><td>❌</td><td><code>null</code></td><td>Restreindre aux types demandés (ex. <code>["ITI"]</code>).</td></tr>
                <tr><td><code>p_status</code></td><td><code>array&lt;enum&gt;</code></td><td>❌</td><td><code>["published"]</code></td><td>Statuts acceptés.</td></tr>
                <tr><td><code>p_search</code></td><td><code>string</code></td><td>❌</td><td><code>null</code></td><td>Terme de recherche (nom normalisé ; insensible aux accents & casse).</td></tr>
                <tr><td><code>p_track_format</code></td><td><code>"none" | "kml" | "gpx"</code></td><td>❌</td><td><code>"none"</code></td><td></td></tr>
                <tr><td><code>p_include_stages</code></td><td><code>boolean</code></td><td>❌</td><td><code>null</code></td><td>Si vous demandez un tracé KML/GPX, inclure les étapes ?</td></tr>
                <tr><td><code>p_stage_color</code></td><td><code>string</code></td><td>❌</td><td><code>null</code></td><td>Couleur des étapes (KML uniquement) si <code>include_stages=true</code>.</td></tr>
                <tr><td><code>p_omit_empty</code></td><td><code>boolean</code></td><td>❌</td><td><code>false</code></td><td>Supprimer les tableaux/objets vides du niveau supérieur (ex. <code>actors</code>, <code>legal_records</code>, <code>meeting_rooms</code>).</td></tr>
              </tbody>
            </table>

            <h3>Réponse</h3>
<pre>{
  "info": {
    "kind": "page",
    "language": "fr",
    "language_fallbacks": ["fr","en"],
    "page_size": 50,
    "offset": 0,
    "total": 1234,
    "cursor": "&lt;opaque&gt;",
    "next_cursor": "&lt;opaque or null&gt;"
  },
  "data": [ /* ressources */ ]
}</pre>

            <h3>Flux d’usage</h3>
            <ol>
              <li>Premier appel sans <code>p_cursor</code>.</li>
              <li>Lisez <code>info.next_cursor</code>.</li>
              <li>Rappelez en passant <code>p_cursor</code> pour la page suivante, etc.</li>
            </ol>

            <h3>Exemple (cURL)</h3>
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-page-curl">Copier</button>
<pre id="ex-page-curl">curl -X POST "{BASE_URL}/rpc/list_object_resources_page" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_page_size": 20,
    "p_types": ["ITI"],
    "p_status": ["published"],
    "p_search": "crêtes",
    "p_track_format": "none"
  }'</pre>
            </div>

            <h3>Mode de nettoyage (omit_empty)</h3>
            <p>Le paramètre <code>p_omit_empty</code> permet de réduire la taille des réponses en supprimant automatiquement les blocs de données vides au niveau supérieur de chaque ressource.</p>
            
            <h4>Comment l'utiliser</h4>
            <p>Passez <code>p_omit_empty: true</code> dans l'endpoint de pagination :</p>
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-omit-empty">Copier</button>
<pre id="ex-omit-empty">curl -X POST "{BASE_URL}/rpc/list_object_resources_page" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_page_size": 2,
    "p_omit_empty": true
  }'</pre>
            </div>
            
            <p>Le paramètre est également préservé dans le curseur et propagé automatiquement aux appels suivants.</p>

            <h4>Ce qui est supprimé</h4>
            <p>Quand <code>omit_empty</code> est activé, les blocs suivants sont supprimés s'ils sont vides :</p>
            <ul>
              <li><code>actors[]</code> — Personnes liées à l'objet</li>
              <li><code>legal_records[]</code> — Documents légaux</li>
              <li><code>meeting_rooms[]</code> — Salles de réunion</li>
              <li><code>fma[]</code> — Événements FMA</li>
              <li><code>fma_occurrences[]</code> — Occurrences d'événements</li>
            </ul>
            
            <p><strong>Note :</strong> Les blocs <code>opening_times</code> et <code>render</code> sont toujours conservés, même s'ils sont vides.</p>
          </div>
        </details>

        <!-- 2.3 since keyset -->
        <details id="list_object_resources_since_fast">
          <summary>2.3 Lister depuis une date (keyset) : <code>list_object_resources_since_fast</code></summary>
          <div class="content">
            <p><b>But</b> — Synchroniser <i>ce qui a changé depuis un instant T</i> (robuste pendant les mises à jour).</p>

            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Obligatoire</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_since</code></td><td><code>timestamp</code></td><td>✅</td><td>—</td><td>Point de départ (UTC).</td></tr>
                <tr><td><code>p_cursor</code></td><td><code>string</code></td><td>❌</td><td><code>null</code></td><td>Curseur opaque.</td></tr>
                <tr><td><code>p_use_source</code></td><td><code>boolean</code></td><td>❌</td><td><code>false</code></td><td>Utiliser la date de mise à jour source plutôt que technique.</td></tr>
                <tr><td><code>p_lang_prefs</code></td><td><code>array&lt;string&gt;</code></td><td>❌</td><td><code>["fr"]</code></td><td>Préférences de langue.</td></tr>
                <tr><td><code>p_limit</code></td><td><code>number</code></td><td>❌</td><td><code>50</code></td><td>1 à 200.</td></tr>
                <tr><td><code>p_types / p_status / p_search</code></td><td>—</td><td>❌</td><td>—</td><td>Comme §2.2.</td></tr>
                <tr><td><code>p_track_format / p_include_stages / p_stage_color</code></td><td>—</td><td>❌</td><td>—</td><td>Comme §2.2 (par défaut, pas de tracé).</td></tr>
                <tr><td><code>p_omit_empty</code></td><td><code>boolean</code></td><td>❌</td><td><code>false</code></td><td>Supprimer les tableaux/objets vides du niveau supérieur (ex. <code>actors</code>, <code>legal_records</code>, <code>meeting_rooms</code>).</td></tr>
              </tbody>
            </table>

            <h3>Réponse</h3>
<pre>{
  "info": {
    "kind": "since",
    "language": "fr",
    "language_fallbacks": ["fr"],
    "since": "2024-04-01T00:00:00Z",
    "use_source": false,
    "limit": 50,
    "cursor": "&lt;opaque&gt;",
    "next_cursor": "&lt;opaque or null&gt;"
  },
  "data": [ /* ressources modifiées/ajoutées depuis p_since */ ]
}</pre>

            <h3>Flux d’usage (sync incrémentale)</h3>
            <ol>
              <li>Appelez avec votre <code>p_since</code> (ex. dernière sync réussie).</li>
              <li>Tant que <code>next_cursor</code> n’est pas <code>null</code>, chaînez avec <code>p_cursor</code>.</li>
              <li>Enregistrez ensuite un nouveau “since” (ex. maintenant) pour la prochaine sync.</li>
            </ol>
          </div>
        </details>

        <!-- 2.4 filtered page -->
        <details id="list_object_resources_filtered_page">
          <summary>2.4 Lister avec filtres riches (page/offset) : <code>list_object_resources_filtered_page</code></summary>
          <div class="content">
            <p><b>But</b> — Même idée que §2.2, mais avec un JSON de filtres riches <code>p_filters</code>.</p>

            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Obligatoire</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_cursor / p_lang_prefs / p_page_size</code></td><td>—</td><td>❌</td><td>—</td><td>Comme §2.2</td></tr>
                <tr><td><code>p_filters</code></td><td><code>object</code></td><td>❌</td><td><code>{}</code></td><td>Filtres riches (voir ci-dessous).</td></tr>
                <tr><td><code>p_types / p_status / p_search</code></td><td>—</td><td>❌</td><td>—</td><td>Comme §2.2</td></tr>
                <tr><td><code>p_track_format / p_include_stages / p_stage_color</code></td><td>—</td><td>❌</td><td>—</td><td>Comme §2.2</td></tr>
                <tr><td><code>p_omit_empty</code></td><td><code>boolean</code></td><td>❌</td><td><code>false</code></td><td>Supprimer les tableaux/objets vides du niveau supérieur (ex. <code>actors</code>, <code>legal_records</code>, <code>meeting_rooms</code>).</td></tr>
              </tbody>
            </table>

            <details>
              <summary><b>p_filters</b> — possibilités & exemples</summary>
              <div class="content">
                <!-- Example in full width -->
                <div class="deck-example">
                  <h4>Exemple d'utilisation</h4>
                  <div style="position:relative;">
                    <button class="copy copy-floating" data-copy="#filters-example">Copier</button>
<pre id="filters-example">{
  "amenities_any": ["PARKING","WIFI"],
  "itinerary": { "is_loop": true, "distance_max_km": 15, "practices_any": ["hiking"] },
  "within_radius": { "lat": 45.76, "lon": 4.84, "radius_m": 20000 },
  "media_types_any": ["image"],
  "media_published_only": true,
  "media_must_have_main": true
}</pre>
                  </div>
                </div>
                
                <!-- Parameters on full width -->
                <div class="deck-parameters">
                  <h4>Paramètres disponibles</h4>
                  <div class="filters-grid">
                    <div class="filter-category">
                      <h5>Équipements & Services</h5>
                      <ul>
                        <li><code>amenities_any: string[]</code> — au moins un équipement</li>
                        <li><code>amenities_all: string[]</code> — tous ces équipements</li>
                        <li><code>amenity_families_any: string[]</code> — au moins une famille</li>
                        <li><code>pet_accepted: boolean</code> — animaux acceptés</li>
                      <li><code>payment_methods_any: string[]</code></li>
                      <li><code>environment_tags_any: string[]</code></li>
                      <li><code>languages_any: string[]</code></li>
                      </ul>
                    </div>
                    
                    <div class="filter-category">
                      <h5>Médias</h5>
                      <ul>
                      <li><code>media_types_any: string[]</code> — ex. <code>["image","video"]</code></li>
                      <li><code>media_published_only: boolean</code></li>
                      <li><code>media_must_have_main: boolean</code></li>
                      </ul>
                    </div>
                    
                    <div class="filter-category">
                      <h5>Capacité & Classement</h5>
                      <ul>
                      <li><code>capacity_filters: [{ code, min?, max? }]</code></li>
                      <li><code>classifications_any: [{ scheme_code, value_code }]</code></li>
                        <li><code>tags_any: string[]</code> — slugs</li>
                        <li><code>meeting_room</code> : { <i>min_count, min_area_m2, min_cap_theatre, min_cap_u, min_cap_classroom, min_cap_boardroom, equipment_any, equipment_all</i> }</li>
                      </ul>
                    </div>
                    
                    <div class="filter-category">
                      <h5>Géolocalisation</h5>
                      <ul>
                      <li><code>within_radius</code> : { <i>lat, lon, radius_m</i> }</li>
                      <li><code>bbox</code> : [minLon, minLat, maxLon, maxLat] (WGS84)</li>
                    </ul>
                  </div>
                    
                    <div class="filter-category">
                      <h5>Itinéraires</h5>
                      <ul>
                        <li><code>itinerary</code> : { <i>is_loop, difficulty_min/max, distance_min/max_km, duration_min/max_h, practices_any[]</i> }</li>
                      </ul>
                    </div>
                    
                    <div class="filter-category">
                      <h5>Disponibilité</h5>
                      <ul>
                        <li><code>open_now: boolean</code> — ouvert "maintenant"</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </details>
          </div>
        </details>

        <!-- 2.5 filtered since -->
        <details id="list_object_resources_filtered_since_fast">
          <summary>2.5 Filtres + depuis une date (keyset) : <code>list_object_resources_filtered_since_fast</code></summary>
          <div class="content">
            <p><b>But</b> — La combinaison de §2.3 (since/keyset) et §2.4 (filtres riches).</p>
            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Oblig.</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_since</code></td><td><code>timestamp</code></td><td>✅</td><td>—</td><td>Point de départ (UTC).</td></tr>
                <tr><td><code>p_cursor</code></td><td><code>string</code></td><td>❌</td><td><code>null</code></td><td>Curseur opaque.</td></tr>
                <tr><td><code>p_use_source</code></td><td><code>boolean</code></td><td>❌</td><td><code>false</code></td><td>Comme §2.3.</td></tr>
                <tr><td><code>p_lang_prefs</code></td><td><code>array&lt;string&gt;</code></td><td>❌</td><td><code>["fr"]</code></td><td>—</td></tr>
                <tr><td><code>p_limit</code></td><td><code>number</code></td><td>❌</td><td><code>50</code></td><td>1 à 200.</td></tr>
                <tr><td><code>p_filters</code></td><td><code>object</code></td><td>❌</td><td><code>{}</code></td><td>Comme §2.4.</td></tr>
                <tr><td><code>p_types / p_status / p_search</code></td><td>—</td><td>❌</td><td>—</td><td>—</td></tr>
                <tr><td><code>p_track_format / p_include_stages / p_stage_color</code></td><td>—</td><td>❌</td><td>—</td><td>—</td></tr>
              </tbody>
            </table>
            <p>Réponse : même forme que §2.3, avec <code>filters</code> propagés dans le curseur.</p>
          </div>
        </details>

        <!-- 2.6 Deep Data Functions -->
        <details id="deep_data_functions">
          <summary>2.6 Fonctions Deep Data : données enrichies en un appel</summary>
          <div class="content">
            <p><b>But</b> — Récupérer des objets avec leurs données en profondeur : objets parents, acteurs, organisations et contacts associés. Idéal pour les applications nécessitant des informations complètes.</p>

            <div class="card tip-card" style="margin-bottom: 20px;">
              <div class="pill tip-pill">Nouveau</div>
              <p class="lead tip-text">Ces fonctions incluent automatiquement les données des objets liés, évitant les appels multiples pour obtenir une vue complète.</p>
            </div>

            <h3>2.6.1 Récupérer un objet avec Deep Data : <code>get_object_with_deep_data</code></h3>
            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Obligatoire</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_object_id</code></td><td><code>string</code></td><td>✅</td><td>—</td><td>Identifiant de l'objet à récupérer.</td></tr>
              </tbody>
            </table>

            <h3>2.6.2 Récupérer plusieurs objets avec Deep Data : <code>get_objects_with_deep_data</code></h3>
            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Obligatoire</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_object_ids</code></td><td><code>array&lt;string&gt;</code></td><td>✅</td><td>—</td><td>Liste des identifiants d'objets.</td></tr>
                <tr><td><code>p_languages</code></td><td><code>array&lt;string&gt;</code></td><td>❌</td><td><code>["fr"]</code></td><td>Préférences de langue.</td></tr>
                <tr><td><code>p_include_media</code></td><td><code>string</code></td><td>❌</td><td><code>"none"</code></td><td>Inclusion des médias : "none", "basic", "full".</td></tr>
                <tr><td><code>p_filters</code></td><td><code>object</code></td><td>❌</td><td><code>{}</code></td><td>Filtres optionnels.</td></tr>
              </tbody>
            </table>

            <h3>2.6.3 Lister par type avec Deep Data : <code>get_objects_by_type_with_deep_data</code></h3>
            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Obligatoire</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_object_type</code></td><td><code>string</code></td><td>✅</td><td>—</td><td>Type d'objet ("HOT", "ORG", "RES", etc.).</td></tr>
                <tr><td><code>p_languages</code></td><td><code>array&lt;string&gt;</code></td><td>❌</td><td><code>["fr"]</code></td><td>Préférences de langue.</td></tr>
                <tr><td><code>p_include_media</code></td><td><code>string</code></td><td>❌</td><td><code>"none"</code></td><td>Inclusion des médias.</td></tr>
                <tr><td><code>p_filters</code></td><td><code>object</code></td><td>❌</td><td><code>{}</code></td><td>Filtres optionnels.</td></tr>
                <tr><td><code>p_limit</code></td><td><code>number</code></td><td>❌</td><td><code>100</code></td><td>Nombre maximum d'objets.</td></tr>
                <tr><td><code>p_offset</code></td><td><code>number</code></td><td>❌</td><td><code>0</code></td><td>Décalage pour la pagination.</td></tr>
              </tbody>
            </table>

            <h3>2.6.4 Rechercher avec Deep Data : <code>search_objects_with_deep_data</code></h3>
            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Obligatoire</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_search_term</code></td><td><code>string</code></td><td>✅</td><td>—</td><td>Terme de recherche.</td></tr>
                <tr><td><code>p_object_types</code></td><td><code>array&lt;string&gt;</code></td><td>❌</td><td><code>null</code></td><td>Types d'objets à inclure (null = tous).</td></tr>
                <tr><td><code>p_languages</code></td><td><code>array&lt;string&gt;</code></td><td>❌</td><td><code>["fr"]</code></td><td>Préférences de langue.</td></tr>
                <tr><td><code>p_include_media</code></td><td><code>string</code></td><td>❌</td><td><code>"none"</code></td><td>Inclusion des médias.</td></tr>
                <tr><td><code>p_filters</code></td><td><code>object</code></td><td>❌</td><td><code>{}</code></td><td>Filtres optionnels.</td></tr>
                <tr><td><code>p_limit</code></td><td><code>number</code></td><td>❌</td><td><code>50</code></td><td>Nombre maximum d'objets.</td></tr>
                <tr><td><code>p_offset</code></td><td><code>number</code></td><td>❌</td><td><code>0</code></td><td>Décalage pour la pagination.</td></tr>
              </tbody>
            </table>

            <h3>2.6.5 Recherche spécialisée restaurants : <code>search_restaurants_by_cuisine</code></h3>
            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Obligatoire</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_cuisine_types</code></td><td><code>array&lt;string&gt;</code></td><td>✅</td><td>—</td><td>Types de cuisine recherchés (ex. ["local", "veggie"]).</td></tr>
                <tr><td><code>p_languages</code></td><td><code>array&lt;string&gt;</code></td><td>❌</td><td><code>["fr"]</code></td><td>Préférences de langue.</td></tr>
                <tr><td><code>p_limit</code></td><td><code>number</code></td><td>❌</td><td><code>50</code></td><td>Nombre maximum de résultats.</td></tr>
                <tr><td><code>p_offset</code></td><td><code>number</code></td><td>❌</td><td><code>0</code></td><td>Décalage pour la pagination.</td></tr>
              </tbody>
            </table>

            <h3>2.6.6 Recherche événements par cuisine : <code>search_events_by_restaurant_cuisine</code></h3>
            <table>
              <thead><tr><th>Paramètre</th><th>Type</th><th>Obligatoire</th><th>Défaut</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>p_cuisine_types</code></td><td><code>array&lt;string&gt;</code></td><td>✅</td><td>—</td><td>Types de cuisine des restaurants associés.</td></tr>
                <tr><td><code>p_languages</code></td><td><code>array&lt;string&gt;</code></td><td>❌</td><td><code>["fr"]</code></td><td>Préférences de langue.</td></tr>
                <tr><td><code>p_limit</code></td><td><code>number</code></td><td>❌</td><td><code>50</code></td><td>Nombre maximum de résultats.</td></tr>
                <tr><td><code>p_offset</code></td><td><code>number</code></td><td>❌</td><td><code>0</code></td><td>Décalage pour la pagination.</td></tr>
              </tbody>
            </table>

            <h3>Structure de réponse Deep Data</h3>
            <p>Les fonctions Deep Data retournent une structure enrichie :</p>
            <pre>{
  "object": {
    // Données complètes de l'objet principal (comme get_object_resource)
    "id": "HOT123",
    "name": "Hôtel Example",
    "type": "HOT",
    "contacts": [...],
    "media": [...],
    // ... toutes les autres données de l'objet
  },
  "parent_objects": [
    {
      "id": "ORG456",
      "type": "ORG", 
      "name": "Organisation Parent",
      "status": "published",
      "relation_type": {
        "id": "uuid-relation-type",
        "name": "Gestionnaire"
      },
      "distance_m": 100,
      "note": "Relation de gestion",
      "basic_info": {
        "id": "ORG456",
        "type": "ORG",
        "name": "Organisation Parent",
        "status": "published"
      }
    }
  ],
  "actors": [
    {
      "id": "actor-uuid",
      "display_name": "Jean Dupont",
      "first_name": "Jean",
      "last_name": "Dupont",
      "role": {
        "id": "role-uuid",
        "code": "manager",
        "name": "Gestionnaire"
      },
      "is_primary": true,
      "valid_from": "2024-01-01",
      "valid_to": "2024-12-31",
      "contacts": [...]
    }
  ],
  "organizations": [
    {
      "id": "ORG789",
      "type": "ORG",
      "name": "Agence de Conciergerie",
      "status": "published",
      "role": {
        "id": "org-role-uuid",
        "code": "concierge",
        "name": "Conciergerie"
      },
      "contacts": [...]
    }
  ]
}</pre>
          </div>
        </details>
      </section>

      <!-- 3) Dictionnaire de données -->
      <section class="card" id="dictionary">
        <h2>3) Dictionnaire de données : contenu d’une ressource</h2>

        <p>Une ressource (un élément de <code>data[]</code>) est un objet JSON avec des blocs thématiques. Tous les blocs ne sont pas présents pour tous les objets.</p>

        <details open id="data-architecture">
          <summary>3.0 Architecture des données (coulisses PostgreSQL)</summary>
          <div class="content">
            <p>Chaque réponse de l’API provient d’un modèle relationnel unifié. Les blocs ci-dessous sont assemblés à partir des tables et vues principales&nbsp;:</p>
            <ul>
              <li><strong>Objets touristiques</strong> <code>object</code> — entité cœur pour tous les types (hébergements, itinéraires, événements, etc.) avec les métadonnées communes (statut, dates de publication, indicateurs d’édition en cours).</li>
              <li><strong>Localisation unifiée</strong> <code>object_location</code> — regroupe adresse postale, coordonnées géographiques et rattachements territoriaux via <code>object_zone</code>.</li>
              <li><strong>Contenus multilingues</strong> <code>object_description</code> et colonnes <code>*_i18n</code> — textes publics, chapôs, infos mobiles stockés soit en JSONB, soit via la table générique <code>i18n_translation</code> exposée dans les vues <code>api.*</code>.</li>
              <li><strong>Contacts &amp; médias</strong> <code>object_contact</code>, <code>media</code> — téléphones, e-mails, réseaux sociaux et ressources médias, y compris les médias spécifiques à un lieu via <code>media.place_id</code>.</li>
              <li><strong>Référentiels</strong> <code>ref_code</code>, <code>ref_classification_scheme</code>, <code>ref_classification_value</code> — types, labels, classements et tags reliés aux objets par <code>object_classification</code> et <code>object_capacity</code>.</li>
              <li><strong>Accessibilité &amp; labels handicap</strong> — entrées <code>object_classification</code> avec <code>scheme_code = "HANDICAP_LABEL"</code>, valeurs et sous-valeurs (<code>subvalue_ids</code>) pour chaque handicap couvert (moteur, visuel, auditif, mental), justificatifs optionnels via <code>ref_document</code>.</li>
              <li><strong>Horaires d’ouverture</strong> <code>opening_period</code>, <code>opening_schedule</code>, <code>opening_time_period</code> — structure hiérarchique permettant de décrire des plages complexes et leurs exceptions.</li>
              <li><strong>Modération</strong> <code>pending_change</code>, <code>object_version</code> — suivi des propositions de modification et historisation avant/après pour audit.</li>
              <li><strong>API JSON</strong> — vues et fonctions du schéma <code>api</code> (ex. <code>api.v_hot</code>, <code>api.v_objects</code>, <code>api.v_needed</code>, <code>api.get_object_resource</code>) qui orchestrent les blocs ci-dessus.</li>
            </ul>
            <p>Les sections du dictionnaire (§3.x) décrivent comment ces blocs sont agrégés pour produire chaque champ. Pour une vision exhaustive, consultez le schéma SQL&nbsp;: <a href="../Base%20de%20donn%C3%A9e%20DLL%20et%20API/schema_unified.sql">schema_unified.sql</a>.</p>
          </div>
        </details>

        <details open>
          <summary>3.1 Vue d’ensemble</summary>
          <div class="content">
            <table>
              <thead><tr><th>Bloc</th><th>Type</th><th>À quoi ça sert</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant unique métier</td><td><code>"OBJ_000123"</code></td></tr>
                <tr><td><code>type</code></td><td><code>enum</code></td><td>Type d’objet (ex. itinéraire)</td><td><code>"ITI"</code></td></tr>
                <tr><td><code>status</code></td><td><code>enum</code></td><td>Statut de publication</td><td><code>"published"</code></td></tr>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Nom affiché</td><td><code>"Boucle des Crêtes"</code></td></tr>
                <tr><td><code>region_code</code></td><td><code>string</code></td><td>Code région/source métier</td><td><code>"FR-ARA"</code></td></tr>
                <tr><td><code>created_at / updated_at / updated_at_source / published_at</code></td><td><code>timestamp</code></td><td>Suivi de vie (technique + source amont)</td><td><code>"2024-03-18T09:30:00Z"</code></td></tr>
                <tr><td><code>address</code></td><td><code>object</code></td><td>Adresse postale (si connue)</td><td><code>{ "street": "...", "city": "..." }</code></td></tr>
                <tr><td><code>location</code></td><td><code>object</code></td><td>Position WGS84</td><td><code>{ "latitude": 45.76, "longitude": 4.84, "altitude_m": 250 }</code></td></tr>
                <tr><td><code>descriptions</code></td><td><code>object</code></td><td>Descriptions multilingues enrichies (description, description_chapo, description_mobile, description_edition, description_offre_hors_zone, sanitary_measures)</td><td>voir §3.2</td></tr>
                <tr><td><code>external_ids</code></td><td><code>array&lt;object&gt;</code></td><td>Identifiants externes (SIT, DMS…)</td><td><code>[{ "system":"X", "value":"1234" }]</code></td></tr>
                <tr><td><code>contacts</code></td><td><code>array&lt;object&gt;</code></td><td>Moyens de contact enrichis</td><td>voir §3.3</td></tr>
                <tr><td><code>languages</code></td><td><code>array&lt;object&gt;</code></td><td>Langues parlées</td><td><code>[{ "code":"fr", "name":"Français" }]</code></td></tr>
                <tr><td><code>media</code></td><td><code>array&lt;object&gt;</code></td><td>Médias publiés</td><td>voir §3.5</td></tr>
                <tr><td><code>capacity</code></td><td><code>array&lt;object&gt;</code></td><td>Capacités</td><td>voir §3.6</td></tr>
                <tr><td><code>amenities</code></td><td><code>array&lt;object&gt;</code></td><td>Équipements/Services</td><td>voir §3.7</td></tr>
                <tr><td><code>environment_tags</code></td><td><code>array&lt;object&gt;</code></td><td>Tags environnement (éco)</td><td>voir §3.8</td></tr>
                <tr><td><code>payment_methods</code></td><td><code>array&lt;object&gt;</code></td><td>Moyens de paiement</td><td>voir §3.8</td></tr>
                <tr><td><code>pet_policy</code></td><td><code>object</code></td><td>Politique animaux</td><td><code>{ "accepted": true, ... }</code></td></tr>
                <tr><td><code>prices</code></td><td><code>array&lt;object&gt;</code></td><td>Tarifs (+ périodes)</td><td>voir §3.9</td></tr>
                <tr><td><code>classifications</code></td><td><code>array&lt;object&gt;</code></td><td>Labels/Classements (étoiles hôtels, certifications, etc.)</td><td>voir §3.10</td></tr>
                <tr><td><code>handicap_labels</code></td><td><code>array&lt;object&gt;</code></td><td>Labellisation Tourisme &amp; Handicap</td><td>voir §3.11</td></tr>
                <tr><td><code>tags</code></td><td><code>array&lt;object&gt;</code></td><td>Tags libres</td><td>voir §3.12</td></tr>
                <tr><td><code>discounts</code></td><td><code>array&lt;object&gt;</code></td><td>Réductions et offres spéciales</td><td>voir §3.23</td></tr>
                <tr><td><code>group_policies</code></td><td><code>array&lt;object&gt;</code></td><td>Politiques de groupe</td><td>voir §3.24</td></tr>
                <tr><td><code>origins / org_links</code></td><td><code>array&lt;object&gt;</code></td><td>Blocs transparents</td><td>—</td></tr>
                <tr><td><code>actors</code></td><td><code>array&lt;object&gt;</code></td><td>Acteurs (personnes) liés à l'objet</td><td>voir §3.25</td></tr>
                <tr><td><code>legal_records</code></td><td><code>array&lt;object&gt;</code></td><td>Enregistrements légaux unifiés</td><td>voir §3.26</td></tr>
                <tr><td><code>meeting_rooms</code></td><td><code>array&lt;object&gt;</code></td><td>Salles de réunion</td><td>voir §3.13</td></tr>
                <tr><td><code>fma / fma_occurrences</code></td><td><code>array&lt;object&gt;</code></td><td>Occurrences d'événements/activités</td><td>—</td></tr>
                <tr><td><code>opening_times</code></td><td><code>object</code></td><td>Horaires d'ouverture (structure temporelle)</td><td>voir §3.14</td></tr>
                <tr><td><code>menus</code></td><td><code>array&lt;object&gt;</code></td><td>Menus (restaurants/événements)</td><td>voir §3.15</td></tr>
                <tr><td><code>places</code></td><td><code>array&lt;object&gt;</code></td><td>Lieux internes</td><td>voir §3.16</td></tr>
                <tr><td><code>sustainability_action_labels</code></td><td><code>array&lt;object&gt;</code></td><td>Actions RSE + labels</td><td>voir §3.17</td></tr>
                <tr><td><code>incoming_relations / outgoing_relations</code></td><td><code>array&lt;object&gt;</code></td><td>Relations entrantes/sortantes</td><td>voir §3.18</td></tr>
                <tr><td><code>render</code></td><td><code>object</code></td><td>Données formatées pour l'affichage</td><td>voir §3.27</td></tr>
                <tr><td><code>legal_records</code></td><td><code>array&lt;object&gt;</code></td><td>Enregistrements légaux et certifications</td><td>voir §3.26</td></tr>
                <tr><td><code>documents</code></td><td><code>array&lt;object&gt;</code></td><td>Pièces justificatives publiables (référentiel commun)</td><td>voir §3.21</td></tr>
                <tr><td><code>document_requests</code></td><td><code>array&lt;object&gt;</code></td><td>Suivi des demandes/remises de documents</td><td>voir §3.22</td></tr>
                <tr><td><code>associated_restaurants_cuisine_types</code> (si <code>type="FMA"</code>)</td><td><code>array&lt;object&gt;</code></td><td>Types de cuisine agrégés via les restaurants liés</td><td>voir §3.20</td></tr>
                <tr><td><code>itinerary_details</code> (si <code>type="ITI"</code>)</td><td><code>object</code></td><td>Détails ITI</td><td>voir §3.19</td></tr>
                <tr><td><code>itinerary</code> (si <code>type="ITI"</code>)</td><td><code>object</code></td><td>Résumé ITI (+ track si demandé)</td><td>voir §3.19</td></tr>
              </tbody>
            </table>
          </div>
        </details>

        <details>
          <summary>3.2 <code>descriptions</code> (descriptions multilingues enrichies)</summary>
          <div class="content">
            <p>Bloc contenant toutes les descriptions multilingues de l'objet, avec support pour différents contextes d'affichage et mesures sanitaires.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>description</code></td><td><code>string</code></td><td>Description principale multilingue</td><td><code>"Restaurant gastronomique avec vue sur mer..."</code></td></tr>
                <tr><td><code>description_chapo</code></td><td><code>string</code></td><td>Chapô/accroche multilingue</td><td><code>"Une expérience culinaire unique..."</code></td></tr>
                <tr><td><code>description_mobile</code></td><td><code>string</code></td><td>Description optimisée pour mobile</td><td><code>"Resto vue mer, spécialités locales"</code></td></tr>
                <tr><td><code>description_edition</code></td><td><code>string</code></td><td>Description pour édition papier</td><td><code>"Établissement familial depuis 1950..."</code></td></tr>
                <tr><td><code>description_offre_hors_zone</code></td><td><code>string</code></td><td>Description pour offres hors zone géographique</td><td><code>"Découvrez nos spécialités créoles..."</code></td></tr>
                <tr><td><code>sanitary_measures</code></td><td><code>string</code></td><td>Mesures sanitaires et protocoles</td><td><code>"Gel hydroalcoolique disponible, masques fournis"</code></td></tr>
              </tbody>
            </table>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Multilingue</div>
              <p>Tous les champs de description supportent la gestion multilingue via les paramètres <code>p_lang_prefs</code> de l'API. La langue de fallback est le français.</p>
            </div>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Contexte</div>
              <p><strong>description_mobile</strong> : Version courte pour affichage mobile<br/>
              <strong>description_edition</strong> : Version pour supports imprimés<br/>
              <strong>description_offre_hors_zone</strong> : Version pour communication externe<br/>
              <strong>sanitary_measures</strong> : Informations sanitaires obligatoires</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.3 <code>contacts[]</code> (moyens de contact enrichis)</summary>
          <div class="content">
            <p>Le bloc <code>contacts[]</code> regroupe tous les moyens de contact disponibles pour un établissement : téléphone, email, site web, réseaux sociaux, etc. Chaque contact inclut des métadonnées pour l'affichage et la priorisation.</p>
            
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>kind_code</code></td><td><code>string</code></td><td>Type de contact (référentiel <code>contact_kind</code>)</td><td><code>"email"</code></td></tr>
                <tr><td><code>kind_name</code></td><td><code>string</code></td><td>Libellé humain du type</td><td><code>"E-mail"</code></td></tr>
                <tr><td><code>kind_description</code></td><td><code>string</code></td><td>Description du type</td><td><code>"Adresse électronique"</code></td></tr>
                <tr><td><code>icon_url</code></td><td><code>string (URL)</code></td><td>Icône du type</td><td><code>"https://cdn.example.com/email.svg"</code></td></tr>
                <tr><td><code>value</code></td><td><code>string</code></td><td>Adresse/numéro/URL de contact</td><td><code>"contact@hotel-exemple.fr"</code></td></tr>
                <tr><td><code>is_public</code></td><td><code>boolean</code></td><td>Visible publiquement ?</td><td><code>true</code></td></tr>
                <tr><td><code>is_primary</code></td><td><code>boolean</code></td><td>Canal prioritaire ?</td><td><code>true</code></td></tr>
                <tr><td><code>role</code></td><td><code>string</code></td><td>Rôle (code : <code>booking</code>, <code>info</code>, …)</td><td><code>"booking"</code></td></tr>
                <tr><td><code>position</code></td><td><code>number</code></td><td>Ordre d'affichage conseillé</td><td><code>1</code></td></tr>
              </tbody>
            </table>

            <h4>Types de contacts disponibles</h4>
            <p>Le système supporte plusieurs types de contacts via le référentiel <code>contact_kind</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Format attendu</th></tr></thead>
              <tbody>
                <tr><td><code>email</code></td><td>E-mail</td><td>Adresse électronique</td><td>email@domain.com</td></tr>
                <tr><td><code>phone</code></td><td>Téléphone</td><td>Numéro de téléphone</td><td>+262 262 12 34 56</td></tr>
                <tr><td><code>mobile</code></td><td>Mobile</td><td>Numéro de mobile</td><td>+262 692 12 34 56</td></tr>
                <tr><td><code>website</code></td><td>Site web</td><td>URL du site internet</td><td>https://www.hotel-exemple.fr</td></tr>
                <tr><td><code>facebook</code></td><td>Facebook</td><td>Page Facebook</td><td>https://facebook.com/hotel-exemple</td></tr>
                <tr><td><code>instagram</code></td><td>Instagram</td><td>Compte Instagram</td><td>https://instagram.com/hotel_exemple</td></tr>
                <tr><td><code>whatsapp</code></td><td>WhatsApp</td><td>Contact WhatsApp</td><td>+262 692 12 34 56</td></tr>
                <tr><td><code>booking</code></td><td>Réservation</td><td>Lien de réservation</td><td>https://booking.com/hotel-exemple</td></tr>
              </tbody>
            </table>

            <h4>Exemple concret : Contacts d'un hôtel</h4>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "contacts": [
    {
      "kind_code": "phone",
      "kind_name": "Téléphone",
      "kind_description": "Numéro de téléphone",
      "icon_url": "https://cdn.example.com/phone.svg",
      "value": "+262 262 12 34 56",
      "is_public": true,
      "is_primary": true,
      "role": "booking",
      "position": 1
    },
    {
      "kind_code": "email",
      "kind_name": "E-mail",
      "kind_description": "Adresse électronique",
      "icon_url": "https://cdn.example.com/email.svg",
      "value": "contact@hotel-exemple.fr",
      "is_public": true,
      "is_primary": false,
      "role": "info",
      "position": 2
    },
    {
      "kind_code": "website",
      "kind_name": "Site web",
      "kind_description": "Site internet",
      "icon_url": "https://cdn.example.com/website.svg",
      "value": "https://www.hotel-exemple.fr",
      "is_public": true,
      "is_primary": false,
      "role": "info",
      "position": 3
    },
    {
      "kind_code": "whatsapp",
      "kind_name": "WhatsApp",
      "kind_description": "Contact WhatsApp",
      "icon_url": "https://cdn.example.com/whatsapp.svg",
      "value": "+262 692 12 34 56",
      "is_public": true,
      "is_primary": false,
      "role": "booking",
      "position": 4
    }
  ]
}</code></pre>
            </div>

            <h4>Utilisation pratique</h4>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Affichage</div>
              <p><strong>Priorité :</strong> Affichez d'abord les contacts avec <code>is_primary: true</code>, puis les autres par <code>position</code>.</p>
              <p><strong>Types :</strong> Utilisez <code>kind_code</code> et <code>kind_name</code> pour identifier le type de contact.</p>
              <p><strong>Rôles :</strong> Utilisez <code>role</code> (code) pour grouper par usage (booking, info, commercial).</p>
              <p><strong>Public :</strong> Filtrez avec <code>is_public: true</code> pour n'afficher que les contacts publics.</p>
            </div>

            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Note sur les variantes</div>
              <p>Dans <code>actors[].contacts[]</code> et les contacts d'organisations, la structure est <strong>imbriquée</strong> : <code>kind { code, name, description, icon_url }</code> et <code>role { code, name }</code>. Au niveau <strong>objet</strong>, le bloc <code>contacts[]</code> utilise les champs <code>kind_code</code>/<code>kind_name</code> et un <code>role</code> simple (code).</p>
            </div>

            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Important</div>
              <p>Les contacts sont <strong>vérifiés et validés</strong>. Respectez les préférences de contact de l'établissement (horaires, langue, etc.).</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.4 <code>languages[]</code> (langues parlées)</summary>
          <div class="content">
            <p>Le bloc <code>languages[]</code> indique les langues parlées par le personnel de l'établissement. Cette information est cruciale pour l'accessibilité et l'expérience client.</p>
            
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>code</code></td><td><code>string</code></td><td>Code ISO 639-1 de la langue</td><td><code>"fr"</code></td></tr>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Nom de la langue</td><td><code>"Français"</code></td></tr>
              </tbody>
            </table>

            <h4>Langues supportées</h4>
            <p>Le système supporte les principales langues via le référentiel <code>ref_language</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Usage typique</th></tr></thead>
              <tbody>
                <tr><td><code>fr</code></td><td>Français</td><td>Langue officielle de La Réunion</td><td>Langue principale</td></tr>
                <tr><td><code>en</code></td><td>Anglais</td><td>Langue internationale</td><td>Tourisme international</td></tr>
                <tr><td><code>es</code></td><td>Espagnol</td><td>Langue latine</td><td>Tourisme hispanophone</td></tr>
                <tr><td><code>de</code></td><td>Allemand</td><td>Langue germanique</td><td>Tourisme germanophone</td></tr>
                <tr><td><code>it</code></td><td>Italien</td><td>Langue latine</td><td>Tourisme italophone</td></tr>
                <tr><td><code>pt</code></td><td>Portugais</td><td>Langue lusophone</td><td>Tourisme brésilien</td></tr>
                <tr><td><code>zh</code></td><td>Chinois</td><td>Langue asiatique</td><td>Tourisme chinois</td></tr>
                <tr><td><code>ja</code></td><td>Japonais</td><td>Langue asiatique</td><td>Tourisme japonais</td></tr>
              </tbody>
            </table>

            <h4>Exemple concret : Langues d'un hôtel</h4>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "languages": [
    {
      "code": "fr",
      "name": "Français"
    },
    {
      "code": "en",
      "name": "Anglais"
    },
    {
      "code": "de",
      "name": "Allemand"
    },
    {
      "code": "es",
      "name": "Espagnol"
    }
  ]
}</code></pre>
            </div>

            <h4>Utilisation pratique</h4>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Filtrage</div>
              <p><strong>Filtrer par langue :</strong> Utilisez <code>p_filters.languages_any: ["fr", "en"]</code> pour trouver les établissements parlant français ou anglais.</p>
              <p><strong>Affichage :</strong> Affichez les langues disponibles pour informer les clients de l'accessibilité linguistique.</p>
            </div>

            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Important</div>
              <p>Les langues indiquées correspondent aux <strong>capacités réelles du personnel</strong>. Vérifiez la disponibilité selon les horaires et les équipes présentes.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.5 <code>media[]</code> (médias publiés)</summary>
          <div class="content">
            <p>Le bloc <code>media[]</code> contient tous les médias publiés associés à l'établissement : photos, vidéos, documents PDF, etc. La réponse n'inclut que les médias <strong>publiés</strong>.</p>
            
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant unique du média</td><td><code>"media_123"</code></td></tr>
                <tr><td><code>type_code</code></td><td><code>string</code></td><td>Type de média (référentiel <code>media_type</code>)</td><td><code>"image"</code></td></tr>
                <tr><td><code>type_name</code></td><td><code>string</code></td><td>Nom du type de média</td><td><code>"Image"</code></td></tr>
                <tr><td><code>type_description</code></td><td><code>string</code></td><td>Description du type de média</td><td><code>"Photos et illustrations"</code></td></tr>
                <tr><td><code>icon_url</code></td><td><code>string (URL)</code></td><td>Icône représentant le type</td><td><code>"https://cdn.example.com/image.svg"</code></td></tr>
                <tr><td><code>title</code></td><td><code>string</code></td><td>Titre/légende du média</td><td><code>"Vue panoramique de l'hôtel"</code></td></tr>
                <tr><td><code>credit</code></td><td><code>string</code></td><td>Crédit photo/vidéo</td><td><code>"© Hôtel Exemple"</code></td></tr>
                <tr><td><code>url</code></td><td><code>string (URL)</code></td><td>URL directe du fichier</td><td><code>"https://cdn.example.com/hotel-view.jpg"</code></td></tr>
                <tr><td><code>is_main</code></td><td><code>boolean</code></td><td>Média principal de l'établissement ?</td><td><code>true</code></td></tr>
                <tr><td><code>visibility</code></td><td><code>string</code></td><td>Niveau de visibilité</td><td><code>"public"</code></td></tr>
                <tr><td><code>position</code></td><td><code>number</code></td><td>Ordre d'affichage</td><td><code>1</code></td></tr>
                <tr><td><code>width</code></td><td><code>number</code></td><td>Largeur en pixels (si connue)</td><td><code>1920</code></td></tr>
                <tr><td><code>height</code></td><td><code>number</code></td><td>Hauteur en pixels (si connue)</td><td><code>1080</code></td></tr>
              </tbody>
            </table>

            <h4>Types de médias disponibles</h4>
            <p>Le système supporte plusieurs types de médias via le référentiel <code>media_type</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Formats typiques</th></tr></thead>
              <tbody>
                <tr><td><code>image</code></td><td>Image</td><td>Photos et illustrations</td><td>JPG, PNG, WebP</td></tr>
                <tr><td><code>video</code></td><td>Vidéo</td><td>Vidéos promotionnelles</td><td>MP4, WebM</td></tr>
                <tr><td><code>logo</code></td><td>Logo</td><td>Logo de l'établissement</td><td>PNG, SVG</td></tr>
                <tr><td><code>brochure_pdf</code></td><td>Brochure PDF</td><td>Documentation imprimable</td><td>PDF</td></tr>
                <tr><td><code>menu_pdf</code></td><td>Menu PDF</td><td>Menu au format PDF</td><td>PDF</td></tr>
                <tr><td><code>audio</code></td><td>Audio</td><td>Fichiers audio</td><td>MP3, WAV</td></tr>
                <tr><td><code>document</code></td><td>Document</td><td>Autres documents</td><td>PDF, DOC</td></tr>
              </tbody>
            </table>

            <h4>Exemple concret : Médias d'un hôtel</h4>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "media": [
    {
      "id": "media_001",
      "type_code": "image",
      "type_name": "Image",
      "icon_url": "https://cdn.example.com/image.svg",
      "title": "Vue panoramique de l'hôtel",
      "credit": "© Hôtel Exemple",
      "url": "https://cdn.example.com/hotel-panorama.jpg",
      "is_main": true,
      "visibility": "public",
      "position": 1,
      "width": 1920,
      "height": 1080
    },
    {
      "id": "media_002",
      "type_code": "video",
      "type_name": "Vidéo",
      "icon_url": "https://cdn.example.com/video.svg",
      "title": "Visite virtuelle de l'hôtel",
      "credit": "© Hôtel Exemple",
      "url": "https://cdn.example.com/hotel-tour.mp4",
      "is_main": false,
      "visibility": "public",
      "position": 2,
      "width": 1920,
      "height": 1080
    },
    {
      "id": "media_003",
      "type_code": "brochure_pdf",
      "type_name": "Brochure PDF",
      "icon_url": "https://cdn.example.com/pdf.svg",
      "title": "Brochure complète 2024",
      "credit": "© Hôtel Exemple",
      "url": "https://cdn.example.com/brochure-2024.pdf",
      "is_main": false,
      "visibility": "public",
      "position": 3,
      "width": null,
      "height": null
    }
  ]
}</code></pre>
            </div>

            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Variante menus</div>
              <p>Dans <code>menus[].items[].media[]</code>, la structure utilise un objet imbriqué <code>media_type { id, code, name }</code> et inclut le champ <code>is_published</code>. Au niveau <strong>objet</strong>, le bloc <code>media[]</code> expose <code>type_code</code>/<code>type_name</code> et n'inclut pas <code>is_published</code>.</p>
            </div>

            <h4>Utilisation pratique</h4>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Affichage</div>
              <p><strong>Média principal :</strong> Affichez d'abord le média avec <code>is_main: true</code> comme image de couverture.</p>
              <p><strong>Tri :</strong> Triez par <code>position</code> pour respecter l'ordre souhaité par l'établissement.</p>
              <p><strong>Filtrage :</strong> Utilisez <code>p_filters.media_types_any: ["image"]</code> pour ne récupérer que les images.</p>
            </div>

            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Important</div>
              <p>Les médias sont <strong>publiés et vérifiés</strong>. Respectez les droits d'auteur et les crédits mentionnés. Les URLs sont directes et ne nécessitent pas d'authentification.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.6 <code>capacity[]</code> (capacités d'accueil)</summary>
          <div class="content">
            <p>Le bloc <code>capacity[]</code> définit les capacités d'accueil de l'établissement selon différentes métriques : nombre de lits, couverts, chambres, etc. Ces informations sont essentielles pour la planification et la réservation.</p>
            
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>metric_code</code></td><td><code>string</code></td><td>Code de la métrique (référentiel <code>ref_capacity_metric</code>)</td><td><code>"beds"</code></td></tr>
                <tr><td><code>metric_name</code></td><td><code>string</code></td><td>Nom de la métrique</td><td><code>"Lits"</code></td></tr>
                <tr><td><code>icon_url</code></td><td><code>string (URL)</code></td><td>Icône représentant la métrique</td><td><code>"https://cdn.example.com/bed.svg"</code></td></tr>
                <tr><td><code>value</code></td><td><code>number</code></td><td>Valeur numérique de la capacité</td><td><code>50</code></td></tr>
                <tr><td><code>unit</code></td><td><code>string</code></td><td>Unité de mesure (si applicable)</td><td><code>"personnes"</code></td></tr>
              </tbody>
            </table>

            <h4>Métriques de capacité disponibles</h4>
            <p>Le système supporte plusieurs métriques via le référentiel <code>ref_capacity_metric</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Usage typique</th></tr></thead>
              <tbody>
                <tr><td><code>beds</code></td><td>Lits</td><td>Nombre total de lits</td><td>Hôtels, gîtes</td></tr>
                <tr><td><code>rooms</code></td><td>Chambres</td><td>Nombre de chambres</td><td>Hôtels, meublés</td></tr>
                <tr><td><code>covers</code></td><td>Couverts</td><td>Capacité restaurant</td><td>Restaurants, cafés</td></tr>
                <tr><td><code>seats</code></td><td>Places assises</td><td>Places en salle</td><td>Restaurants, salles</td></tr>
                <tr><td><code>max_capacity</code></td><td>Capacité max</td><td>Capacité maximale totale</td><td>Événements, salles</td></tr>
                <tr><td><code>parking_spaces</code></td><td>Places parking</td><td>Nombre de places de parking</td><td>Tous établissements</td></tr>
                <tr><td><code>pools</code></td><td>Piscines</td><td>Nombre de piscines</td><td>Hôtels, campings</td></tr>
                <tr><td><code>tennis_courts</code></td><td>Courts de tennis</td><td>Nombre de courts</td><td>Complexes sportifs</td></tr>
              </tbody>
            </table>

            <h4>Exemple concret : Capacités d'un hôtel</h4>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "capacity": [
    {
      "metric_code": "rooms",
      "metric_name": "Chambres",
      "icon_url": "https://cdn.example.com/room.svg",
      "value": 25,
      "unit": "chambres"
    },
    {
      "metric_code": "beds",
      "metric_name": "Lits",
      "icon_url": "https://cdn.example.com/bed.svg",
      "value": 50,
      "unit": "lits"
    },
    {
      "metric_code": "covers",
      "metric_name": "Couverts",
      "icon_url": "https://cdn.example.com/restaurant.svg",
      "value": 80,
      "unit": "couverts"
    },
    {
      "metric_code": "parking_spaces",
      "metric_name": "Places parking",
      "icon_url": "https://cdn.example.com/parking.svg",
      "value": 30,
      "unit": "places"
    }
  ]
}</code></pre>
            </div>

            <h4>Utilisation pratique</h4>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Filtrage</div>
              <p><strong>Filtrer par capacité :</strong> Utilisez <code>p_filters.capacity_filters: [{"metric": "beds", "min": 20, "max": 100}]</code> pour trouver les établissements avec 20 à 100 lits.</p>
              <p><strong>Affichage :</strong> Affichez les capacités pertinentes selon le type d'établissement (lits pour hôtels, couverts pour restaurants).</p>
            </div>

            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Important</div>
              <p>Les capacités indiquent le <strong>maximum théorique</strong>. La disponibilité réelle dépend des réservations et de la configuration des chambres/salles.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.7 <code>amenities[]</code> (équipements et services)</summary>
          <div class="content">
            <p>Le bloc <code>amenities[]</code> liste tous les équipements et services disponibles dans l'établissement : WiFi, piscine, parking, restaurant, etc. Ces informations sont cruciales pour l'expérience client et les filtres de recherche.</p>
            
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>code</code></td><td><code>string</code></td><td>Code de l'équipement (référentiel <code>amenity</code>)</td><td><code>"WIFI"</code></td></tr>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Nom de l'équipement</td><td><code>"WiFi gratuit"</code></td></tr>
                <tr><td><code>icon_url</code></td><td><code>string (URL)</code></td><td>Icône représentant l'équipement</td><td><code>"https://cdn.example.com/wifi.svg"</code></td></tr>
                <tr><td><code>family</code></td><td><code>object</code></td><td>Famille d'équipements : { code, name, icon_url }</td><td><code>{"code": "connectivity", "name": "Connectivité"}</code></td></tr>
              </tbody>
            </table>

            <h4>Familles d'équipements disponibles</h4>
            <p>Les équipements sont organisés en familles via le référentiel <code>amenity_family</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Équipements typiques</th></tr></thead>
              <tbody>
                <tr><td><code>connectivity</code></td><td>Connectivité</td><td>Services internet et communication</td><td>WiFi, 4G, téléphone</td></tr>
                <tr><td><code>comfort</code></td><td>Confort</td><td>Équipements de confort</td><td>Climatisation, chauffage, minibar</td></tr>
                <tr><td><code>outdoor</code></td><td>Extérieur</td><td>Espaces et activités extérieures</td><td>Piscine, jardin, terrasse</td></tr>
                <tr><td><code>wellness</code></td><td>Bien-être</td><td>Services de bien-être</td><td>Spa, sauna, fitness</td></tr>
                <tr><td><code>dining</code></td><td>Restauration</td><td>Services de restauration</td><td>Restaurant, bar, petit-déjeuner</td></tr>
                <tr><td><code>business</code></td><td>Business</td><td>Services professionnels</td><td>Salle de réunion, photocopieur</td></tr>
                <tr><td><code>accessibility</code></td><td>Accessibilité</td><td>Équipements d'accessibilité</td><td>Ascenseur, rampe, chambre adaptée</td></tr>
                <tr><td><code>transport</code></td><td>Transport</td><td>Services de transport</td><td>Parking, navette, location vélo</td></tr>
              </tbody>
            </table>

            <h4>Équipements populaires</h4>
            <p>Voici quelques équipements couramment utilisés :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Famille</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>WIFI</code></td><td>WiFi gratuit</td><td>connectivity</td><td>Accès internet sans fil</td></tr>
                <tr><td><code>PARKING</code></td><td>Parking</td><td>transport</td><td>Place de stationnement</td></tr>
                <tr><td><code>POOL</code></td><td>Piscine</td><td>outdoor</td><td>Bassin de natation</td></tr>
                <tr><td><code>RESTAURANT</code></td><td>Restaurant</td><td>dining</td><td>Service de restauration</td></tr>
                <tr><td><code>AC</code></td><td>Climatisation</td><td>comfort</td><td>Air conditionné</td></tr>
                <tr><td><code>SPA</code></td><td>Spa</td><td>wellness</td><td>Centre de bien-être</td></tr>
                <tr><td><code>ELEVATOR</code></td><td>Ascenseur</td><td>accessibility</td><td>Équipement d'accessibilité</td></tr>
                <tr><td><code>MEETING_ROOM</code></td><td>Salle de réunion</td><td>business</td><td>Espace de travail</td></tr>
              </tbody>
            </table>

            <h4>Exemple concret : Équipements d'un hôtel</h4>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "amenities": [
    {
      "code": "WIFI",
      "name": "WiFi gratuit",
      "icon_url": "https://cdn.example.com/wifi.svg",
      "family": {
        "code": "connectivity",
        "name": "Connectivité",
        "icon_url": "https://cdn.example.com/connectivity.svg"
      }
    },
    {
      "code": "PARKING",
      "name": "Parking",
      "icon_url": "https://cdn.example.com/parking.svg",
      "family": {
        "code": "transport",
        "name": "Transport",
        "icon_url": "https://cdn.example.com/transport.svg"
      }
    },
    {
      "code": "POOL",
      "name": "Piscine",
      "icon_url": "https://cdn.example.com/pool.svg",
      "family": {
        "code": "outdoor",
        "name": "Extérieur",
        "icon_url": "https://cdn.example.com/outdoor.svg"
      }
    },
    {
      "code": "RESTAURANT",
      "name": "Restaurant",
      "icon_url": "https://cdn.example.com/restaurant.svg",
      "family": {
        "code": "dining",
        "name": "Restauration",
        "icon_url": "https://cdn.example.com/dining.svg"
      }
    },
    {
      "code": "SPA",
      "name": "Spa",
      "icon_url": "https://cdn.example.com/spa.svg",
      "family": {
        "code": "wellness",
        "name": "Bien-être",
        "icon_url": "https://cdn.example.com/wellness.svg"
      }
    }
  ]
}</code></pre>
            </div>

            <h4>Utilisation pratique</h4>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Filtrage</div>
              <p><strong>Filtrer par équipements :</strong> Utilisez <code>p_filters.amenities_any: ["WIFI", "POOL"]</code> pour trouver les établissements avec WiFi et piscine.</p>
              <p><strong>Filtrer par famille :</strong> Utilisez <code>p_filters.amenity_families_any: ["wellness", "outdoor"]</code> pour les équipements de bien-être et extérieurs.</p>
              <p><strong>Affichage :</strong> Groupez par <code>family</code> pour une meilleure organisation visuelle.</p>
            </div>

            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Important</div>
              <p>Les équipements indiqués sont <strong>disponibles sur place</strong>. Vérifiez les conditions d'accès (horaires, restrictions, coûts supplémentaires) directement avec l'établissement.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.8 <code>environment_tags[]</code> & <code>payment_methods[]</code> (tags environnementaux et moyens de paiement)</summary>
          <div class="content">
            <p>Ces deux blocs partagent la même structure simple mais servent des objectifs différents : <code>environment_tags[]</code> décrit l'environnement de l'établissement, tandis que <code>payment_methods[]</code> liste les moyens de paiement acceptés.</p>
            
            <h4>Structure commune</h4>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>code</code></td><td><code>string</code></td><td>Code de référence</td><td><code>"beach"</code></td></tr>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Nom affiché</td><td><code>"Plage"</code></td></tr>
                <tr><td><code>icon_url</code></td><td><code>string (URL)</code></td><td>Icône représentative</td><td><code>"https://cdn.example.com/beach.svg"</code></td></tr>
              </tbody>
            </table>

            <h4>Tags environnementaux disponibles</h4>
            <p>Le système supporte plusieurs tags environnementaux via le référentiel <code>environment_tag</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Usage typique</th></tr></thead>
              <tbody>
                <tr><td><code>beach</code></td><td>Plage</td><td>Proximité de la plage</td><td>Hôtels côtiers</td></tr>
                <tr><td><code>mountain</code></td><td>Montagne</td><td>Environnement montagnard</td><td>Gîtes, refuges</td></tr>
                <tr><td><code>forest</code></td><td>Forêt</td><td>Proximité de forêts</td><td>Campings, gîtes</td></tr>
                <tr><td><code>city_center</code></td><td>Centre-ville</td><td>En centre-ville</td><td>Hôtels urbains</td></tr>
                <tr><td><code>heritage</code></td><td>Patrimoine</td><td>Proche de sites patrimoniaux</td><td>Hôtels historiques</td></tr>
                <tr><td><code>volcano</code></td><td>Volcan</td><td>Proximité volcanique</td><td>Spécifique à La Réunion</td></tr>
                <tr><td><code>lagoon</code></td><td>Lagon</td><td>Proximité du lagon</td><td>Hôtels tropicaux</td></tr>
                <tr><td><code>garden</code></td><td>Jardin</td><td>Jardin privé</td><td>Gîtes, maisons d'hôte</td></tr>
              </tbody>
            </table>

            <h4>Moyens de paiement disponibles</h4>
            <p>Le système supporte plusieurs moyens de paiement via le référentiel <code>payment_method</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Usage typique</th></tr></thead>
              <tbody>
                <tr><td><code>cash</code></td><td>Espèces</td><td>Paiement en liquide</td><td>Petits établissements</td></tr>
                <tr><td><code>card</code></td><td>Carte bancaire</td><td>Paiement par carte</td><td>Standard</td></tr>
                <tr><td><code>check</code></td><td>Chèque</td><td>Paiement par chèque</td><td>Réservations longues</td></tr>
                <tr><td><code>transfer</code></td><td>Virement</td><td>Virement bancaire</td><td>Groupes, entreprises</td></tr>
                <tr><td><code>paypal</code></td><td>PayPal</td><td>Paiement en ligne</td><td>Réservations web</td></tr>
                <tr><td><code>apple_pay</code></td><td>Apple Pay</td><td>Paiement mobile Apple</td><td>Clients Apple</td></tr>
                <tr><td><code>google_pay</code></td><td>Google Pay</td><td>Paiement mobile Google</td><td>Clients Android</td></tr>
                <tr><td><code>voucher</code></td><td>Bon cadeau</td><td>Paiement par bon</td><td>Offres spéciales</td></tr>
              </tbody>
            </table>

            <h4>Exemple concret : Hôtel côtier</h4>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "environment_tags": [
    {
      "code": "beach",
      "name": "Plage",
      "icon_url": "https://cdn.example.com/beach.svg"
    },
    {
      "code": "lagoon",
      "name": "Lagon",
      "icon_url": "https://cdn.example.com/lagoon.svg"
    },
    {
      "code": "volcano",
      "name": "Volcan",
      "icon_url": "https://cdn.example.com/volcano.svg"
    }
  ],
  "payment_methods": [
    {
      "code": "card",
      "name": "Carte bancaire",
      "icon_url": "https://cdn.example.com/card.svg"
    },
    {
      "code": "cash",
      "name": "Espèces",
      "icon_url": "https://cdn.example.com/cash.svg"
    },
    {
      "code": "paypal",
      "name": "PayPal",
      "icon_url": "https://cdn.example.com/paypal.svg"
    }
  ]
}</code></pre>
            </div>

            <h4>Utilisation pratique</h4>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Filtrage</div>
              <p><strong>Filtrer par environnement :</strong> Utilisez <code>p_filters.environment_tags_any: ["beach", "mountain"]</code> pour trouver les établissements en bord de plage ou en montagne.</p>
              <p><strong>Filtrer par paiement :</strong> Utilisez <code>p_filters.payment_methods_any: ["card", "paypal"]</code> pour les établissements acceptant carte ou PayPal.</p>
              <p><strong>Affichage :</strong> Affichez les tags environnementaux pour l'orientation géographique et les moyens de paiement pour la planification.</p>
            </div>

            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Important</div>
              <p>Les moyens de paiement indiqués sont <strong>généralement acceptés</strong>. Vérifiez les conditions spécifiques (montants minimums, devises, etc.) directement avec l'établissement.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.9 <code>prices[]</code> (tarification complexe avec périodes)</summary>
          <div class="content">
            <p>Le bloc <code>prices[]</code> gère la tarification complexe des établissements avec des prix variables selon les périodes, les types de clients, et les unités de facturation. Il supporte les fourchettes de prix, les conditions spéciales, et les créneaux horaires détaillés.</p>
            
            <h4>Structure principale d'un tarif</h4>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>kind</code></td><td><code>object</code></td><td>Type de tarif enrichi : { id, code, name, position, icon_url }</td><td><code>{"code": "adult", "name": "Adulte"}</code></td></tr>
                <tr><td><code>unit</code></td><td><code>object</code></td><td>Unité enrichie : { id, code, name, position, icon_url }</td><td><code>{"code": "per_night", "name": "Par nuit"}</code></td></tr>
                <tr><td><code>amount</code></td><td><code>number</code></td><td>Montant de base (optionnel si fourchette)</td><td><code>120.00</code></td></tr>
                <tr><td><code>amount_max</code></td><td><code>number</code></td><td>Montant maximum (pour fourchettes de prix)</td><td><code>180.00</code></td></tr>
                <tr><td><code>currency</code></td><td><code>string</code></td><td>Devise (ISO 4217)</td><td><code>"EUR"</code></td></tr>
                <tr><td><code>valid_from</code></td><td><code>date</code></td><td>Date de début de validité du tarif</td><td><code>"2024-01-01"</code></td></tr>
                <tr><td><code>valid_to</code></td><td><code>date</code></td><td>Date de fin de validité du tarif</td><td><code>"2024-12-31"</code></td></tr>
                <tr><td><code>conditions</code></td><td><code>string</code></td><td>Conditions, notes, restrictions</td><td><code>"Petit-déjeuner inclus"</code></td></tr>
                <tr><td><code>periods</code></td><td><code>array&lt;object&gt;</code></td><td>Périodes détaillées imbriquées</td><td>Voir structure ci-dessous</td></tr>
              </tbody>
            </table>

            <h4>Types de tarifs disponibles</h4>
            <p>Le système supporte plusieurs types de tarifs via le référentiel <code>price_kind</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Usage typique</th></tr></thead>
              <tbody>
                <tr><td><code>adult</code></td><td>Adulte</td><td>Tarif adulte standard</td><td>Hôtels, restaurants</td></tr>
                <tr><td><code>child</code></td><td>Enfant</td><td>Tarif enfant (généralement réduit)</td><td>Hôtels, activités</td></tr>
                <tr><td><code>senior</code></td><td>Sénior</td><td>Tarif senior (généralement réduit)</td><td>Hôtels, musées</td></tr>
                <tr><td><code>group</code></td><td>Groupe</td><td>Tarif de groupe (généralement réduit)</td><td>Hôtels, restaurants</td></tr>
                <tr><td><code>package</code></td><td>Forfait</td><td>Forfait tout inclus</td><td>Hôtels, agences</td></tr>
                <tr><td><code>student</code></td><td>Étudiant</td><td>Tarif étudiant</td><td>Musées, activités</td></tr>
                <tr><td><code>free</code></td><td>Gratuit</td><td>Accès gratuit</td><td>Musées, parcs</td></tr>
                <tr><td><code>local</code></td><td>Résident</td><td>Tarif résident local</td><td>Activités, parcs</td></tr>
              </tbody>
            </table>

            <h4>Unités de tarification disponibles</h4>
            <p>Le système supporte plusieurs unités via le référentiel <code>price_unit</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Usage typique</th></tr></thead>
              <tbody>
                <tr><td><code>per_night</code></td><td>Par nuit</td><td>Tarif par nuitée</td><td>Hôtels, gîtes</td></tr>
                <tr><td><code>per_person</code></td><td>Par personne</td><td>Tarif par personne</td><td>Restaurants, activités</td></tr>
                <tr><td><code>per_group</code></td><td>Par groupe</td><td>Tarif forfaitaire groupe</td><td>Guides, activités</td></tr>
                <tr><td><code>per_entry</code></td><td>Par entrée</td><td>Tarif d'entrée unique</td><td>Musées, parcs</td></tr>
                <tr><td><code>per_hour</code></td><td>Par heure</td><td>Tarif horaire</td><td>Location, services</td></tr>
                <tr><td><code>per_day</code></td><td>Par jour</td><td>Tarif journalier</td><td>Location véhicules</td></tr>
                <tr><td><code>per_week</code></td><td>Par semaine</td><td>Tarif hebdomadaire</td><td>Location longue durée</td></tr>
                <tr><td><code>per_month</code></td><td>Par mois</td><td>Tarif mensuel</td><td>Location très longue durée</td></tr>
              </tbody>
            </table>
            
            <h4>Périodes imbriquées (<code>periods[]</code>)</h4>
            <p>Chaque tarif peut avoir des périodes spécifiques avec des créneaux horaires et des conditions particulières :</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant unique de la période</td><td><code>"uuid-period-1"</code></td></tr>
                <tr><td><code>start_date</code></td><td><code>date</code></td><td>Date de début de la période</td><td><code>"2024-07-01"</code></td></tr>
                <tr><td><code>end_date</code></td><td><code>date</code></td><td>Date de fin de la période</td><td><code>"2024-08-31"</code></td></tr>
                <tr><td><code>start_time</code></td><td><code>time</code></td><td>Heure de début (format HH:MM)</td><td><code>"15:00"</code></td></tr>
                <tr><td><code>end_time</code></td><td><code>time</code></td><td>Heure de fin (format HH:MM)</td><td><code>"11:00"</code></td></tr>
                <tr><td><code>note</code></td><td><code>string</code></td><td>Note spécifique à la période</td><td><code>"Haute saison"</code></td></tr>
              </tbody>
            </table>
            
            <h4>Exemple concret : Tarification hôtel complexe</h4>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "prices": [
    {
      "kind": {
        "id": "uuid-kind-1",
        "code": "adult",
        "name": "Adulte",
        "position": 1,
        "icon_url": "https://cdn.example.com/adult.svg"
      },
      "unit": {
        "id": "uuid-unit-1", 
        "code": "per_night",
        "name": "Par nuit",
        "position": 1,
        "icon_url": "https://cdn.example.com/night.svg"
      },
      "amount": 120.00,
      "amount_max": null,
      "currency": "EUR",
      "valid_from": "2024-01-01",
      "valid_to": "2024-12-31",
      "conditions": "Petit-déjeuner inclus, TVA comprise",
      "periods": [
        {
          "id": "uuid-period-1",
          "start_date": "2024-07-01",
          "end_date": "2024-08-31",
          "start_time": "15:00",
          "end_time": "11:00",
          "note": "Haute saison - Prix majoré"
        },
        {
          "id": "uuid-period-2",
          "start_date": "2024-09-01",
          "end_date": "2024-10-31",
          "start_time": "16:00",
          "end_time": "10:00",
          "note": "Saison intermédiaire"
        }
      ]
    },
    {
      "kind": {
        "id": "uuid-kind-2",
        "code": "child",
        "name": "Enfant",
        "position": 2,
        "icon_url": "https://cdn.example.com/child.svg"
      },
      "unit": {
        "id": "uuid-unit-1", 
        "code": "per_night",
        "name": "Par nuit",
        "position": 1,
        "icon_url": "https://cdn.example.com/night.svg"
      },
      "amount": 60.00,
      "amount_max": null,
      "currency": "EUR",
      "valid_from": "2024-01-01",
      "valid_to": "2024-12-31",
      "conditions": "Enfant de 3 à 12 ans, petit-déjeuner inclus",
      "periods": []
    },
    {
      "kind": {
        "id": "uuid-kind-3",
        "code": "group",
        "name": "Groupe",
        "position": 3,
        "icon_url": "https://cdn.example.com/group.svg"
      },
      "unit": {
        "id": "uuid-unit-2", 
        "code": "per_person",
        "name": "Par personne",
        "position": 2,
        "icon_url": "https://cdn.example.com/person.svg"
      },
      "amount": 80.00,
      "amount_max": 100.00,
      "currency": "EUR",
      "valid_from": "2024-01-01",
      "valid_to": "2024-12-31",
      "conditions": "Minimum 10 personnes, petit-déjeuner inclus",
      "periods": []
    }
  ]
}</code></pre>
            </div>
            
            <h4>Utilisation pratique</h4>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Calcul de prix</div>
              <p><strong>Prix fixe :</strong> Utilisez <code>amount</code> quand le prix est fixe.</p>
              <p><strong>Fourchette :</strong> Utilisez <code>amount</code> et <code>amount_max</code> pour les fourchettes de prix.</p>
              <p><strong>Périodes :</strong> Vérifiez les <code>periods[]</code> pour les tarifs saisonniers et les créneaux horaires.</p>
              <p><strong>Conditions :</strong> Affichez les <code>conditions</code> pour informer les clients des inclusions/exclusions.</p>
            </div>

            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Important</div>
              <p>Les prix indiqués sont <strong>indicatifs</strong> et peuvent varier selon la disponibilité, les promotions, et les conditions particulières. Vérifiez toujours les prix finaux lors de la réservation.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.10 <code>classifications[]</code> (labels, classements, certifications)</summary>
          <div class="content">
            <p>Le bloc <code>classifications[]</code> regroupe tous les labels, classements et certifications attribués à un objet touristique. C'est ici que sont stockées les <strong>étoiles d'hôtel</strong>, les <strong>labels environnementaux</strong>, les <strong>certifications d'accessibilité</strong> et autres reconnaissances officielles.</p>
            
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>scheme</code></td><td><code>string</code></td><td>Code du schéma de classification</td><td><code>"hot_stars"</code></td></tr>
                <tr><td><code>scheme_name</code></td><td><code>string</code></td><td>Nom du schéma/organisme</td><td><code>"Classement hôtelier"</code></td></tr>
                <tr><td><code>value</code></td><td><code>string</code></td><td>Code de la valeur/grade</td><td><code>"4"</code></td></tr>
                <tr><td><code>value_name</code></td><td><code>string</code></td><td>Libellé de la valeur</td><td><code>"4 étoiles"</code></td></tr>
                <tr><td><code>awarded_at</code></td><td><code>date</code></td><td>Date d'obtention</td><td><code>"2024-01-15"</code></td></tr>
                <tr><td><code>valid_until</code></td><td><code>date</code></td><td>Date d'expiration (si applicable)</td><td><code>"2025-01-15"</code></td></tr>
                <tr><td><code>status</code></td><td><code>enum</code></td><td>Statut de la classification</td><td><code>"active"</code></td></tr>
              </tbody>
            </table>

            <h4>Types de classifications disponibles</h4>
            <p>Le système supporte plusieurs types de classifications via le référentiel <code>ref_classification_scheme</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Valeurs possibles</th></tr></thead>
              <tbody>
                <tr><td><code>hot_stars</code></td><td>Classement hôtelier</td><td>Étoiles officielles hôtels</td><td>1 à 5 étoiles</td></tr>
                <tr><td><code>camp_stars</code></td><td>Classement camping</td><td>Étoiles officielles campings</td><td>1 à 5 étoiles</td></tr>
                <tr><td><code>meuble_stars</code></td><td>Classement meublés</td><td>Étoiles meublés de tourisme</td><td>1 à 5 étoiles</td></tr>
                <tr><td><code>gites_epics</code></td><td>Gîtes de France (épis)</td><td>Niveau Gîtes de France</td><td>1 à 5 épis</td></tr>
                <tr><td><code>clevacances_keys</code></td><td>Clévacances (clés)</td><td>Niveau Clévacances</td><td>1 à 5 clés</td></tr>
                <tr><td><code>green_key</code></td><td>La Clef Verte</td><td>Label environnemental</td><td>Certifié / Non certifié</td></tr>
                <tr><td><code>eu_ecolabel</code></td><td>Écolabel Européen</td><td>Label environnemental UE</td><td>Certifié / Non certifié</td></tr>
                <tr><td><code>tourisme_handicap</code></td><td>Tourisme & Handicap</td><td>Accessibilité (multi-sélection)</td><td>Moteur, Visuel, Auditif, Mental</td></tr>
              </tbody>
            </table>

            <h4>Exemple concret : Hôtel 4 étoiles</h4>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "classifications": [
    {
      "scheme": "hot_stars",
      "scheme_name": "Classement hôtelier",
      "value": "4",
      "value_name": "4 étoiles",
      "awarded_at": "2024-01-15",
      "valid_until": "2025-01-15",
      "status": "active"
    },
    {
      "scheme": "green_key",
      "scheme_name": "La Clef Verte",
      "value": "certified",
      "value_name": "Certifié",
      "awarded_at": "2024-03-01",
      "valid_until": "2025-03-01",
      "status": "active"
    }
  ]
}</code></pre>
            </div>

            <h4>Utilisation pratique</h4>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Filtrage</div>
              <p><strong>Filtrer par étoiles :</strong> Utilisez <code>p_filters.classifications_any: ["hot_stars:4"]</code> pour trouver les hôtels 4 étoiles.</p>
              <p><strong>Filtrer par label :</strong> Utilisez <code>p_filters.classifications_any: ["green_key:certified"]</code> pour les établissements écolabellisés.</p>
            </div>

            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Important</div>
              <p>Les classifications sont <strong>officielles et vérifiées</strong>. Elles ne peuvent être modifiées que par les organismes compétents via le système de gestion des labels.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.11 <code>handicap_labels[]</code> (accessibilité)</summary>
          <div class="content">
            <p>Expose la labellisation «&nbsp;Tourisme &amp; Handicap&nbsp;» pour chaque objet. Les entrées sont issues de <code>object_classification</code> avec le schéma <code>HANDICAP_LABEL</code>, les sous-valeurs (<code>subvalue_ids</code>) représentant les handicaps couverts.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>scheme</code></td><td><code>object</code></td><td>{ code, name } — devrait valoir <code>HANDICAP_LABEL</code> / «&nbsp;Tourisme &amp; Handicap&nbsp;».</td></tr>
                <tr><td><code>value</code></td><td><code>object</code></td><td>Niveau obtenu { code, name, position } (ex. «&nbsp;Labellisé 4 handicaps&nbsp;»).</td></tr>
                <tr><td><code>dimensions[]</code></td><td><code>array&lt;object&gt;</code></td><td>Handicaps couverts (moteur, visuel, auditif, mental) résolus depuis <code>subvalue_ids</code>.</td></tr>
                <tr><td><code>awarded_at / valid_until</code></td><td><code>date</code></td><td>Dates d’obtention et d’échéance.</td></tr>
                <tr><td><code>status</code></td><td><code>enum</code></td><td>requested, granted, suspended, expired (suivi cycle de vie).</td></tr>
                <tr><td><code>document</code></td><td><code>object | null</code></td><td>Justificatif { id, title, url } référencé via <code>ref_document</code>.</td></tr>
                <tr><td><code>source / note</code></td><td><code>string | null</code></td><td>Métadonnées internes optionnelles.</td></tr>
              </tbody>
            </table>
            <div class="card tip-card" style="margin-top:16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "handicap_labels": [
    {
      "scheme": { "code": "HANDICAP_LABEL", "name": "Tourisme & Handicap" },
      "value": { "code": "th_level_4", "name": "Labellisé 4 handicaps", "position": 4 },
      "dimensions": [
        { "code": "HANDICAP_MOTOR", "name": "Moteur" },
        { "code": "HANDICAP_VISUAL", "name": "Visuel" },
        { "code": "HANDICAP_AUDITORY", "name": "Auditif" },
        { "code": "HANDICAP_MENTAL", "name": "Mental" }
      ],
      "awarded_at": "2023-06-15",
      "valid_until": "2026-06-14",
      "status": "granted",
      "document": { "id": "uuid-doc-1", "title": "Attestation 2023", "url": "https://…/attestation.pdf" },
      "note": "Renouvellement 2023"
    }
  ]
}</code></pre>
            </div>
          </div>
        </details>

        <details>
          <summary>3.12 <code>tags[]</code> (étiquettes thématiques)</summary>
          <div class="content">
            <p>Le bloc <code>tags[]</code> contient des étiquettes thématiques personnalisées pour caractériser l'établissement : "romantique", "familial", "luxe", "authentique", etc. Ces tags permettent un filtrage et une catégorisation fine des établissements.</p>
            
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>slug</code></td><td><code>string</code></td><td>Identifiant lisible (URL-friendly)</td><td><code>"romantique"</code></td></tr>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Libellé affiché</td><td><code>"Romantique"</code></td></tr>
                <tr><td><code>color</code></td><td><code>string</code></td><td>Couleur d'affichage (CSS/hex)</td><td><code>"#FF6B6B"</code></td></tr>
                <tr><td><code>icon</code></td><td><code>string</code></td><td>Nom/code de l'icône</td><td><code>"heart"</code></td></tr>
                <tr><td><code>icon_url</code></td><td><code>string (URL)</code></td><td>URL de l'icône</td><td><code>"https://cdn.example.com/heart.svg"</code></td></tr>
              </tbody>
            </table>

            <h4>Types de tags populaires</h4>
            <p>Voici quelques exemples de tags couramment utilisés :</p>
            
            <table>
              <thead><tr><th>Slug</th><th>Nom</th><th>Description</th><th>Couleur typique</th></tr></thead>
              <tbody>
                <tr><td><code>romantique</code></td><td>Romantique</td><td>Idéal pour couples</td><td>#FF6B6B (rose)</td></tr>
                <tr><td><code>familial</code></td><td>Familial</td><td>Adapté aux familles</td><td>#4ECDC4 (turquoise)</td></tr>
                <tr><td><code>luxe</code></td><td>Luxe</td><td>Établissement haut de gamme</td><td>#FFD93D (doré)</td></tr>
                <tr><td><code>authentique</code></td><td>Authentique</td><td>Expérience locale authentique</td><td>#6BCF7F (vert)</td></tr>
                <tr><td><code>ecologique</code></td><td>Écologique</td><td>Engagement environnemental</td><td>#4D96FF (bleu)</td></tr>
                <tr><td><code>historique</code></td><td>Historique</td><td>Patrimoine historique</td><td>#8B4513 (marron)</td></tr>
                <tr><td><code>moderne</code></td><td>Moderne</td><td>Design contemporain</td><td>#9B59B6 (violet)</td></tr>
                <tr><td><code>tranquille</code></td><td>Tranquille</td><td>Environnement calme</td><td>#95A5A6 (gris)</td></tr>
              </tbody>
            </table>

            <h4>Exemple concret : Tags d'un hôtel de charme</h4>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "tags": [
    {
      "slug": "romantique",
      "name": "Romantique",
      "color": "#FF6B6B",
      "icon": "heart",
      "icon_url": "https://cdn.example.com/heart.svg"
    },
    {
      "slug": "authentique",
      "name": "Authentique",
      "color": "#6BCF7F",
      "icon": "leaf",
      "icon_url": "https://cdn.example.com/leaf.svg"
    },
    {
      "slug": "historique",
      "name": "Historique",
      "color": "#8B4513",
      "icon": "castle",
      "icon_url": "https://cdn.example.com/castle.svg"
    },
    {
      "slug": "tranquille",
      "name": "Tranquille",
      "color": "#95A5A6",
      "icon": "peace",
      "icon_url": "https://cdn.example.com/peace.svg"
    }
  ]
}</code></pre>
            </div>

            <h4>Utilisation pratique</h4>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Filtrage</div>
              <p><strong>Filtrer par tags :</strong> Utilisez <code>p_filters.tags_any: ["romantique", "luxe"]</code> pour trouver les établissements romantiques ou de luxe.</p>
              <p><strong>Affichage :</strong> Affichez les tags avec leurs couleurs et icônes pour une identification visuelle rapide.</p>
              <p><strong>Recherche :</strong> Utilisez les <code>slug</code> pour les URLs et la recherche textuelle.</p>
            </div>

            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Important</div>
              <p>Les tags sont <strong>subjectifs et qualitatifs</strong>. Ils reflètent l'ambiance et le positionnement de l'établissement plutôt que des caractéristiques objectives mesurables.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.13 <code>meeting_rooms[]</code> (salles de réunion et équipements)</summary>
          <div class="content">
            <p>Le bloc <code>meeting_rooms[]</code> décrit les salles de réunion, de conférence et d'événements disponibles dans l'établissement, avec leurs capacités selon différents formats d'organisation et leurs équipements techniques.</p>
            
            <h4>Structure d'une salle de réunion</h4>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Nom de la salle</td><td><code>"Salle des Palmiers"</code></td></tr>
                <tr><td><code>surface</code></td><td><code>number</code></td><td>Surface en m²</td><td><code>120</code></td></tr>
                <tr><td><code>cap_theatre</code></td><td><code>number</code></td><td>Capacité en format théâtre</td><td><code>80</code></td></tr>
                <tr><td><code>cap_u</code></td><td><code>number</code></td><td>Capacité en format U</td><td><code>24</code></td></tr>
                <tr><td><code>cap_classroom</code></td><td><code>number</code></td><td>Capacité en format classe</td><td><code>40</code></td></tr>
                <tr><td><code>cap_boardroom</code></td><td><code>number</code></td><td>Capacité en format conseil</td><td><code>16</code></td></tr>
                <tr><td><code>cap_cocktail</code></td><td><code>number</code></td><td>Capacité en format cocktail</td><td><code>100</code></td></tr>
                <tr><td><code>cap_banquet</code></td><td><code>number</code></td><td>Capacité en format banquet</td><td><code>60</code></td></tr>
                <tr><td><code>equipment</code></td><td><code>array&lt;object&gt;</code></td><td>Équipements disponibles</td><td>Voir structure ci-dessous</td></tr>
              </tbody>
            </table>

            <h4>Formats de salle expliqués</h4>
            <p>Les différentes capacités correspondent aux formats d'organisation d'événements :</p>
            
            <table>
              <thead><tr><th>Format</th><th>Description</th><th>Usage typique</th><th>Densité</th></tr></thead>
              <tbody>
                <tr><td><code>cap_theatre</code></td><td>Théâtre (toutes les chaises face à la scène)</td><td>Présentations, conférences</td><td>La plus élevée</td></tr>
                <tr><td><code>cap_classroom</code></td><td>Classe (tables individuelles face à l'avant)</td><td>Formations, cours</td><td>Élevée</td></tr>
                <tr><td><code>cap_u</code></td><td>U (tables en forme de U)</td><td>Réunions interactives</td><td>Moyenne</td></tr>
                <tr><td><code>cap_boardroom</code></td><td>Conseil (table rectangulaire)</td><td>Réunions de direction</td><td>Faible</td></tr>
                <tr><td><code>cap_cocktail</code></td><td>Cocktail (debout, circulation libre)</td><td>Réseautage, apéritifs</td><td>Très élevée</td></tr>
                <tr><td><code>cap_banquet</code></td><td>Banquet (tables rondes)</td><td>Repas, galas</td><td>Moyenne</td></tr>
              </tbody>
            </table>

            <h4>Équipements disponibles</h4>
            <p>Le système supporte plusieurs types d'équipements via le référentiel <code>meeting_equipment</code> :</p>
            
            <table>
              <thead><tr><th>Code</th><th>Nom</th><th>Description</th><th>Usage typique</th></tr></thead>
              <tbody>
                <tr><td><code>projector</code></td><td>Vidéoprojecteur</td><td>Projection d'écran</td><td>Présentations</td></tr>
                <tr><td><code>screen</code></td><td>Écran de projection</td><td>Écran fixe ou mobile</td><td>Présentations</td></tr>
                <tr><td><code>sound_system</code></td><td>Système audio</td><td>Sonorisation</td><td>Conférences</td></tr>
                <tr><td><code>microphone</code></td><td>Microphone</td><td>Micro fixe ou mobile</td><td>Présentations</td></tr>
                <tr><td><code>whiteboard</code></td><td>Tableau blanc</td><td>Tableau effaçable</td><td>Formations</td></tr>
                <tr><td><code>flipchart</code></td><td>Paperboard</td><td>Tableau à feuilles</td><td>Brainstorming</td></tr>
                <tr><td><code>wifi</code></td><td>WiFi</td><td>Accès internet</td><td>Connectivité</td></tr>
                <tr><td><code>air_conditioning</code></td><td>Climatisation</td><td>Contrôle température</td><td>Confort</td></tr>
                <tr><td><code>natural_light</code></td><td>Éclairage naturel</td><td>Fenêtres, lumière du jour</td><td>Confort</td></tr>
                <tr><td><code>catering</code></td><td>Restauration</td><td>Service traiteur</td><td>Événements</td></tr>
              </tbody>
            </table>

            <h4>Exemple concret : Salle de conférence</h4>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "meeting_rooms": [
    {
      "name": "Salle des Palmiers",
      "surface": 120,
      "cap_theatre": 80,
      "cap_u": 24,
      "cap_classroom": 40,
      "cap_boardroom": 16,
      "cap_cocktail": 100,
      "cap_banquet": 60,
      "equipment": [
        {
          "code": "projector",
          "name": "Vidéoprojecteur",
          "icon_url": "https://cdn.example.com/projector.svg"
        },
        {
          "code": "screen",
          "name": "Écran de projection",
          "icon_url": "https://cdn.example.com/screen.svg"
        },
        {
          "code": "sound_system",
          "name": "Système audio",
          "icon_url": "https://cdn.example.com/sound.svg"
        },
        {
          "code": "wifi",
          "name": "WiFi",
          "icon_url": "https://cdn.example.com/wifi.svg"
        },
        {
          "code": "air_conditioning",
          "name": "Climatisation",
          "icon_url": "https://cdn.example.com/ac.svg"
        }
      ]
    }
  ]
}</code></pre>
            </div>

            <h4>Utilisation pratique</h4>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Sélection de salle</div>
              <p><strong>Capacité :</strong> Choisissez le format selon le type d'événement (théâtre pour présentation, U pour réunion interactive).</p>
              <p><strong>Équipements :</strong> Vérifiez la disponibilité des équipements nécessaires (projecteur, son, etc.).</p>
              <p><strong>Surface :</strong> Considérez l'espace nécessaire pour la circulation et les équipements.</p>
            </div>

            <div class="card warning-card" style="margin-top: 16px;">
              <div class="pill warning-pill">Important</div>
              <p>Les capacités indiquées sont <strong>théoriques</strong>. La capacité réelle peut varier selon la configuration, les équipements, et les normes de sécurité en vigueur.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.14 <code>opening_times</code></summary>
          <div class="content">
            <p>Structure d'horaires d'ouverture organisée en deux groupes temporels :</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>PeriodeOuvertures</code></td><td><code>array&lt;object&gt;</code></td><td>Périodes d'ouverture pour l'année courante et suivante</td></tr>
                <tr><td><code>PeriodeOuverturesAnneeSuivantes</code></td><td><code>array&lt;object&gt;</code></td><td>Périodes d'ouverture pour les années suivantes</td></tr>
              </tbody>
            </table>
            
            <h4>Structure d'une période d'ouverture</h4>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>ID</code></td><td><code>string</code></td><td>Identifiant unique de la période</td></tr>
                <tr><td><code>Ordre</code></td><td><code>number</code></td><td>Ordre d'affichage</td></tr>
                <tr><td><code>SyndicObjectId</code></td><td><code>string</code></td><td>Identifiant de l'objet</td></tr>
                <tr><td><code>Datedebut</code></td><td><code>date</code></td><td>Date de début de la période</td></tr>
                <tr><td><code>Datefin</code></td><td><code>date</code></td><td>Date de fin de la période</td></tr>
                <tr><td><code>Joursfermeture</code></td><td><code>array&lt;string&gt;</code></td><td>Jours de fermeture (codes des jours)</td></tr>
                <tr><td><code>[jour]heuredebut1/2</code></td><td><code>string</code></td><td>Heures de début des créneaux (ex. "lundiheuredebut1")</td></tr>
                <tr><td><code>[jour]heurefin1/2</code></td><td><code>string</code></td><td>Heures de fin des créneaux (ex. "lundiheurefin1")</td></tr>
              </tbody>
            </table>
            
            <h4>Jours de la semaine</h4>
            <p>Pour chaque jour (lundi, mardi, mercredi, jeudi, vendredi, samedi, dimanche), jusqu'à 2 créneaux horaires peuvent être définis :</p>
            <ul>
              <li><code>[jour]heuredebut1</code> / <code>[jour]heurefin1</code> : Premier créneau</li>
              <li><code>[jour]heuredebut2</code> / <code>[jour]heurefin2</code> : Deuxième créneau (optionnel)</li>
            </ul>
            
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "PeriodeOuvertures": [
    {
      "ID": "uuid-period-1",
      "Ordre": 1,
      "SyndicObjectId": "OBJ_001",
      "Datedebut": "2024-01-01",
      "Datefin": "2024-12-31",
      "Joursfermeture": [],
      "lundiheuredebut1": "09:00",
      "lundiheurefin1": "18:00",
      "mardiheuredebut1": "09:00",
      "mardiheurefin1": "18:00",
      "mercrediheuredebut1": "09:00",
      "mercrediheurefin1": "12:00",
      "mercrediheuredebut2": "14:00",
      "mercrediheurefin2": "18:00",
      "dimancheheuredebut1": null,
      "dimancheheurefin1": null
    }
  ],
  "PeriodeOuverturesAnneeSuivantes": []
}</code></pre>
            </div>
          </div>
        </details>

        <details>
          <summary>3.15 <code>menus[]</code> (restaurants/événements)</summary>
          <div class="content">
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant du menu</td></tr>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Nom du menu (ex. "Menu déjeuner")</td></tr>
                <tr><td><code>description</code></td><td><code>string</code></td><td>Description du menu</td></tr>
                <tr><td><code>position</code></td><td><code>number</code></td><td>Ordre d'affichage</td></tr>
                <tr><td><code>is_active</code></td><td><code>boolean</code></td><td>Menu actif ?</td></tr>
                <tr><td><code>valid_from / valid_to</code></td><td><code>date</code></td><td>Période de validité</td></tr>
                <tr><td><code>items[]</code></td><td><code>array&lt;object&gt;</code></td><td>Articles du menu</td></tr>
              </tbody>
            </table>
            <h4>Articles de menu (<code>items[]</code>)</h4>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant de l'article</td></tr>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Nom du plat</td></tr>
                <tr><td><code>description</code></td><td><code>string</code></td><td>Description du plat</td></tr>
                <tr><td><code>position</code></td><td><code>number</code></td><td>Ordre dans le menu</td></tr>
                <tr><td><code>price_amount / price_amount_max</code></td><td><code>number</code></td><td>Prix (ou fourchette)</td></tr>
                <tr><td><code>price_currency</code></td><td><code>string</code></td><td>Devise (ex. "EUR")</td></tr>
                <tr><td><code>category</code></td><td><code>object</code></td><td>{ id, code, name } (ex. "Entrée", "Plat principal")</td></tr>
                <tr><td><code>unit</code></td><td><code>object</code></td><td>{ id, code, name } (ex. "par personne", "par portion")</td></tr>
                <tr><td><code>dietary_tags[]</code></td><td><code>array&lt;object&gt;</code></td><td>Tags alimentaires (végétarien, vegan, halal...)</td></tr>
                <tr><td><code>allergens[]</code></td><td><code>array&lt;object&gt;</code></td><td>Allergènes (gluten, arachides, lait...)</td></tr>
                <tr><td><code>media[]</code></td><td><code>array&lt;object&gt;</code></td><td>Médias associés au plat (photos, vidéos...)</td></tr>
              </tbody>
            </table>
            <p><b>Tags & Allergènes</b> : structure <code>{ id, code, name, icon_url }</code></p>
            
            <h4>Médias des articles (<code>media[]</code>)</h4>
            <p>Chaque article de menu peut avoir des médias associés (photos, vidéos, etc.) via la table de liaison <code>object_menu_item_media</code>.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th><th>Exemple</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant du média</td><td><code>"media_123"</code></td></tr>
                <tr><td><code>title</code></td><td><code>string</code></td><td>Titre du média</td><td><code>"Photo du plat principal"</code></td></tr>
                <tr><td><code>description</code></td><td><code>string</code></td><td>Description du média</td><td><code>"Vue rapprochée du plat"</code></td></tr>
                <tr><td><code>url</code></td><td><code>string (URL)</code></td><td>URL du fichier média</td><td><code>"https://cdn.example.com/plat.jpg"</code></td></tr>
                <tr><td><code>credit</code></td><td><code>string</code></td><td>Crédit photo/vidéo</td><td><code>"© Restaurant XYZ"</code></td></tr>
                <tr><td><code>width / height</code></td><td><code>number</code></td><td>Dimensions (si connues)</td><td><code>1920, 1080</code></td></tr>
                <tr><td><code>is_main</code></td><td><code>boolean</code></td><td>Média principal de l'article ?</td><td><code>true</code></td></tr>
                <tr><td><code>is_published</code></td><td><code>boolean</code></td><td>Média publié ?</td><td><code>true</code></td></tr>
                <tr><td><code>position</code></td><td><code>number</code></td><td>Ordre d'affichage</td><td><code>1</code></td></tr>
                <tr><td><code>media_type</code></td><td><code>object</code></td><td>Type de média</td><td><code>{ "id": "1", "code": "image", "name": "Image" }</code></td></tr>
              </tbody>
            </table>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Affichage</div>
              <p>Les médias sont triés par <code>position</code> puis par <code>created_at</code>. Seuls les médias avec <code>is_published: true</code> sont inclus.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.16 <code>places[]</code> (+ <code>descriptions[]</code>)</summary>
          <div class="content">
            <p>Colonnes du lieu (id, nom, position, …).</p>
            <p><code>descriptions[]</code> : multilingue — structure transparente (ex. <code>language</code>, <code>text</code>, <code>position</code>, …).</p>
          </div>
        </details>

        <details>
          <summary>3.17 <code>sustainability_action_labels[]</code></summary>
          <div class="content">
            <p>Associe les actions de durabilité et les labels obtenus.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>object_action_id</code></td><td><code>string</code></td><td>Identifiant de l’action</td></tr>
                <tr><td><code>action</code></td><td><code>object</code></td><td>{ code, label, description, icon_url, category{…}, position }</td></tr>
                <tr><td><code>label</code></td><td><code>object</code></td><td>{ scheme_code, scheme_name, value_code, value_name, awarded_at, valid_until, status }</td></tr>
              </tbody>
            </table>
          </div>
        </details>

        <details>
          <summary>3.18 <code>incoming_relations[]</code> & <code>outgoing_relations[]</code></summary>
          <div class="content">
            <p>Les relations sont exposées par <strong>sens</strong> pour plus de clarté : <code>outgoing_relations[]</code> (liens sortants) et <code>incoming_relations[]</code> (liens entrants). Chaque entrée fournit le type de relation et les métadonnées nécessaires.</p>
            <ul>
              <li><b>outgoing_relations[]</b> : l'objet courant pointe vers une autre ressource exposée sous <code>target: { id, type, name }</code>.</li>
              <li><b>incoming_relations[]</b> : une autre ressource référence l'objet courant, exposée sous <code>source: { id, type, name }</code>.</li>
            </ul>
            <p>Chaque enregistrement conserve les métadonnées du lien (<code>id</code>, <code>relation_type_id</code>, <code>distance_m</code>, <code>note</code>, <code>position</code>, <code>created_at</code>, <code>updated_at</code>) et ajoute le nœud opposé déjà résolu (<code>target</code> ou <code>source</code>).</p>
            <p>Pour interpréter le type de relation, mappez <code>relation_type_id</code> avec la table de référence <code>ref_object_relation_type</code> (code, libellé, description). Les champs <code>distance_m</code> et <code>note</code> restent optionnels et peuvent être utilisés pour afficher une distance ou un commentaire éditorial.</p>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "outgoing_relations": [
    {
  "id": "uuid-relation-1",
  "relation_type_id": "uuid-type-restaurant",
  "position": 1,
  "note": null,
  "distance_m": 120.0,
  "created_at": "2024-03-12T09:15:00Z",
  "updated_at": "2024-03-12T09:15:00Z",
  "target": { "id": "RES-001", "type": "RES", "name": "Restaurant Chez Léon" }
    }
  ],
  "incoming_relations": [
    {
      "id": "uuid-relation-2",
      "relation_type_id": "uuid-type-managed-by",
      "position": 1,
      "note": null,
      "distance_m": null,
      "created_at": "2024-03-12T09:15:00Z",
      "updated_at": "2024-03-12T09:15:00Z",
      "source": { "id": "ORG-456", "type": "ORG", "name": "Organisation Parent" }
    }
  ]
}</code></pre>
            </div>
            <p class="inline-help">Les objets liés ne sont pas étendus : interrogez séparément l'identifiant fourni si vous avez besoin de leurs contacts, adresses ou médias.</p>
            <p class="inline-help"><b>Cas d'usage :</b> un objet « Restaurant » rattaché à un « Hôtel » aura un enregistrement dans <code>outgoing_relations[]</code> pointant vers l'hôtel. Inversement, l'hôtel verra ce restaurant apparaître dans <code>incoming_relations[]</code>.</p>
          </div>
        </details>

        <details>
          <summary>3.19 <code>discounts[]</code></summary>
          <div class="content">
            <p>Liste des réductions et offres spéciales proposées par l'objet.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant unique de la réduction</td></tr>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Nom de l'offre</td></tr>
                <tr><td><code>description</code></td><td><code>string</code></td><td>Description détaillée</td></tr>
                <tr><td><code>discount_percent</code></td><td><code>number</code></td><td>Pourcentage de réduction (0-100)</td></tr>
                <tr><td><code>discount_amount</code></td><td><code>number</code></td><td>Montant de réduction fixe</td></tr>
                <tr><td><code>currency</code></td><td><code>string</code></td><td>Devise (ISO 4217)</td></tr>
                <tr><td><code>conditions</code></td><td><code>string</code></td><td>Conditions d'application</td></tr>
                <tr><td><code>valid_from / valid_to</code></td><td><code>date</code></td><td>Période de validité</td></tr>
                <tr><td><code>is_active</code></td><td><code>boolean</code></td><td>Offre active ?</td></tr>
                <tr><td><code>position</code></td><td><code>number</code></td><td>Ordre d'affichage</td></tr>
              </tbody>
            </table>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "discounts": [
    {
      "id": "discount-1",
      "name": "Réduction séniors",
      "description": "10% de réduction pour les plus de 65 ans",
      "discount_percent": 10.0,
      "discount_amount": null,
      "currency": "EUR",
      "conditions": "Sur présentation d'une pièce d'identité",
      "valid_from": "2024-01-01",
      "valid_to": "2024-12-31",
      "is_active": true,
      "position": 1
    }
  ]
}</code></pre>
            </div>
          </div>
        </details>

        <details>
          <summary>3.20 <code>group_policies[]</code></summary>
          <div class="content">
            <p>Politiques et conditions spécifiques aux groupes.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant unique de la politique</td></tr>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Nom de la politique</td></tr>
                <tr><td><code>description</code></td><td><code>string</code></td><td>Description détaillée</td></tr>
                <tr><td><code>min_size</code></td><td><code>number</code></td><td>Taille minimale du groupe</td></tr>
                <tr><td><code>max_size</code></td><td><code>number</code></td><td>Taille maximale du groupe</td></tr>
                <tr><td><code>notes</code></td><td><code>string</code></td><td>Notes et conditions particulières</td></tr>
                <tr><td><code>is_active</code></td><td><code>boolean</code></td><td>Politique active ?</td></tr>
                <tr><td><code>position</code></td><td><code>number</code></td><td>Ordre d'affichage</td></tr>
              </tbody>
            </table>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "group_policies": [
    {
      "id": "policy-1",
      "name": "Groupes scolaires",
      "description": "Tarifs préférentiels pour les groupes scolaires",
      "min_size": 15,
      "max_size": 50,
      "notes": "Réservation obligatoire 48h à l'avance",
      "is_active": true,
      "position": 1
    }
  ]
}</code></pre>
            </div>
          </div>
        </details>

        <details>
          <summary>3.21 <code>actors[]</code></summary>
          <div class="content">
            <p>Acteurs (personnes physiques) liés à l'objet avec leurs rôles et contacts. <strong>Important :</strong> Les rôles sont définis par le référentiel <code>ref_actor_role</code> qui détermine les codes et libellés des fonctions (director, receptionist, guide, etc.).</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant unique de l'acteur</td></tr>
                <tr><td><code>display_name</code></td><td><code>string</code></td><td>Nom d'affichage complet</td></tr>
                <tr><td><code>first_name</code></td><td><code>string</code></td><td>Prénom</td></tr>
                <tr><td><code>last_name</code></td><td><code>string</code></td><td>Nom de famille</td></tr>
                <tr><td><code>gender</code></td><td><code>enum</code></td><td>Genre (M, F, O)</td></tr>
                <tr><td><code>role</code></td><td><code>object</code></td><td>Rôle de l'acteur : { id, code, name } - Le <code>code</code> correspond à <code>ref_actor_role.code</code></td></tr>
                <tr><td><code>is_primary</code></td><td><code>boolean</code></td><td>Acteur principal ?</td></tr>
                <tr><td><code>valid_from / valid_to</code></td><td><code>date</code></td><td>Période de validité du rôle</td></tr>
                <tr><td><code>visibility</code></td><td><code>enum</code></td><td>Visibilité (public, private)</td></tr>
                <tr><td><code>note</code></td><td><code>string</code></td><td>Note ou commentaire</td></tr>
                <tr><td><code>contacts</code></td><td><code>array&lt;object&gt;</code></td><td>Canaux de contact de l'acteur</td></tr>
              </tbody>
            </table>
            
            <h4>Rôles d'acteurs (<code>ref_actor_role</code>)</h4>
            <p>Le champ <code>role.code</code> fait référence au référentiel <code>ref_actor_role</code> qui définit les types de rôles disponibles dans le système.</p>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th><th>Usage typique</th></tr></thead>
              <tbody>
                <tr><td><code>director</code></td><td>Directeur</td><td>Responsable de l'établissement</td><td>Hôtels, restaurants, attractions</td></tr>
                <tr><td><code>receptionist</code></td><td>Réceptionniste</td><td>Accueil et service client</td><td>Hôtels, offices de tourisme</td></tr>
                <tr><td><code>guide</code></td><td>Guide</td><td>Guide touristique ou accompagnateur</td><td>Agences, sites touristiques</td></tr>
                <tr><td><code>manager</code></td><td>Gestionnaire</td><td>Responsable opérationnel</td><td>Établissements divers</td></tr>
                <tr><td><code>chef</code></td><td>Chef</td><td>Chef de cuisine</td><td>Restaurants, hôtels</td></tr>
                <tr><td><code>owner</code></td><td>Propriétaire</td><td>Propriétaire de l'établissement</td><td>Petits commerces, gîtes</td></tr>
              </tbody>
            </table>
            <div class="card info-card" style="margin-top: 16px;">
              <div class="pill info-pill">Référentiel</div>
              <p>Le référentiel <code>ref_actor_role</code> est consultable via l'API pour obtenir la liste complète des rôles disponibles et leurs libellés multilingues.</p>
            </div>
            
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "actors": [
    {
      "id": "actor-123",
      "display_name": "Marie Martin",
      "first_name": "Marie",
      "last_name": "Martin",
      "gender": "F",
      "role": {
        "id": "role-director",
        "code": "director",
        "name": "Directeur"
      },
      "is_primary": true,
      "valid_from": "2024-01-01",
      "valid_to": "2024-12-31",
      "visibility": "public",
      "note": "Responsable principal",
      "contacts": [
        {
          "id": "contact-1",
          "kind": {
            "code": "email",
            "name": "Email"
          },
          "value": "marie.martin@hotel.com",
          "is_primary": true,
          "role": {
            "code": "work",
            "name": "Professionnel"
          }
        }
      ]
    }
  ]
}</code></pre>
            </div>
          </div>
        </details>

        <details>
          <summary>3.22 <code>legal_records[]</code></summary>
          <div class="content">
            <p>Enregistrements légaux et certifications officielles de l'établissement.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant unique de l'enregistrement</td></tr>
                <tr><td><code>type</code></td><td><code>object</code></td><td>Type de document : { id, code, name, category }</td></tr>
                <tr><td><code>value</code></td><td><code>string</code></td><td>Valeur du document (numéro, référence)</td></tr>
                <tr><td><code>status</code></td><td><code>enum</code></td><td>Statut (active, expired, pending, suspended)</td></tr>
                <tr><td><code>valid_from / valid_to</code></td><td><code>date</code></td><td>Période de validité</td></tr>
                <tr><td><code>validity_mode</code></td><td><code>enum</code></td><td>Mode de validité (fixed_end_date, tacit_renewal, forever)</td></tr>
                <tr><td><code>issuer</code></td><td><code>string</code></td><td>Organisme émetteur</td></tr>
                <tr><td><code>document</code></td><td><code>object</code></td><td>Justificatif : { id, url, title, visibility }</td></tr>
                <tr><td><code>notes</code></td><td><code>string</code></td><td>Notes et commentaires</td></tr>
                <tr><td><code>created_at / updated_at</code></td><td><code>timestamp</code></td><td>Horodatage</td></tr>
              </tbody>
            </table>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "legal_records": [
    {
      "id": "legal-1",
      "type": {
        "id": "type-siret",
        "code": "SIRET",
        "name": "SIRET",
        "category": "business"
      },
      "value": "12345678901234",
      "status": "active",
      "valid_from": "2024-01-01",
      "valid_to": null,
      "validity_mode": "forever",
      "issuer": "INSEE",
      "document": {
        "id": "doc-1",
        "url": "https://.../siret.pdf",
        "title": "Extrait SIRET",
        "visibility": "private"
      },
      "notes": "Mise à jour 2024",
      "created_at": "2024-01-15T10:30:00Z",
      "updated_at": "2024-01-15T10:30:00Z"
    }
  ]
}</code></pre>
            </div>
          </div>
        </details>

        <details>
          <summary>3.23 <code>render</code> (données formatées)</summary>
          <div class="content">
            <p>Bloc contenant des données formatées prêtes à l'affichage, généré quand <code>p_options.render: true</code>.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>lang</code></td><td><code>string</code></td><td>Code langue (ex. "fr")</td></tr>
                <tr><td><code>locale</code></td><td><code>string</code></td><td>Locale complète (ex. "fr-FR")</td></tr>
                <tr><td><code>timezone</code></td><td><code>string</code></td><td>Fuseau horaire (ex. "UTC")</td></tr>
                <tr><td><code>version</code></td><td><code>string</code></td><td>Version du formatage (ex. "1.0")</td></tr>
                <tr><td><code>contact_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes de contact formatées</td></tr>
                <tr><td><code>media_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes de médias formatées</td></tr>
                <tr><td><code>capacity_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes de capacité formatées</td></tr>
                <tr><td><code>amenity_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes d'équipements formatées</td></tr>
                <tr><td><code>price_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes de tarifs formatées</td></tr>
                <tr><td><code>classification_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes de classements formatées</td></tr>
                <tr><td><code>discount_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes de réductions formatées</td></tr>
                <tr><td><code>group_policy_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes de politiques de groupe formatées</td></tr>
                <tr><td><code>actor_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes d'acteurs formatées</td></tr>
                <tr><td><code>legal_record_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes d'enregistrements légaux formatées</td></tr>
                <tr><td><code>menu_item_lines</code></td><td><code>array&lt;string&gt;</code></td><td>Lignes d'articles de menu formatées</td></tr>
              </tbody>
            </table>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>{
  "render": {
    "lang": "fr",
    "locale": "fr-FR",
    "timezone": "UTC",
    "version": "1.0",
    "contact_lines": [
      "Téléphone : +262 123 456 789",
      "Email : contact@hotel.com"
    ],
    "media_lines": [
      "Photo principale : Vue de la plage",
      "Vidéo : Présentation de l'hôtel"
    ],
    "capacity_lines": [
      "Chambres : 42",
      "Lits : 84"
    ],
    "amenity_lines": [
      "Piscine, WiFi, Parking"
    ],
    "price_lines": [
      "Adulte - Par nuit : 120,00 €",
      "Enfant - Par nuit : 60,00 €"
    ]
  }
}</code></pre>
            </div>
          </div>
        </details>

        <details>
          <summary>3.24 Spécifique Itinéraire (<code>type="ITI"</code>)</summary>
          <div class="content">
            <h3><code>itinerary_details</code></h3>
            <ul>
              <li><code>info</code> : méta (ex. conseils, profils altimétriques détaillés…)</li>
              <li><code>profiles[]</code> : variantes / tronçons alternatifs</li>
              <li><code>practices[]</code> : { code, name, icon_url } (ex. "hiking", "mtb")</li>
              <li><code>sections[]</code> : segments/tronçons</li>
              <li><code>stages[]</code> : étapes (avec leur propre <code>media[]</code>)</li>
              <li><code>associated_objects[]</code> : voir ci-dessous pour la structure détaillée</li>
            </ul>

            <h4 style="margin-top: 18px;"><code>associated_objects[]</code></h4>
            <p>Liste les ressources liées à l’itinéraire (hébergements, points d’intérêt, services…) avec le rôle attribué dans l’étape de production.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>associated_object_id</code></td><td><code>string</code></td><td>Identifiant de l’objet lié (identique à <code>target.id</code>, conservé pour compatibilité)</td></tr>
                <tr><td><code>target</code></td><td><code>object | null</code></td><td>{ <code>id</code>, <code>type</code>, <code>name</code> } résolu automatiquement ; peut être <code>null</code> si l’objet n’est plus publié</td></tr>
                <tr><td><code>role_id</code></td><td><code>uuid</code></td><td>Rôle éditorial attribué (mapper via <code>ref_iti_assoc_role</code> pour récupérer code/libellé)</td></tr>
                <tr><td><code>note</code></td><td><code>string | null</code></td><td>Commentaire libre (ex. conseil d’étape)</td></tr>
                <tr><td><code>created_at</code></td><td><code>timestamp</code></td><td>Date de création du lien</td></tr>
                <tr><td><code>updated_at</code></td><td><code>timestamp</code></td><td>Dernière mise à jour du lien</td></tr>
              </tbody>
            </table>
            <p class="inline-help">Les éléments sont triés par nom d’objet puis date de création. Si l’objet cible a été supprimé, <code>target</code> vaut <code>null</code> mais l’identifiant brut reste disponible pour diagnostic.</p>
            <p class="inline-help">Le référentiel <code>ref_iti_assoc_role</code> expose les colonnes <code>{ id, code, name, description, position }</code> : utilisez-le pour afficher un libellé utilisateur.</p>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>"associated_objects": [
  {
    "associated_object_id": "LODGE-42",
    "role_id": "0ab5d76a-55f9-4bdc-9219-6a962fbf9c5d",
    "note": "Hébergement recommandé pour la nuit 2",
    "created_at": "2024-05-06T08:12:11Z",
    "updated_at": "2024-05-14T10:33:02Z",
    "target": { "id": "LODGE-42", "type": "HOT", "name": "Lodge des Cimes" }
  }
]</code></pre>
            </div>
            <h3><code>itinerary</code></h3>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>distance_km</code></td><td><code>number</code></td><td>Distance totale (km)</td></tr>
                <tr><td><code>duration_hours</code></td><td><code>number</code></td><td>Durée moyenne (h)</td></tr>
                <tr><td><code>difficulty_level</code></td><td><code>number</code></td><td>Niveau (échelle interne)</td></tr>
                <tr><td><code>elevation_gain</code></td><td><code>number</code></td><td>Dénivelé + (m)</td></tr>
                <tr><td><code>is_loop</code></td><td><code>boolean</code></td><td>Boucle ?</td></tr>
                <tr><td><code>track</code></td><td><code>string | null</code></td><td>KML/GPX (XML texte) — uniquement si demandé</td></tr>
                <tr><td><code>track_format</code></td><td><code>"kml" | "gpx" | null</code></td><td>Format du tracé si présent</td></tr>
              </tbody>
            </table>
            <p class="inline-help"><b>Rappels tracé</b> — Par défaut <code>track=null</code>. Pour obtenir un tracé, définissez <code>p_track_format</code> à <code>"kml"</code> ou <code>"gpx"</code>. <b>KML</b> : utilisez <code>p_options.stage_color</code> si vous incluez des étapes. <b>GPX</b> : <code>stage_color</code> ignorée.</p>
          </div>
        </details>

        <details>
          <summary>3.25 Spécifique Événement (<code>type="FMA"</code>)</summary>
          <div class="content">
            <p>Les événements peuvent agréger les types de cuisine proposés par leurs restaurants partenaires via le bloc <code>associated_restaurants_cuisine_types[]</code>.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant du type de cuisine</td></tr>
                <tr><td><code>code</code></td><td><code>string</code></td><td>Code fonctionnel (ex. <code>"veggie"</code>)</td></tr>
                <tr><td><code>name</code></td><td><code>string</code></td><td>Libellé affiché</td></tr>
                <tr><td><code>description</code></td><td><code>string | null</code></td><td>Description optionnelle</td></tr>
                <tr><td><code>position</code></td><td><code>number | null</code></td><td>Ordre conseillé du référentiel</td></tr>
              </tbody>
            </table>
            <p>Le tableau est dédupliqué et ne contient que les types présents dans au moins un menu actif d'un restaurant lié via la relation <code>has_restaurant</code>. Les éléments sont triés selon le référentiel (position puis nom/code).</p>
            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>"associated_restaurants_cuisine_types": [
  { "id": "uuid-ct-1", "code": "local", "name": "Cuisine locale", "description": null, "position": 10 },
  { "id": "uuid-ct-2", "code": "veggie", "name": "Option végétarienne", "description": null, "position": 40 }
]</code></pre>
            </div>
            <p class="inline-help">Si aucun restaurant associé ne publie de menu actif, le tableau est vide.</p>
          </div>
        </details>


        <details>
          <summary>3.26 <code>documents[]</code> (référentiel partagé)</summary>
          <div class="content">
            <p>Ce tableau regroupe l’ensemble des pièces justificatives exposées par l’API (qu’elles soient liées à la fiche légale, à une classification ou à une action RSE). Chaque entrée correspond à un enregistrement de <code>ref_document</code> relié à l’objet.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant unique du document</td></tr>
                <tr><td><code>url</code></td><td><code>string</code></td><td>URL de téléchargement (soumise aux contrôles de visibilité)</td></tr>
                <tr><td><code>title</code></td><td><code>string|null</code></td><td>Titre humain affichable</td></tr>
                <tr><td><code>issuer</code></td><td><code>string|null</code></td><td>Source officielle</td></tr>
                <tr><td><code>description</code></td><td><code>string|null</code></td><td>Notes complémentaires</td></tr>
                <tr><td><code>valid_from / valid_to</code></td><td><code>date|null</code></td><td>Période de validité</td></tr>
                <tr><td><code>visibility</code></td><td><code>enum</code></td><td><code>"public"</code> ou <code>"private"</code></td></tr>
                <tr><td><code>position</code></td><td><code>number|null</code></td><td>Ordre d’affichage suggéré</td></tr>
                <tr><td><code>tags</code></td><td><code>array&lt;string&gt;</code></td><td>Raccourcis métiers (ex. <code>["legal", "rse"]</code>)</td></tr>
              </tbody>
            </table>

            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>"documents": [
  {
    "id": "0518c3c1-6f35-40f0-bd26-19ccaf7bc93a",
    "url": "https://cdn.example.tld/docs/certificat-accessibilite.pdf",
    "title": "Certificat accessibilité 2025",
    "issuer": "Préfecture",
    "description": "Valable jusqu'au 31/12/2025",
    "valid_from": "2024-01-01",
    "valid_to": "2025-12-31",
    "visibility": "public",
    "position": 1,
    "tags": ["legal", "handicap"]
  }
]</code></pre>
            </div>

            <div class="card info-card" style="margin-top: 12px;">
              <div class="pill info-pill">Agrégation</div>
              <p>Le tableau est dédupliqué côté SQL afin d’éviter d’exposer plusieurs fois la même ressource lorsqu’elle est utilisée à la fois pour un classement et pour la fiche légale. Les doublons sont fusionnés sur l’identifiant de document.</p>
            </div>
          </div>
        </details>

        <details>
          <summary>3.27 <code>document_requests[]</code> (suivi des pièces)</summary>
          <div class="content">
            <p>Ce bloc retrace la vie des demandes de documents métiers : qui a demandé quoi, quand l’objet a fourni la pièce et si la visibilité est publique ou réservée. Les informations proviennent du module de suivi <code>document_request</code>.</p>
            <table>
              <thead><tr><th>Champ</th><th>Type</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>id</code></td><td><code>string</code></td><td>Identifiant unique de la demande</td></tr>
                <tr><td><code>document_id</code></td><td><code>string</code></td><td>Référence vers <code>documents[]</code> / <code>ref_document</code></td></tr>
                <tr><td><code>status</code></td><td><code>enum</code></td><td><code>"requested"</code>, <code>"received"</code>, <code>"expired"</code>, <code>"rejected"</code>…</td></tr>
                <tr><td><code>requested_at</code></td><td><code>timestamp</code></td><td>Date/heure de la demande</td></tr>
                <tr><td><code>due_at</code></td><td><code>timestamp|null</code></td><td>Échéance attendue (optionnelle)</td></tr>
                <tr><td><code>delivered_at</code></td><td><code>timestamp|null</code></td><td>Date de réception de la pièce</td></tr>
                <tr><td><code>visibility</code></td><td><code>enum</code></td><td>Alignée sur la visibilité du document remis</td></tr>
                <tr><td><code>requested_by</code></td><td><code>string|null</code></td><td>Identité (email ou service) à l’origine de la demande</td></tr>
                <tr><td><code>notes</code></td><td><code>string|null</code></td><td>Commentaire interne sur la demande</td></tr>
              </tbody>
            </table>

            <div class="card tip-card" style="margin-top: 16px;">
              <div class="pill tip-pill">Exemple</div>
              <pre style="background: var(--code-bg); color: var(--code); padding: 12px; border-radius: 8px; margin: 8px 0; overflow-x: auto;"><code>"document_requests": [
  {
    "id": "dreq-2025-04",
    "document_id": "0518c3c1-6f35-40f0-bd26-19ccaf7bc93a",
    "status": "received",
    "requested_at": "2025-02-01T08:15:00Z",
    "due_at": "2025-03-01T00:00:00Z",
    "delivered_at": "2025-02-10T14:22:11Z",
    "visibility": "public",
    "requested_by": "legal@oti-sud.fr",
    "notes": "Document contrôlé et validé"
  }
]</code></pre>
            </div>

            <div class="card info-card" style="margin-top: 12px;">
              <div class="pill info-pill">Usage</div>
              <p>Les applications clientes peuvent exploiter ce flux pour relancer automatiquement les partenaires ou afficher l’historique des justificatifs attendus. Les statuts et horodatages sont mis à jour par les fonctions SQL dédiées au module documentaire.</p>
            </div>
          </div>
        </details>
      </section>

      <!-- 4) Types de référence -->
      <section class="card" id="reference-types">
        <h2>4) Types de référence</h2>
        <div class="content">
          <p>Référentiels utilisés pour les filtres et l'interprétation des données de sortie.</p>
            
            <h4><code>accommodation_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>hotel</code></td><td>Hôtel</td><td>Établissement hôtelier classique</td></tr>
                <tr><td><code>gite</code></td><td>Gîte</td><td>Gîte rural, gîte d'étape</td></tr>
                <tr><td><code>camping</code></td><td>Camping</td><td>Camping, aire de camping-car</td></tr>
                <tr><td><code>chambre_hote</code></td><td>Chambre d'hôte</td><td>Chambre d'hôte, B&B</td></tr>
                <tr><td><code>residence</code></td><td>Résidence</td><td>Résidence de tourisme</td></tr>
                <tr><td><code>auberge</code></td><td>Auberge</td><td>Auberge de jeunesse</td></tr>
              </tbody>
            </table>

            <h4><code>room_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>single</code></td><td>Chambre simple</td><td>1 lit simple</td></tr>
                <tr><td><code>double</code></td><td>Chambre double</td><td>1 lit double</td></tr>
                <tr><td><code>twin</code></td><td>Chambre twin</td><td>2 lits simples</td></tr>
                <tr><td><code>triple</code></td><td>Chambre triple</td><td>3 lits</td></tr>
                <tr><td><code>family</code></td><td>Chambre familiale</td><td>4+ lits</td></tr>
                <tr><td><code>suite</code></td><td>Suite</td><td>Suite de luxe</td></tr>
              </tbody>
            </table>

            <h4><code>tourism_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>cultural</code></td><td>Culturel</td><td>Musées, monuments, patrimoine</td></tr>
                <tr><td><code>nature</code></td><td>Nature</td><td>Parcs, randonnées, observation</td></tr>
                <tr><td><code>adventure</code></td><td>Aventure</td><td>Sports extrêmes, activités</td></tr>
                <tr><td><code>wellness</code></td><td>Bien-être</td><td>Spa, relaxation, thermalisme</td></tr>
                <tr><td><code>gastronomy</code></td><td>Gastronomie</td><td>Dégustation, cuisine locale</td></tr>
                <tr><td><code>business</code></td><td>Affaires</td><td>Congrès, séminaires</td></tr>
              </tbody>
            </table>

            <h4><code>ref_legal_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Catégorie</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>SIRET</code></td><td>SIRET</td><td>business</td><td>Numéro SIRET de l'entreprise</td></tr>
                <tr><td><code>SIREN</code></td><td>SIREN</td><td>business</td><td>Numéro SIREN de l'entreprise</td></tr>
                <tr><td><code>VAT</code></td><td>N° TVA</td><td>business</td><td>Numéro de TVA intracommunautaire</td></tr>
                <tr><td><code>LICENSE</code></td><td>Licence</td><td>accommodation</td><td>Licence d'exploitation</td></tr>
                <tr><td><code>TAX_SEJOUR</code></td><td>Taxe de séjour</td><td>accommodation</td><td>Enregistrement taxe de séjour</td></tr>
                <tr><td><code>INSURANCE</code></td><td>Assurance</td><td>business</td><td>Police d'assurance</td></tr>
                <tr><td><code>PERMIT</code></td><td>Autorisation</td><td>business</td><td>Permis d'exploitation</td></tr>
              </tbody>
            </table>

            <h4><code>legal_validity_mode</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>fixed_end_date</code></td><td>Date de fin fixe</td><td>Le document expire à une date précise</td></tr>
                <tr><td><code>tacit_renewal</code></td><td>Renouvellement tacite</td><td>Le document se renouvelle automatiquement</td></tr>
                <tr><td><code>forever</code></td><td>Permanent</td><td>Le document n'a pas de date d'expiration</td></tr>
              </tbody>
            </table>

            <h4><code>ref_capacity_metric</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>beds</code></td><td>Lits</td><td>Nombre de lits disponibles</td></tr>
                <tr><td><code>rooms</code></td><td>Chambres</td><td>Nombre de chambres</td></tr>
                <tr><td><code>max_capacity</code></td><td>Capacité max</td><td>Capacité maximale d'accueil</td></tr>
                <tr><td><code>seats</code></td><td>Places assises</td><td>Nombre de places assises (restaurants)</td></tr>
                <tr><td><code>parking_spaces</code></td><td>Places de parking</td><td>Nombre de places de stationnement</td></tr>
                <tr><td><code>meeting_rooms</code></td><td>Salles de réunion</td><td>Nombre de salles de réunion</td></tr>
              </tbody>
            </table>

            <h4><code>ref_actor_role</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>director</code></td><td>Directeur</td><td>Directeur de l'établissement</td></tr>
                <tr><td><code>manager</code></td><td>Gestionnaire</td><td>Gestionnaire, responsable</td></tr>
                <tr><td><code>receptionist</code></td><td>Réceptionniste</td><td>Accueil, réception</td></tr>
                <tr><td><code>guide</code></td><td>Guide</td><td>Guide touristique, accompagnateur</td></tr>
                <tr><td><code>chef</code></td><td>Chef</td><td>Chef de cuisine</td></tr>
                <tr><td><code>waiter</code></td><td>Serveur</td><td>Serveur, personnel de salle</td></tr>
                <tr><td><code>maintenance</code></td><td>Maintenance</td><td>Personnel de maintenance</td></tr>
                <tr><td><code>security</code></td><td>Sécurité</td><td>Agent de sécurité</td></tr>
              </tbody>
            </table>

            <h4><code>client_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>individual</code></td><td>Individuel</td><td>Client individuel</td></tr>
                <tr><td><code>family</code></td><td>Famille</td><td>Famille avec enfants</td></tr>
                <tr><td><code>business_traveler</code></td><td>Voyageur d'affaires</td><td>Client professionnel</td></tr>
                <tr><td><code>group</code></td><td>Groupe</td><td>Groupe organisé</td></tr>
                <tr><td><code>senior</code></td><td>Sénior</td><td>Personne âgée</td></tr>
                <tr><td><code>student</code></td><td>Étudiant</td><td>Étudiant/jeune</td></tr>
              </tbody>
            </table>

            <h4><code>service_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>accommodation</code></td><td>Hébergement</td><td>Services d'hébergement</td></tr>
                <tr><td><code>restaurant</code></td><td>Restauration</td><td>Services de restauration</td></tr>
                <tr><td><code>transport</code></td><td>Transport</td><td>Services de transport</td></tr>
                <tr><td><code>activity</code></td><td>Activité</td><td>Activités touristiques</td></tr>
                <tr><td><code>entertainment</code></td><td>Divertissement</td><td>Services de divertissement</td></tr>
                <tr><td><code>wellness</code></td><td>Bien-être</td><td>Services de bien-être</td></tr>
              </tbody>
            </table>

            <h4><code>transport_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>airplane</code></td><td>Avion</td><td>Transport aérien</td></tr>
                <tr><td><code>train</code></td><td>Train</td><td>Transport ferroviaire</td></tr>
                <tr><td><code>bus</code></td><td>Bus</td><td>Transport par bus</td></tr>
                <tr><td><code>car</code></td><td>Voiture</td><td>Transport automobile</td></tr>
                <tr><td><code>boat</code></td><td>Bateau</td><td>Transport maritime</td></tr>
                <tr><td><code>walking</code></td><td>Marche</td><td>Déplacement à pied</td></tr>
              </tbody>
            </table>

            <h4><code>activity_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>hiking</code></td><td>Randonnée</td><td>Randonnée pédestre</td></tr>
                <tr><td><code>diving</code></td><td>Plongée</td><td>Plongée sous-marine</td></tr>
                <tr><td><code>museum_visit</code></td><td>Visite musée</td><td>Visite de musée</td></tr>
                <tr><td><code>beach</code></td><td>Plage</td><td>Activités de plage</td></tr>
                <tr><td><code>cultural</code></td><td>Culturel</td><td>Activités culturelles</td></tr>
                <tr><td><code>adventure</code></td><td>Aventure</td><td>Sports d'aventure</td></tr>
              </tbody>
            </table>

            <h4><code>destination_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>urban</code></td><td>Urbain</td><td>Destination urbaine</td></tr>
                <tr><td><code>coastal</code></td><td>Côtier</td><td>Destination côtière</td></tr>
                <tr><td><code>mountain</code></td><td>Montagne</td><td>Destination montagnarde</td></tr>
                <tr><td><code>rural</code></td><td>Rural</td><td>Destination rurale</td></tr>
                <tr><td><code>island</code></td><td>Île</td><td>Destination insulaire</td></tr>
                <tr><td><code>desert</code></td><td>Désert</td><td>Destination désertique</td></tr>
              </tbody>
            </table>

            <h4><code>price_kind</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>adulte</code></td><td>Adulte</td><td>Tarif adulte</td></tr>
                <tr><td><code>enfant</code></td><td>Enfant</td><td>Tarif enfant</td></tr>
                <tr><td><code>groupe</code></td><td>Groupe</td><td>Tarif de groupe</td></tr>
                <tr><td><code>gratuit</code></td><td>Gratuit</td><td>Entrée gratuite</td></tr>
                <tr><td><code>senior</code></td><td>Sénior</td><td>Tarif sénior</td></tr>
                <tr><td><code>etudiant</code></td><td>Étudiant</td><td>Tarif étudiant</td></tr>
              </tbody>
            </table>

            <h4><code>price_unit</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>par_personne</code></td><td>Par personne</td><td>Prix par personne</td></tr>
                <tr><td><code>par_nuit</code></td><td>Par nuit</td><td>Prix par nuitée</td></tr>
                <tr><td><code>par_heure</code></td><td>Par heure</td><td>Prix par heure</td></tr>
                <tr><td><code>par_jour</code></td><td>Par jour</td><td>Prix par jour</td></tr>
                <tr><td><code>forfait</code></td><td>Forfait</td><td>Prix forfaitaire</td></tr>
                <tr><td><code>gratuit</code></td><td>Gratuit</td><td>Entrée gratuite</td></tr>
              </tbody>
            </table>

            <h4><code>season_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>high_season</code></td><td>Haute saison</td><td>Période de haute saison</td></tr>
                <tr><td><code>low_season</code></td><td>Basse saison</td><td>Période de basse saison</td></tr>
                <tr><td><code>winter</code></td><td>Hiver</td><td>Saison hivernale</td></tr>
                <tr><td><code>summer</code></td><td>Été</td><td>Saison estivale</td></tr>
                <tr><td><code>cyclone_season</code></td><td>Saison cyclonique</td><td>Période cyclonique</td></tr>
                <tr><td><code>shoulder_season</code></td><td>Mi-saison</td><td>Période intermédiaire</td></tr>
              </tbody>
            </table>

            <h4><code>promotion_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>early_booking</code></td><td>Réservation anticipée</td><td>Réduction réservation anticipée</td></tr>
                <tr><td><code>last_minute</code></td><td>Dernière minute</td><td>Offre dernière minute</td></tr>
                <tr><td><code>loyalty</code></td><td>Fidélité</td><td>Réduction fidélité</td></tr>
                <tr><td><code>group</code></td><td>Groupe</td><td>Réduction groupe</td></tr>
                <tr><td><code>seasonal</code></td><td>Saisonnière</td><td>Offre saisonnière</td></tr>
                <tr><td><code>package</code></td><td>Forfait</td><td>Réduction forfait</td></tr>
              </tbody>
            </table>

            <h4><code>package_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>all_inclusive</code></td><td>Tout inclus</td><td>Forfait tout inclus</td></tr>
                <tr><td><code>half_board</code></td><td>Demi-pension</td><td>Hébergement + petit-déjeuner + dîner</td></tr>
                <tr><td><code>full_board</code></td><td>Pension complète</td><td>Hébergement + tous les repas</td></tr>
                <tr><td><code>flight_hotel</code></td><td>Vol + Hôtel</td><td>Forfait transport + hébergement</td></tr>
                <tr><td><code>activity_package</code></td><td>Forfait activité</td><td>Hébergement + activités</td></tr>
                <tr><td><code>romantic</code></td><td>Romantique</td><td>Forfait romantique</td></tr>
              </tbody>
            </table>

            <h4><code>cuisine_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>creole</code></td><td>Créole</td><td>Cuisine créole locale</td></tr>
                <tr><td><code>metropolitan</code></td><td>Métropolitaine</td><td>Cuisine française métropolitaine</td></tr>
                <tr><td><code>vegan</code></td><td>Végan</td><td>Cuisine végétalienne</td></tr>
                <tr><td><code>vegetarian</code></td><td>Végétarienne</td><td>Cuisine végétarienne</td></tr>
                <tr><td><code>seafood</code></td><td>Fruits de mer</td><td>Cuisine de fruits de mer</td></tr>
                <tr><td><code>local</code></td><td>Locale</td><td>Cuisine locale traditionnelle</td></tr>
              </tbody>
            </table>

            <h4><code>menu_category</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>entree</code></td><td>Entrée</td><td>Plats d'entrée</td></tr>
                <tr><td><code>main</code></td><td>Plat principal</td><td>Plats principaux</td></tr>
                <tr><td><code>dessert</code></td><td>Dessert</td><td>Desserts</td></tr>
                <tr><td><code>drink</code></td><td>Boisson</td><td>Boissons</td></tr>
                <tr><td><code>appetizer</code></td><td>Amuse-bouche</td><td>Amuse-bouches</td></tr>
                <tr><td><code>side</code></td><td>Accompagnement</td><td>Accompagnements</td></tr>
              </tbody>
            </table>

            <h4><code>dietary_tag</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>vegetarian</code></td><td>Végétarien</td><td>Convient aux végétariens</td></tr>
                <tr><td><code>vegan</code></td><td>Végan</td><td>Convient aux végans</td></tr>
                <tr><td><code>halal</code></td><td>Halal</td><td>Certifié halal</td></tr>
                <tr><td><code>kosher</code></td><td>Casher</td><td>Certifié casher</td></tr>
                <tr><td><code>gluten_free</code></td><td>Sans gluten</td><td>Sans gluten</td></tr>
                <tr><td><code>lactose_free</code></td><td>Sans lactose</td><td>Sans lactose</td></tr>
              </tbody>
            </table>

            <h4><code>allergen</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>gluten</code></td><td>Gluten</td><td>Contient du gluten</td></tr>
                <tr><td><code>dairy</code></td><td>Lait</td><td>Contient des produits laitiers</td></tr>
                <tr><td><code>nuts</code></td><td>Noix</td><td>Contient des noix</td></tr>
                <tr><td><code>eggs</code></td><td>Œufs</td><td>Contient des œufs</td></tr>
                <tr><td><code>soy</code></td><td>Soja</td><td>Contient du soja</td></tr>
                <tr><td><code>shellfish</code></td><td>Crustacés</td><td>Contient des crustacés</td></tr>
              </tbody>
            </table>

            <h4><code>event_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>festival</code></td><td>Festival</td><td>Festival culturel</td></tr>
                <tr><td><code>conference</code></td><td>Conférence</td><td>Conférence professionnelle</td></tr>
                <tr><td><code>wedding</code></td><td>Mariage</td><td>Cérémonie de mariage</td></tr>
                <tr><td><code>exhibition</code></td><td>Exposition</td><td>Exposition artistique</td></tr>
                <tr><td><code>concert</code></td><td>Concert</td><td>Concert musical</td></tr>
                <tr><td><code>sport</code></td><td>Sport</td><td>Événement sportif</td></tr>
              </tbody>
            </table>

            <h4><code>iti_practice</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>randonnee_pedestre</code></td><td>Randonnée pédestre</td><td>Randonnée à pied</td></tr>
                <tr><td><code>velo_vtt</code></td><td>Vélo/VTT</td><td>Cyclisme et VTT</td></tr>
                <tr><td><code>equitation</code></td><td>Équitation</td><td>Randonnée équestre</td></tr>
                <tr><td><code>kayak</code></td><td>Kayak</td><td>Navigation en kayak</td></tr>
                <tr><td><code>plongee</code></td><td>Plongée</td><td>Plongée sous-marine</td></tr>
                <tr><td><code>escalade</code></td><td>Escalade</td><td>Escalade et varappe</td></tr>
              </tbody>
            </table>

            <h4><code>contact_kind</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>phone</code></td><td>Téléphone</td><td>Numéro de téléphone</td></tr>
                <tr><td><code>email</code></td><td>Email</td><td>Adresse email</td></tr>
                <tr><td><code>whatsapp</code></td><td>WhatsApp</td><td>Contact WhatsApp</td></tr>
                <tr><td><code>website</code></td><td>Site web</td><td>Site internet</td></tr>
                <tr><td><code>address</code></td><td>Adresse</td><td>Adresse physique</td></tr>
                <tr><td><code>fax</code></td><td>Fax</td><td>Numéro de fax</td></tr>
              </tbody>
            </table>

            <h4><code>social_network</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>facebook</code></td><td>Facebook</td><td>Page Facebook</td></tr>
                <tr><td><code>instagram</code></td><td>Instagram</td><td>Compte Instagram</td></tr>
                <tr><td><code>youtube</code></td><td>YouTube</td><td>Chaîne YouTube</td></tr>
                <tr><td><code>twitter</code></td><td>Twitter</td><td>Compte Twitter</td></tr>
                <tr><td><code>linkedin</code></td><td>LinkedIn</td><td>Page LinkedIn</td></tr>
                <tr><td><code>tiktok</code></td><td>TikTok</td><td>Compte TikTok</td></tr>
              </tbody>
            </table>

            <h4><code>media_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>photo</code></td><td>Photo</td><td>Image photographique</td></tr>
                <tr><td><code>video</code></td><td>Vidéo</td><td>Vidéo</td></tr>
                <tr><td><code>logo</code></td><td>Logo</td><td>Logo de l'établissement</td></tr>
                <tr><td><code>brochure_pdf</code></td><td>Brochure PDF</td><td>Document PDF</td></tr>
                <tr><td><code>audio</code></td><td>Audio</td><td>Fichier audio</td></tr>
                <tr><td><code>panorama</code></td><td>Panorama</td><td>Image panoramique</td></tr>
              </tbody>
            </table>

            <h4><code>environment_tag</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>plage</code></td><td>Plage</td><td>Environnement de plage</td></tr>
                <tr><td><code>montagne</code></td><td>Montagne</td><td>Environnement montagnard</td></tr>
                <tr><td><code>patrimoine</code></td><td>Patrimoine</td><td>Site patrimonial</td></tr>
                <tr><td><code>foret</code></td><td>Forêt</td><td>Environnement forestier</td></tr>
                <tr><td><code>urbain</code></td><td>Urbain</td><td>Environnement urbain</td></tr>
                <tr><td><code>rural</code></td><td>Rural</td><td>Environnement rural</td></tr>
              </tbody>
            </table>

            <h4><code>amenity_family</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>comforts</code></td><td>Conforts</td><td>Équipements de confort</td></tr>
                <tr><td><code>services</code></td><td>Services</td><td>Services proposés</td></tr>
                <tr><td><code>outdoor</code></td><td>Extérieur</td><td>Équipements extérieurs</td></tr>
                <tr><td><code>sports</code></td><td>Sports</td><td>Équipements sportifs</td></tr>
                <tr><td><code>wellness</code></td><td>Bien-être</td><td>Équipements bien-être</td></tr>
                <tr><td><code>business</code></td><td>Affaires</td><td>Équipements professionnels</td></tr>
              </tbody>
            </table>

            <h4><code>ref_object_relation_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>parent_of</code></td><td>Parent de</td><td>Relation parent-enfant</td></tr>
                <tr><td><code>part_of</code></td><td>Partie de</td><td>Fait partie de</td></tr>
                <tr><td><code>partner_of</code></td><td>Partenaire de</td><td>Partenariat commercial</td></tr>
                <tr><td><code>near_to</code></td><td>Près de</td><td>Proximité géographique</td></tr>
                <tr><td><code>managed_by</code></td><td>Géré par</td><td>Gestion administrative</td></tr>
                <tr><td><code>owned_by</code></td><td>Propriété de</td><td>Propriété</td></tr>
              </tbody>
            </table>

            <h4><code>ref_classification_scheme</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>hot_stars</code></td><td>Étoiles hôtel</td><td>Classification hôtelière</td></tr>
                <tr><td><code>tourisme_handicap</code></td><td>Tourisme & Handicap</td><td>Label accessibilité</td></tr>
                <tr><td><code>eco_label</code></td><td>Écolabel</td><td>Certification environnementale</td></tr>
                <tr><td><code>quality_label</code></td><td>Label qualité</td><td>Label de qualité</td></tr>
                <tr><td><code>heritage</code></td><td>Patrimoine</td><td>Classification patrimoniale</td></tr>
                <tr><td><code>gastronomy</code></td><td>Gastronomie</td><td>Label gastronomique</td></tr>
              </tbody>
            </table>

            <h4><code>insurance_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>travel</code></td><td>Voyage</td><td>Assurance voyage</td></tr>
                <tr><td><code>medical</code></td><td>Médicale</td><td>Assurance médicale</td></tr>
                <tr><td><code>cancellation</code></td><td>Annulation</td><td>Assurance annulation</td></tr>
                <tr><td><code>liability</code></td><td>Responsabilité</td><td>Assurance responsabilité</td></tr>
                <tr><td><code>property</code></td><td>Biens</td><td>Assurance des biens</td></tr>
                <tr><td><code>activity</code></td><td>Activité</td><td>Assurance activité</td></tr>
              </tbody>
            </table>

            <h4><code>assistance_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>customer_service</code></td><td>Service client</td><td>Assistance clientèle</td></tr>
                <tr><td><code>emergency</code></td><td>Urgence</td><td>Assistance d'urgence</td></tr>
                <tr><td><code>legal</code></td><td>Légale</td><td>Assistance juridique</td></tr>
                <tr><td><code>medical</code></td><td>Médicale</td><td>Assistance médicale</td></tr>
                <tr><td><code>technical</code></td><td>Technique</td><td>Assistance technique</td></tr>
                <tr><td><code>concierge</code></td><td>Conciergerie</td><td>Service de conciergerie</td></tr>
              </tbody>
            </table>

            <h4><code>feedback_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>online_review</code></td><td>Avis en ligne</td><td>Avis client en ligne</td></tr>
                <tr><td><code>complaint</code></td><td>Plainte</td><td>Plainte client</td></tr>
                <tr><td><code>suggestion</code></td><td>Suggestion</td><td>Suggestion d'amélioration</td></tr>
                <tr><td><code>compliment</code></td><td>Compliment</td><td>Félicitation client</td></tr>
                <tr><td><code>rating</code></td><td>Note</td><td>Évaluation numérique</td></tr>
                <tr><td><code>survey</code></td><td>Enquête</td><td>Enquête de satisfaction</td></tr>
              </tbody>
            </table>

            <h4><code>partnership_type</code></h4>
            <table>
              <thead><tr><th>Code</th><th>Libellé</th><th>Description</th></tr></thead>
              <tbody>
                <tr><td><code>hotel</code></td><td>Hôtel</td><td>Partenariat hôtelier</td></tr>
                <tr><td><code>airline</code></td><td>Compagnie aérienne</td><td>Partenariat aérien</td></tr>
                <tr><td><code>local_business</code></td><td>Commerce local</td><td>Partenariat local</td></tr>
                <tr><td><code>tour_operator</code></td><td>Tour-opérateur</td><td>Partenariat tour-opérateur</td></tr>
                <tr><td><code>restaurant</code></td><td>Restaurant</td><td>Partenariat restauration</td></tr>
                <tr><td><code>activity_provider</code></td><td>Prestataire d'activités</td><td>Partenariat activités</td></tr>
              </tbody>
            </table>
        </div>
      </section>

      <!-- 5) Exemples pratiques (HTTP) -->
      <section class="card" id="examples">
        <h2>5) Exemples pratiques (HTTP)</h2>

        <details open>
          <summary>5.1 Un objet ITI sans tracé (léger)</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-41">Copier</button>
<pre id="ex-41">curl -X POST "{BASE_URL}/rpc/get_object_resource" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{ "p_object_id": "ITI123", "p_track_format": "none" }'</pre>
          </div>
        </details>

        <details>
          <summary>5.2 Le même objet ITI avec KML, étapes en bleu</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-42">Copier</button>
<pre id="ex-42">curl -X POST "{BASE_URL}/rpc/get_object_resource" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_object_id": "ITI123",
    "p_track_format": "kml",
    "p_options": { "include_stages": true, "stage_color": "blue" }
  }'</pre>
          </div>
        </details>

        <details>
          <summary>5.3 Liste paginée d'itinéraires publiés, 20 par page</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-43a">Copier</button>
<pre id="ex-43a">curl -X POST "{BASE_URL}/rpc/list_object_resources_page" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{ "p_page_size": 20, "p_types": ["ITI"], "p_status": ["published"] }'</pre>
            <p class="inline-help">Puis, pour la page suivante, reprenez <code>info.next_cursor</code> :</p>
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-43b">Copier</button>
<pre id="ex-43b">curl -X POST "{BASE_URL}/rpc/list_object_resources_page" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{ "p_cursor": "&lt;valeur de next_cursor&gt;" }'</pre>
          </div>
        </details>

        <details>
          <summary>5.4 Sync incrémentale depuis une date (keyset)</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-44">Copier</button>
<pre id="ex-44">curl -X POST "{BASE_URL}/rpc/list_object_resources_since_fast" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_since": "2024-04-01T00:00:00Z",
    "p_types": ["ITI"], "p_status": ["published"]
  }'</pre>
            <p class="inline-help">Bouclez avec <code>p_cursor</code> tant que <code>next_cursor</code> n’est pas <code>null</code>.</p>
          </div>
        </details>

        <details>
          <summary>5.5 Liste filtrée (ITI boucles ≤ 15 km, à 20 km de 45.76/4.84, avec image principale)</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-45">Copier</button>
<pre id="ex-45">curl -X POST "{BASE_URL}/rpc/list_object_resources_filtered_page" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_page_size": 24,
    "p_types": ["ITI"],
    "p_filters": {
      "itinerary": { "is_loop": true, "distance_max_km": 15, "practices_any": ["hiking"] },
      "within_radius": { "lat": 45.76, "lon": 4.84, "radius_m": 20000 },
      "media_types_any": ["image"],
      "media_published_only": true,
      "media_must_have_main": true
    }
  }'</pre>
          </div>
        </details>

        <details>
          <summary>5.6 Restaurant avec menu complet</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-46">Copier</button>
<pre id="ex-46">curl -X POST "{BASE_URL}/rpc/get_object_resource" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_object_id": "RESTAURANT-001",
    "p_lang_prefs": ["fr", "en"]
  }'</pre>
            </div>
            <p class="inline-help">La réponse inclura les <code>menus[]</code> avec leurs <code>items[]</code>, catégories, prix, tags alimentaires et allergènes.</p>
          </div>
        </details>

        <details>
          <summary>5.7 Récupération avec Deep Data</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-47">Copier</button>
<pre id="ex-47">curl -X POST "{BASE_URL}/rpc/get_object_with_deep_data" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{ "p_object_id": "HOT123" }'</pre>
            <p class="inline-help">Retourne l'objet avec ses objets parents, acteurs et organisations liées.</p>
          </div>
        </details>

        <details>
          <summary>5.8 Recherche de restaurants par cuisine</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-48">Copier</button>
<pre id="ex-48">curl -X POST "{BASE_URL}/rpc/search_restaurants_by_cuisine" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_cuisine_types": ["local", "veggie", "seafood"],
    "p_languages": ["fr", "en"],
    "p_limit": 20
  }'</pre>
            <p class="inline-help">Recherche spécialisée pour trouver des restaurants par types de cuisine.</p>
          </div>
        </details>

        <details>
          <summary>5.9 Recherche d'événements par cuisine de restaurant</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-49">Copier</button>
<pre id="ex-49">curl -X POST "{BASE_URL}/rpc/search_events_by_restaurant_cuisine" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_cuisine_types": ["local", "gastronomy"],
    "p_languages": ["fr"],
    "p_limit": 15
  }'</pre>
            <p class="inline-help">Trouve des événements (FMA) basés sur les types de cuisine des restaurants associés.</p>
          </div>
        </details>

        <details>
          <summary>5.10 Récupération avec options avancées</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-410">Copier</button>
<pre id="ex-410">curl -X POST "{BASE_URL}/rpc/get_object_resource" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_object_id": "HOT123",
    "p_lang_prefs": ["fr", "en"],
    "p_options": {
      "render": true,
      "render_locale": "fr-FR",
      "render_tz": "Europe/Paris",
      "fields": ["id", "name", "contacts", "media", "actors"],
      "org_object_id": "ORG456"
    }
  }'</pre>
            <p class="inline-help">Exemple avec contrôle du rendu, filtrage des champs et préférence d'organisation.</p>
          </div>
        </details>

        <details>
          <summary>5.11 Événement avec menu (FMA)</summary>
          <div class="content">
            <div style="position:relative;">
              <button class="copy copy-floating" data-copy="#ex-47">Copier</button>
<pre id="ex-47">curl -X POST "{BASE_URL}/rpc/get_object_resource" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -H "apikey: {SUPABASE_ANON_KEY}" \
  -H "Authorization: Bearer {SUPABASE_ANON_KEY}" \
  -d '{
    "p_object_id": "FMA-FESTIVAL-2024",
    "p_lang_prefs": ["fr"]
  }'</pre>
            </div>
            <p class="inline-help">Les événements peuvent aussi avoir des menus pour les repas/boissons proposés.</p>
          </div>
        </details>
      </section>

      <!-- 6) Conseils -->
      <section class="card" id="tips">
        <h2>6) Conseils & bonnes pratiques</h2>
        <div class="row">
          <div>
            <h3>Tracé ITI</h3>
            <ul>
              <li>En listing, laissez <code>p_track_format: "none"</code> (plus rapide).</li>
              <li>Pour le détail, demandez le tracé en <code>"kml"</code> ou <code>"gpx"</code>.</li>
              <li><b>KML + étapes</b> : fixez <code>stage_color</code> pour un rendu homogène (ex. <code>"blue"</code>).</li>
            </ul>
          </div>
          <div>
            <h3>Pagination</h3>
            <ul>
              <li><b>Page/offset</b> (<code>list_object_resources_page</code>) : simple pour UI.</li>
              <li><b>Keyset</b> (<code>list_object_resources_since_fast</code>) : idéal pour synchroniser des données modifiées.</li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div>
            <h3>Filtres</h3>
            <ul>
              <li>N’envoyez que les filtres utiles : les autres sont ignorés.</li>
              <li>Combiner plusieurs clés applique un <b>ET</b> logique.</li>
            </ul>
          </div>
          <div>
            <h3>Langues & robustesse</h3>
            <ul>
              <li><code>p_lang_prefs</code> prend un ordre de préférence (ex. <code>["en","fr"]</code>).</li>
              <li>Si un champ n’existe pas, attendez-vous à <code>[]</code>, <code>{}</code> ou <code>null</code> suivant le bloc.</li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div>
            <h3>Deep Data & Performance</h3>
            <ul>
              <li>Utilisez les fonctions Deep Data pour éviter les appels multiples.</li>
              <li>Activez <code>render: true</code> pour des données formatées prêtes à l'affichage.</li>
              <li>Utilisez <code>fields</code> et <code>include</code> pour limiter les données retournées.</li>
            </ul>
          </div>
          <div>
            <h3>Recherches spécialisées</h3>
            <ul>
              <li>Préférez <code>search_restaurants_by_cuisine</code> aux filtres génériques.</li>
              <li>Utilisez <code>search_events_by_restaurant_cuisine</code> pour les événements liés à la gastronomie.</li>
              <li>Les fonctions Deep Data incluent automatiquement les objets liés.</li>
            </ul>
          </div>
        </div>
        <div class="row">
          <div>
            <h3>Nouveaux blocs de données</h3>
            <ul>
              <li><code>actors[]</code> : personnes physiques liées à l'objet avec leurs rôles.</li>
              <li><code>legal_records[]</code> : enregistrements légaux et certifications officielles.</li>
              <li><code>incoming_relations[]</code> et <code>outgoing_relations[]</code> : relations séparées par sens.</li>
            </ul>
          </div>
          <div>
            <h3>Options avancées</h3>
            <ul>
              <li><code>org_object_id</code> : priorise les descriptions d'une organisation spécifique.</li>
              <li><code>render_locale</code> et <code>render_tz</code> : contrôlent le formatage des données.</li>
              <li><code>include_private</code> : accès aux données privées (nécessite permissions).</li>
            </ul>
          </div>
        </div>
        <div class="sep"></div>
        <p class="footer">© OTI du Sud · API</p>
      </section>
    </div>
  </main>

  <!-- Floating toggle sections button -->
  <button id="floatingToggleSections" class="floating-toggle" title="Déplier/Replier toutes les sections">
    <span id="floatingToggleIcon">▾</span>
  </button>

  <script>
    // THEME
    const root = document.documentElement;
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const saved = localStorage.getItem('oti:theme');
    if(saved === 'dark' || (saved === null && prefersDark.matches)){ document.body.classList.add('dark'); }
    
    // Update theme button text and arrow on load
    function updateThemeButtonText() {
      const themeText = document.getElementById('themeText');
      const isDark = document.body.classList.contains('dark');
      themeText.textContent = isDark ? 'Dark' : 'Light';
      
      // Update arrow direction
      const button = document.getElementById('toggleTheme');
      const currentText = button.innerHTML;
      if (currentText.includes('▾') || currentText.includes('▴')) {
        button.innerHTML = currentText.replace(/[▾▴]/, isDark ? '▴' : '▾');
      }
    }
    
    // Update button text on load
    updateThemeButtonText();
    
    document.getElementById('toggleTheme').addEventListener('click', ()=>{
      document.body.classList.toggle('dark');
      localStorage.setItem('oti:theme', document.body.classList.contains('dark') ? 'dark' : 'light');
      updateThemeButtonText();
    });

    // TOGGLE SECTIONS
    const toggleSectionsBtn = document.getElementById('toggleSections');
    const floatingToggleBtn = document.getElementById('floatingToggleSections');
    const floatingToggleIcon = document.getElementById('floatingToggleIcon');
    let sectionsExpanded = false;
    
    function toggleAllSections() {
      // Get current scroll position before toggling
      const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const currentSection = getCurrentVisibleSection();
      
      const details = document.querySelectorAll('details');
      sectionsExpanded = !sectionsExpanded;
      
      details.forEach(d => d.open = sectionsExpanded);
      
      // Update header button text and icon
      toggleSectionsBtn.innerHTML = sectionsExpanded ? '▸ Fermer tout' : '▾ Ouvrir tout';
      toggleSectionsBtn.title = sectionsExpanded ? 'Replier toutes les sections' : 'Déplier toutes les sections';
      
      // Update floating button icon
      floatingToggleIcon.textContent = sectionsExpanded ? '▸' : '▾';
      floatingToggleBtn.title = sectionsExpanded ? 'Replier toutes les sections' : 'Déplier toutes les sections';
      
      // Restore scroll position after DOM updates
      requestAnimationFrame(() => {
        if (currentSection) {
          // Scroll to the same section that was visible
          currentSection.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
          });
        } else {
          // Fallback to previous scroll position
          window.scrollTo({
            top: currentScrollTop,
            behavior: 'smooth'
          });
        }
      });
    }
    
    function getCurrentVisibleSection() {
      const sections = document.querySelectorAll('section[id], details[id], div[id]');
      let currentSection = null;
      let closestDistance = Infinity;
      
      sections.forEach(section => {
        if (section.id) {
          const rect = section.getBoundingClientRect();
          const distanceFromTop = Math.abs(rect.top);
          
          // Check if section is in viewport (at least partially visible)
          if (rect.top <= window.innerHeight / 2 && rect.bottom > 0) {
            if (distanceFromTop < closestDistance) {
              closestDistance = distanceFromTop;
              currentSection = section;
            }
          }
        }
      });
      
      return currentSection;
    }
    
    toggleSectionsBtn.addEventListener('click', toggleAllSections);
    floatingToggleBtn.addEventListener('click', toggleAllSections);

    // COPY buttons
    function copyFromSelector(sel, btn){
      const el = document.querySelector(sel);
      if(!el) return;
      const text = el.innerText;
      navigator.clipboard.writeText(text).then(()=>{
        btn.classList.add('success'); btn.textContent='Copié ✓';
        setTimeout(()=>{ btn.classList.remove('success'); btn.textContent='Copier'; }, 1200);
      });
    }
    document.querySelectorAll('.copy').forEach(btn=>{
      const sel = btn.getAttribute('data-copy');
      btn.addEventListener('click', ()=> copyFromSelector(sel, btn));
    });

    // TABS
    document.querySelectorAll('[data-tabs]').forEach(box=>{
      const buttons = box.querySelectorAll('.tab-bar button');
      const panels = box.querySelectorAll('.tab-panel');
      buttons.forEach(b=>{
        b.addEventListener('click', ()=>{
          const tab = b.getAttribute('data-tab');
          buttons.forEach(x=>x.classList.toggle('active', x===b));
          panels.forEach(p=>p.classList.toggle('active', p.getAttribute('data-panel')===tab));
        });
      });
    });

    // TOC build + ScrollSpy
    const tocEl = document.getElementById('toc');
    const headings = [...document.querySelectorAll('#content h2, #content details > summary')];
    const tocLinks = [];
    
    headings.forEach(h=>{
      // Ensure id
      const base = (h.textContent||'section').toLowerCase()
        .replace(/[^\w]+/g,'-').replace(/(^-|-$)/g,'');
      let id = base, i=1;
      while(document.getElementById(id)){ id = base + '-' + (i++); }
      if(!h.id) h.id = id;

      const a = document.createElement('a');
      a.href = '#' + id;
      a.textContent = h.tagName.toLowerCase()==='summary' ? h.textContent : '• ' + h.textContent;
      if(h.tagName.toLowerCase()==='summary') a.classList.add('sub');
      
      // Add click handler for manual navigation
      a.addEventListener('click', (e)=>{
        e.preventDefault();
        const targetId = a.getAttribute('href').slice(1);
        const targetElement = document.getElementById(targetId);
        
        if(targetElement){
          // Remove all active classes
          tocLinks.forEach(link=>link.classList.remove('active'));
          
          // Add active class to clicked link
          a.classList.add('active');
          
          // Smooth scroll to target
          targetElement.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
          
          // Update URL without jumping
          history.pushState(null, null, '#' + targetId);
        }
      });
      
      tocLinks.push(a); 
      tocEl.appendChild(a);
    });

    // Remove the old observer - we'll use the enhanced one below

    // Handle URL hash changes and initial page load
    function updateActiveFromHash() {
      const hash = window.location.hash.slice(1);
      if (hash) {
        tocLinks.forEach(a => a.classList.remove('active'));
        const targetLink = tocLinks.find(a => a.getAttribute('href').slice(1) === hash);
        if (targetLink) {
          targetLink.classList.add('active');
          // Scroll to the section if it exists
          const targetElement = document.getElementById(hash);
          if (targetElement) {
            setTimeout(() => {
              targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
          }
        }
      }
    }

    // Handle browser back/forward buttons
    window.addEventListener('popstate', updateActiveFromHash);
    
    // Handle initial page load with hash
    window.addEventListener('load', updateActiveFromHash);
    
    // Handle hash changes
    window.addEventListener('hashchange', updateActiveFromHash);

    // Simple and reliable scroll synchronization
    let scrollTimeout;
    let isUserScrollingTOC = false;
    
    // Main scroll handler
    window.addEventListener('scroll', () => {
      if (isUserScrollingTOC) return;
      
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        syncTOCWithMainContent();
      }, 50);
    });
    
    function syncTOCWithMainContent() {
      const tocContainer = document.getElementById('toc');
      const tocLinks = Array.from(tocContainer.querySelectorAll('a'));
      
      if (tocLinks.length === 0) return;
      
      // Proportional scroll of TOC based on main content scroll position
      const contentEl = document.getElementById('content');
      const contentStart = contentEl.offsetTop;
      const contentEnd = contentStart + contentEl.scrollHeight - window.innerHeight;
      const pageY = window.pageYOffset || document.documentElement.scrollTop || 0;
      const clampedY = Math.max(contentStart, Math.min(pageY, contentEnd));
      const progress = contentEnd > contentStart ? (clampedY - contentStart) / (contentEnd - contentStart) : 0;
      const maxTOCScroll = Math.max(0, tocContainer.scrollHeight - tocContainer.clientHeight);
      tocContainer.scrollTop = progress * maxTOCScroll;
      
      // Determine current heading (the headings used to build the TOC)
      const allHeadings = (typeof headings !== 'undefined' && Array.isArray(headings) && headings.length)
        ? headings
        : [...document.querySelectorAll('#content h2, #content details > summary')];
      
      let currentHeading = allHeadings[0];
      const anchorY = 110; // approx sticky header height
      for (let i = 0; i < allHeadings.length; i++) {
        const rect = allHeadings[i].getBoundingClientRect();
        if (rect.top <= anchorY) {
          currentHeading = allHeadings[i];
        } else {
          break;
        }
      }
      
      // Update active link in TOC
      tocLinks.forEach(link => link.classList.remove('active'));
      const activeLink = tocLinks.find(link => link.getAttribute('href').slice(1) === currentHeading.id);
      if (activeLink) {
        activeLink.classList.add('active');
      }
    }

    // Simple hover effects for TOC links (no scrolling)
    tocLinks.forEach(link => {
      link.addEventListener('mouseenter', () => {
        const targetId = link.getAttribute('href').slice(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          // Temporarily highlight the section
          targetElement.style.transition = 'all 0.3s ease';
          targetElement.style.boxShadow = '0 0 0 3px rgba(118,176,151,.3)';
          
          // Remove highlight after a delay
          setTimeout(() => {
            targetElement.style.boxShadow = '';
          }, 2000);
        }
      });
      
      link.addEventListener('mouseleave', () => {
        const targetId = link.getAttribute('href').slice(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          // Remove highlight immediately on mouse leave
          targetElement.style.boxShadow = '';
        }
      });
    });

    // Handle manual TOC scrolling to prevent conflicts
    const tocContainer = document.getElementById('toc');
    let tocScrollTimeout;
    
    tocContainer.addEventListener('scroll', () => {
      // Temporarily disable main scroll sync when user scrolls TOC manually
      isUserScrollingTOC = true;
      
      clearTimeout(tocScrollTimeout);
      tocScrollTimeout = setTimeout(() => {
        isUserScrollingTOC = false;
      }, 500); // Re-enable after 500ms of no TOC scrolling
    });

    // Initialize TOC scroll position on page load
    window.addEventListener('load', () => {
      setTimeout(syncTOCWithMainContent, 100);
    });

    // GLOBAL SEARCH: filter cards/sections by text
    const q = document.getElementById('globalSearch');
    const searchable = [...document.querySelectorAll('#content .card, #content details, #content table, #content pre')];
    q.addEventListener('input', ()=>{
      const v = q.value.trim().toLowerCase();
      searchable.forEach(s=>{
        const text = s.innerText.toLowerCase();
        const match = !v || text.includes(v);
        s.style.display = match ? '' : 'none';
      });
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='k'){
        e.preventDefault(); q.focus();
      }
    });
  </script>
</body>
</html>
